/*! Fabric.js Copyright 2008-2013, Printio (Juriy Zaytsev, Maxim Chernyak) */
var fabric=fabric||{version:"1.3.12"};typeof exports!="undefined"&&(exports.fabric=fabric);typeof document!="undefined"&&typeof window!="undefined"?(fabric.document=document,fabric.window=window):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head><\/head><body><\/body><\/html>"),fabric.window=fabric.document.createWindow());fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement;fabric.isLikelyNode=typeof Buffer!="undefined"&&typeof window=="undefined";fabric.SHARED_ATTRIBUTES=["transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width"],function(){function n(n,t){this.__eventListeners[n]&&(t?fabric.util.removeFromArray(this.__eventListeners[n],t):this.__eventListeners[n].length=0)}function t(n,t){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var i in n)this.on(i,n[i]);else this.__eventListeners[n]||(this.__eventListeners[n]=[]),this.__eventListeners[n].push(t);return this}function i(t,i){if(this.__eventListeners){if(arguments.length===0)this.__eventListeners={};else if(arguments.length===1&&typeof arguments[0]=="object")for(var r in t)n.call(this,r,t[r]);else n.call(this,t,i);return this}}function r(n,t){var i,r,u;if(this.__eventListeners&&(i=this.__eventListeners[n],i)){for(r=0,u=i.length;r<u;r++)i[r].call(this,t||{});return this}}fabric.Observable={observe:t,stopObserving:i,fire:r,on:t,off:i,trigger:r}}();fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var n=arguments.length;n--;)this._onObjectAdded(arguments[n]);return this.renderOnAddRemove&&this.renderAll(),this},insertAt:function(n,t,i){var r=this.getObjects();return i?r[t]=n:r.splice(t,0,n),this._onObjectAdded(n),this.renderOnAddRemove&&this.renderAll(),this},remove:function(n){var t=this.getObjects(),i=t.indexOf(n);return i!==-1&&(t.splice(i,1),this._onObjectRemoved(n)),this.renderOnAddRemove&&this.renderAll(),n},forEachObject:function(n,t){for(var i=this.getObjects(),r=i.length;r--;)n.call(t,i[r],r,i);return this},getObjects:function(n){return typeof n=="undefined"?this._objects:this._objects.filter(function(t){return t.type===n})},item:function(n){return this.getObjects()[n]},isEmpty:function(){return this.getObjects().length===0},size:function(){return this.getObjects().length},contains:function(n){return this.getObjects().indexOf(n)>-1},complexity:function(){return this.getObjects().reduce(function(n,t){return n+(t.complexity?t.complexity():0)},0)}},function(n){var i=Math.sqrt,r=Math.atan2,t=Math.PI/180;fabric.util={removeFromArray:function(n,t){var i=n.indexOf(t);return i!==-1&&n.splice(i,1),n},getRandomInt:function(n,t){return Math.floor(Math.random()*(t-n+1))+n},degreesToRadians:function(n){return n*t},radiansToDegrees:function(n){return n/t},rotatePoint:function(n,t,i){var r=Math.sin(i),u=Math.cos(i),f,e;return n.subtractEquals(t),f=n.x*u-n.y*r,e=n.x*r+n.y*u,new fabric.Point(f,e).addEquals(t)},toFixed:function(n,t){return parseFloat(Number(n).toFixed(t))},falseFunction:function(){return!1},getKlass:function(n,t){return n=fabric.util.string.camelize(n.charAt(0).toUpperCase()+n.slice(1)),fabric.util.resolveNamespace(t)[n]},resolveNamespace:function(t){var i;if(!t)return fabric;var u=t.split("."),f=u.length,r=n||fabric.window;for(i=0;i<f;++i)r=r[u[i]];return r},loadImage:function(n,t,i,r){if(!n){t&&t.call(i,n);return}var u=fabric.util.createImage();u.onload=function(){t&&t.call(i,u);u=u.onload=u.onerror=null};u.onerror=function(){fabric.log("Error loading "+u.src);t&&t.call(i,null,!0);u=u.onload=u.onerror=null};n.indexOf("data")!==0&&(u.crossOrigin=r||"");u.src=n},enlivenObjects:function(n,t,i,r){function f(){++o===e&&t&&t(u)}n=n||[];var u=[],o=0,e=n.length;if(!e){t&&t(u);return}n.forEach(function(n,t){if(!n||!n.type){f();return}var e=fabric.util.getKlass(n.type,i);e.async?e.fromObject(n,function(i,e){e||(u[t]=i,r&&r(n,u[t]));f()}):(u[t]=e.fromObject(n),r&&r(n,u[t]),f())})},groupSVGElements:function(n,t,i){var r;return r=n.length>1?new fabric.PathGroup(n,t):n[0],typeof i!="undefined"&&r.setSourcePath(i),r},populateWithProperties:function(n,t,i){if(i&&Object.prototype.toString.call(i)==="[object Array]")for(var r=0,u=i.length;r<u;r++)i[r]in n&&(t[i[r]]=n[i[r]])},drawDashedLine:function(n,t,u,f,e,o){var s=f-t,h=e-u,c=i(s*s+h*h),a=r(h,s),v=o.length,y=0,l=!0;for(n.save(),n.translate(t,u),n.moveTo(0,0),n.rotate(a),t=0;c>t;)t+=o[y++%v],t>c&&(t=c),n[l?"lineTo":"moveTo"](t,0),l=!l;n.restore()},createCanvasElement:function(n){return n||(n=fabric.document.createElement("canvas")),n.getContext||typeof G_vmlCanvasManager=="undefined"||G_vmlCanvasManager.initElement(n),n},createImage:function(){return fabric.isLikelyNode?new(require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(n){for(var t=n.prototype,r=t.stateProperties.length;r--;){var i=t.stateProperties[r],u=i.charAt(0).toUpperCase()+i.slice(1),f="set"+u,e="get"+u;t[e]||(t[e]=function(n){return new Function('return this.get("'+n+'")')}(i));t[f]||(t[f]=function(n){return new Function("value",'return this.set("'+n+'", value)')}(i))}},clipContext:function(n,t){t.save();t.beginPath();n.clipTo(t);t.clip()},multiplyTransformMatrices:function(n,t){for(var u,e,f,o=[[n[0],n[2],n[4]],[n[1],n[3],n[5]],[0,0,1]],s=[[t[0],t[2],t[4]],[t[1],t[3],t[5]],[0,0,1]],i=[],r=0;r<3;r++)for(i[r]=[],u=0;u<3;u++){for(e=0,f=0;f<3;f++)e+=o[r][f]*s[f][u];i[r][u]=e}return[i[0][0],i[1][0],i[0][1],i[1][1],i[0][2],i[1][2]]},getFunctionBody:function(n){return(String(n).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},normalizePoints:function(n,t){var i=fabric.util.array.min(n,"x"),u=fabric.util.array.min(n,"y"),r,f;for(i=i<0?i:0,u=i<0?u:0,r=0,f=n.length;r<f;r++)n[r].x-=t.width/2+i||0,n[r].y-=t.height/2+u||0},isTransparent:function(n,t,i,r){var u,f,e,o,s;for(r>0&&(t>r?t-=r:t=0,i>r?i-=r:i=0),u=!0,f=n.getImageData(t,i,r*2||1,r*2||1),e=3,o=f.data.length;e<o;e+=4)if(s=f.data[e],u=s<=0,u===!1)break;return f=null,u}}}(typeof exports!="undefined"?exports:this),function(){function u(t,u,e,o,s,h,c,l,a){var w,b,k,p,it,rt;if(n=r.call(arguments),i[n])return i[n];var v=f(c,e,o,l,a,t,u),ut=(v.x1-v.x0)*(v.x1-v.x0)+(v.y1-v.y0)*(v.y1-v.y0),d=1/ut-.25;d<0&&(d=0);w=Math.sqrt(d);h===s&&(w=-w);var g=.5*(v.x0+v.x1)-w*(v.y1-v.y0),nt=.5*(v.y0+v.y1)+w*(v.x1-v.x0),tt=Math.atan2(v.y0-nt,v.x0-g),ft=Math.atan2(v.y1-nt,v.x1-g),y=ft-tt;for(y<0&&h===1?y+=2*Math.PI:y>0&&h===0&&(y-=2*Math.PI),b=Math.ceil(Math.abs(y/(Math.PI*.5+.001))),k=[],p=0;p<b;p++)it=tt+p*y/b,rt=tt+(p+1)*y/b,k[p]=[g,nt,it,rt,e,o,v.sin_th,v.cos_th];return i[n]=k,k}function f(n,t,i,r,u,f,e){var c=n*(Math.PI/180),o=Math.sin(c),s=Math.cos(c);t=Math.abs(t);i=Math.abs(i);var l=s*(r-f)*.5+o*(u-e)*.5,a=s*(u-e)*.5-o*(r-f)*.5,h=l*l/(t*t)+a*a/(i*i);h>1&&(h=Math.sqrt(h),t*=h,i*=h);var v=s/t,y=o/t,p=-o/i,w=s/i;return{x0:v*r+y*u,y0:p*r+w*u,x1:v*f+y*e,y1:p*f+w*e,sin_th:o,cos_th:s}}function e(i,u,f,e,o,s,h,c){if(n=r.call(arguments),t[n])return t[n];var a=c*o,v=-h*s,y=h*o,p=c*s,w=.5*(e-f),l=8/3*Math.sin(w*.5)*Math.sin(w*.5)/Math.sin(w),d=i+Math.cos(f)-l*Math.sin(f),g=u+Math.sin(f)+l*Math.cos(f),b=i+Math.cos(e),k=u+Math.sin(e),nt=b+l*Math.sin(e),tt=k-l*Math.cos(e);return t[n]=[a*d+v*g,y*d+p*g,a*nt+v*tt,y*nt+p*tt,a*b+v*k,y*b+p*k],t[n]}var i={},t={},r=Array.prototype.join,n;fabric.util.drawArc=function(n,t,i,r){for(var s,h=r[0],c=r[1],l=r[2],a=r[3],v=r[4],y=r[5],p=r[6],o=u(y,p,h,c,a,v,l,t,i),f=0;f<o.length;f++)s=e.apply(this,o[f]),n.bezierCurveTo.apply(n,s)}}(),function(){function i(n,i){for(var u=t.call(arguments,2),f=[],r=0,e=n.length;r<e;r++)f[r]=u.length?n[r][i].apply(n[r],u):n[r][i].call(n[r]);return f}function r(t,i){return n(t,i,function(n,t){return n>=t})}function u(t,i){return n(t,i,function(n,t){return n<t})}function n(n,t,i){if(!n||n.length===0)return undefined;var r=n.length-1,u=t?n[r][t]:n[r];if(t)while(r--)i(n[r][t],u)&&(u=n[r][t]);else while(r--)i(n[r],u)&&(u=n[r]);return u}var t=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(n){var u,r,t,i;if(this===void 0||this===null)throw new TypeError;if((u=Object(this),r=u.length>>>0,r===0)||(t=0,arguments.length>0&&(t=Number(arguments[1]),t!==t?t=0:t!==0&&t!==Number.POSITIVE_INFINITY&&t!==Number.NEGATIVE_INFINITY&&(t=(t>0||-1)*Math.floor(Math.abs(t)))),t>=r))return-1;for(i=t>=0?t:Math.max(r-Math.abs(t),0);i<r;i++)if(i in u&&u[i]===n)return i;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(n,t){for(var i=0,r=this.length>>>0;i<r;i++)i in this&&n.call(t,this[i],i,this)});Array.prototype.map||(Array.prototype.map=function(n,t){for(var r=[],i=0,u=this.length>>>0;i<u;i++)i in this&&(r[i]=n.call(t,this[i],i,this));return r});Array.prototype.every||(Array.prototype.every=function(n,t){for(var i=0,r=this.length>>>0;i<r;i++)if(i in this&&!n.call(t,this[i],i,this))return!1;return!0});Array.prototype.some||(Array.prototype.some=function(n,t){for(var i=0,r=this.length>>>0;i<r;i++)if(i in this&&n.call(t,this[i],i,this))return!0;return!1});Array.prototype.filter||(Array.prototype.filter=function(n,t){for(var u=[],r,i=0,f=this.length>>>0;i<f;i++)i in this&&(r=this[i],n.call(t,r,i,this)&&u.push(r));return u});Array.prototype.reduce||(Array.prototype.reduce=function(n){var r=this.length>>>0,t=0,i;if(arguments.length>1)i=arguments[1];else do{if(t in this){i=this[t++];break}if(++t>=r)throw new TypeError;}while(1);for(;t<r;t++)t in this&&(i=n.call(null,i,this[t],t,this));return i});fabric.util.array={invoke:i,min:u,max:r}}(),function(){function n(n,t){for(var i in t)n[i]=t[i];return n}function t(t){return n({},t)}fabric.util.object={extend:n,clone:t}}(),function(){function n(n){return n.replace(/-+(.)?/g,function(n,t){return t?t.toUpperCase():""})}function t(n,t){return n.charAt(0).toUpperCase()+(t?n.slice(1):n.slice(1).toLowerCase())}function i(n){return n.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")});fabric.util.string={camelize:n,capitalize:t,escapeXml:i}}(),function(){var t=Array.prototype.slice,i=Function.prototype.apply,n=function(){};Function.prototype.bind||(Function.prototype.bind=function(r){var f=this,e=t.call(arguments,1),u;return u=e.length?function(){return i.call(f,this instanceof n?this:r,e.concat(t.call(arguments)))}:function(){return i.call(f,this instanceof n?this:r,arguments)},n.prototype=this.prototype,u.prototype=new n,u})}(),function(){function t(){}function f(t){var i=this.constructor.superclass.prototype[t];return arguments.length>1?i.apply(this,n.call(arguments,1)):i.call(this)}function e(){function r(){this.initialize.apply(this,arguments)}var e=null,o=n.call(arguments,0),s,h;for(typeof o[0]=="function"&&(e=o.shift()),r.superclass=e,r.subclasses=[],e&&(t.prototype=e.prototype,r.prototype=new t,e.subclasses.push(r)),s=0,h=o.length;s<h;s++)u(r,o[s],e);return r.prototype.initialize||(r.prototype.initialize=i),r.prototype.constructor=r,r.prototype.callSuper=f,r}var n=Array.prototype.slice,i=function(){},r=function(){for(var n in{toString:1})if(n==="toString")return!1;return!0}(),u=function(n,t,i){for(var u in t)n.prototype[u]=u in n.prototype&&typeof n.prototype[u]=="function"&&(t[u]+"").indexOf("callSuper")>-1?function(n){return function(){var u=this.constructor.superclass,r;return this.constructor.superclass=i,r=t[n].apply(this,arguments),this.constructor.superclass=u,n!=="initialize"?r:void 0}}(u):t[u],r&&(t.toString!==Object.prototype.toString&&(n.prototype.toString=t.toString),t.valueOf!==Object.prototype.valueOf&&(n.prototype.valueOf=t.valueOf))};fabric.util.createClass=e}(),function(){function i(n){for(var i=Array.prototype.slice.call(arguments,1),r,u=i.length,t=0;t<u;t++)if(r=typeof n[i[t]],!/^(?:function|object|unknown)$/.test(r))return!1;return!0}function a(n,t){return{handler:t,wrappedHandler:v(n,t)}}function v(n,t){return function(i){t.call(h(n),i||fabric.window.event)}}function y(t,i){return function(r){var f,u,e;if(n[t]&&n[t][i])for(f=n[t][i],u=0,e=f.length;u<e;u++)f[u].call(this,r||fabric.window.event)}}function b(n,t){n||(n=fabric.window.event);var r=n.target||(typeof n.srcElement!==e?n.srcElement:null),i=fabric.util.getScrollLeftTop(r,t);return{x:o(n)+i.left,y:s(n)+i.top}}function l(n,t,i){var r=n.type==="touchend"?"changedTouches":"touches";return n[r]&&n[r][0]?n[r][0][t]-(n[r][0][t]-n[r][0][i])||n[i]:n[i]}var e="unknown",r=function(){var n=0;return function(t){return t.__uniqueID||(t.__uniqueID="uniqueID__"+n++)}}(),h,c,o,s;(function(){var n={};h=function(t){return n[t]};c=function(t,i){n[t]=i}})();var p=i(fabric.document.documentElement,"addEventListener","removeEventListener")&&i(fabric.window,"addEventListener","removeEventListener"),w=i(fabric.document.documentElement,"attachEvent","detachEvent")&&i(fabric.window,"attachEvent","detachEvent"),t={},n={},u,f;p?(u=function(n,t,i){n.addEventListener(t,i,!1)},f=function(n,t,i){n.removeEventListener(t,i,!1)}):w?(u=function(n,i,u){var f=r(n),e;c(f,n);t[f]||(t[f]={});t[f][i]||(t[f][i]=[]);e=a(f,u);t[f][i].push(e);n.attachEvent("on"+i,e.wrappedHandler)},f=function(n,i,u){var f=r(n),o,e,s;if(t[f]&&t[f][i])for(e=0,s=t[f][i].length;e<s;e++)o=t[f][i][e],o&&o.handler===u&&(n.detachEvent("on"+i,o.wrappedHandler),t[f][i][e]=null)}):(u=function(t,i,u){var f=r(t),e;n[f]||(n[f]={});n[f][i]||(n[f][i]=[],e=t["on"+i],e&&n[f][i].push(e),t["on"+i]=y(f,i));n[f][i].push(u)},f=function(t,i,u){var o=r(t),e,f,s;if(n[o]&&n[o][i])for(e=n[o][i],f=0,s=e.length;f<s;f++)e[f]===u&&e.splice(f,1)});fabric.util.addListener=u;fabric.util.removeListener=f;o=function(n){return typeof n.clientX!==e?n.clientX:0};s=function(n){return typeof n.clientY!==e?n.clientY:0};fabric.isTouchSupported&&(o=function(n){return l(n,"pageX","clientX")},s=function(n){return l(n,"pageY","clientY")});fabric.util.getPointer=b;fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){function r(t,i){var u=t.style,r,f;if(!u)return t;if(typeof i=="string")return t.style.cssText+=";"+i,i.indexOf("opacity")>-1?n(t,i.match(/opacity:\s*(\d?\.?\d*)/)[1]):t;for(r in i)r==="opacity"?n(t,i[r]):(f=r==="float"||r==="cssFloat"?typeof u.styleFloat=="undefined"?"cssFloat":"styleFloat":r,u[f]=i[r]);return t}var t=fabric.document.createElement("div"),u=typeof t.style.opacity=="string",f=typeof t.style.filter=="string",i=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,n=function(n){return n};u?n=function(n,t){return n.style.opacity=t,n}:f&&(n=function(n,t){var r=n.style;return n.currentStyle&&!n.currentStyle.hasLayout&&(r.zoom=1),i.test(r.filter)?(t=t>=.9999?"":"alpha(opacity="+t*100+")",r.filter=r.filter.replace(i,t)):r.filter+=" alpha(opacity="+t*100+")",n});fabric.util.setStyle=r}(),function(){function f(n){return typeof n=="string"?fabric.document.getElementById(n):n}function i(n,t){var r=fabric.document.createElement(n);for(var i in t)i==="class"?r.className=t[i]:i==="for"?r.htmlFor=t[i]:r.setAttribute(i,t[i]);return r}function e(n,t){(" "+n.className+" ").indexOf(" "+t+" ")===-1&&(n.className+=(n.className?" ":"")+t)}function o(n,t,r){return typeof t=="string"&&(t=i(t,r)),n.parentNode&&n.parentNode.replaceChild(t,n),t.appendChild(n),t}function s(n,t){for(var u,i=0,r=0,e=fabric.document.documentElement,o=fabric.document.body||{scrollLeft:0,scrollTop:0},f=n;n&&n.parentNode&&!u;)n=n.parentNode,n!==fabric.document&&fabric.util.getElementStyle(n,"position")==="fixed"&&(u=n),n!==fabric.document&&f!==t&&fabric.util.getElementStyle(n,"position")==="absolute"?(i=0,r=0):n===fabric.document?(i=o.scrollLeft||e.scrollLeft||0,r=o.scrollTop||e.scrollTop||0):(i+=n.scrollLeft||0,r+=n.scrollTop||0);return{left:i,top:r}}function h(n){var t,i={left:0,top:0},o=n&&n.ownerDocument,u={left:0,top:0},f,s={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"},e;if(!o)return{left:0,top:0};for(e in s)u[s[e]]+=parseInt(r(n,e),10)||0;return t=o.documentElement,typeof n.getBoundingClientRect!="undefined"&&(i=n.getBoundingClientRect()),f=fabric.util.getScrollLeftTop(n,null),{left:i.left+f.left-(t.clientLeft||0)+u.left,top:i.top+f.top-(t.clientTop||0)+u.top}}function r(n,t){if(n.style||(n.style={}),fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle)return fabric.document.defaultView.getComputedStyle(n,null)[t];var i=n.style[t];return!i&&n.currentStyle&&(i=n.currentStyle[t]),i}var u=Array.prototype.slice,n=function(n){return u.call(n,0)},t;try{t=n(fabric.document.childNodes)instanceof Array}catch(c){}t||(n=function(n){for(var i=new Array(n.length),t=n.length;t--;)i[t]=n[t];return i}),function(){function i(n){return typeof n.onselectstart!="undefined"&&(n.onselectstart=fabric.util.falseFunction),t?n.style[t]="none":typeof n.unselectable=="string"&&(n.unselectable="on"),n}function r(n){return typeof n.onselectstart!="undefined"&&(n.onselectstart=null),t?n.style[t]="":typeof n.unselectable=="string"&&(n.unselectable=""),n}var n=fabric.document.documentElement.style,t="userSelect"in n?"userSelect":"MozUserSelect"in n?"MozUserSelect":"WebkitUserSelect"in n?"WebkitUserSelect":"KhtmlUserSelect"in n?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=i;fabric.util.makeElementSelectable=r}(),function(){function n(n,t){var u=fabric.document.getElementsByTagName("head")[0],i=fabric.document.createElement("script"),r=!0;i.onload=i.onreadystatechange=function(n){if(r){if(typeof this.readyState=="string"&&this.readyState!=="loaded"&&this.readyState!=="complete")return;r=!1;t(n||fabric.window.event);i=i.onload=i.onreadystatechange=null}};i.src=n;u.appendChild(i)}fabric.util.getScript=n}();fabric.util.getById=f;fabric.util.toArray=n;fabric.util.makeElement=i;fabric.util.addClass=e;fabric.util.wrapElement=o;fabric.util.getScrollLeftTop=s;fabric.util.getElementOffset=h;fabric.util.getElementStyle=r}(),function(){function n(n,t){return n+(/\?/.test(n)?"&":"?")+t}function i(){}function r(r,u){u||(u={});var e=u.method?u.method.toUpperCase():"GET",s=u.onComplete||function(){},f=t(),o;return f.onreadystatechange=function(){f.readyState===4&&(s(f),f.onreadystatechange=i)},e==="GET"&&(o=null,typeof u.parameters=="string"&&(r=n(r,u.parameters))),f.open(e,r,!0),(e==="POST"||e==="PUT")&&f.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),f.send(o),f}var t=function(){for(var i,n=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],t=n.length;t--;)try{if(i=n[t](),i)return n[t]}catch(r){}}();fabric.util.request=r}();fabric.log=function(){};fabric.warn=function(){};typeof console!="undefined"&&["log","warn"].forEach(function(n){typeof console[n]!="undefined"&&console[n].apply&&(fabric[n]=function(){return console[n].apply(console,arguments)})}),function(){function t(t){n(function(i){t||(t={});var u=i||+new Date,f=t.duration||500,e=u+f,r,s=t.onChange||function(){},h=t.abort||function(){return!1},c=t.easing||function(n,t,i,r){return-i*Math.cos(n/r*(Math.PI/2))+i+t},o="startValue"in t?t.startValue:0,l="endValue"in t?t.endValue:100,a=t.byValue||l-o;t.onStart&&t.onStart(),function v(i){r=i||+new Date;var l=r>e?f:r-u;if(h()){t.onComplete&&t.onComplete();return}if(s(c(l,o,a,f)),r>e){t.onComplete&&t.onComplete();return}n(v)}(u)})}var i=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(n){fabric.window.setTimeout(n,1e3/60)},n=function(){return i.apply(fabric.window,arguments)};fabric.util.animate=t;fabric.util.requestAnimFrame=n}(),function(){function n(n,t,i,r){return n<Math.abs(t)?(n=t,r=i/4):r=i/(2*Math.PI)*Math.asin(t/n),{a:n,c:t,p:i,s:r}}function i(n,t,i){return n.a*Math.pow(2,10*(t-=1))*Math.sin((t*i-n.s)*2*Math.PI/n.p)}function u(n,t,i,r){return i*((n=n/r-1)*n*n+1)+t}function f(n,t,i,r){return(n/=r/2,n<1)?i/2*n*n*n+t:i/2*((n-=2)*n*n+2)+t}function e(n,t,i,r){return i*(n/=r)*n*n*n+t}function o(n,t,i,r){return-i*((n=n/r-1)*n*n*n-1)+t}function s(n,t,i,r){return(n/=r/2,n<1)?i/2*n*n*n*n+t:-i/2*((n-=2)*n*n*n-2)+t}function h(n,t,i,r){return i*(n/=r)*n*n*n*n+t}function c(n,t,i,r){return i*((n=n/r-1)*n*n*n*n+1)+t}function l(n,t,i,r){return(n/=r/2,n<1)?i/2*n*n*n*n*n+t:i/2*((n-=2)*n*n*n*n+2)+t}function a(n,t,i,r){return-i*Math.cos(n/r*(Math.PI/2))+i+t}function v(n,t,i,r){return i*Math.sin(n/r*(Math.PI/2))+t}function y(n,t,i,r){return-i/2*(Math.cos(Math.PI*n/r)-1)+t}function p(n,t,i,r){return n===0?t:i*Math.pow(2,10*(n/r-1))+t}function w(n,t,i,r){return n===r?t+i:i*(-Math.pow(2,-10*n/r)+1)+t}function b(n,t,i,r){return n===0?t:n===r?t+i:(n/=r/2,n<1)?i/2*Math.pow(2,10*(n-1))+t:i/2*(-Math.pow(2,-10*--n)+2)+t}function k(n,t,i,r){return-i*(Math.sqrt(1-(n/=r)*n)-1)+t}function d(n,t,i,r){return i*Math.sqrt(1-(n=n/r-1)*n)+t}function g(n,t,i,r){return(n/=r/2,n<1)?-i/2*(Math.sqrt(1-n*n)-1)+t:i/2*(Math.sqrt(1-(n-=2)*n)+1)+t}function nt(t,r,u,f){var e=0,s=u,o;return t===0?r:(t/=f,t===1)?r+u:(e||(e=f*.3),o=n(s,u,e,1.70158),-i(o,t,f)+r)}function tt(t,i,r,u){var e=0,o=r,f;return t===0?i:(t/=u,t===1)?i+r:(e||(e=u*.3),f=n(o,r,e,1.70158),f.a*Math.pow(2,-10*t)*Math.sin((t*u-f.s)*2*Math.PI/f.p)+f.c+i)}function it(t,r,u,f){var o=0,s=u,e;return t===0?r:(t/=f/2,t===2)?r+u:(o||(o=f*.3*1.5),e=n(s,u,o,1.70158),t<1)?-.5*i(e,t,f)+r:e.a*Math.pow(2,-10*(t-=1))*Math.sin((t*f-e.s)*2*Math.PI/e.p)*.5+e.c+r}function rt(n,t,i,r,u){return u===undefined&&(u=1.70158),i*(n/=r)*n*((u+1)*n-u)+t}function ut(n,t,i,r,u){return u===undefined&&(u=1.70158),i*((n=n/r-1)*n*((u+1)*n+u)+1)+t}function ft(n,t,i,r,u){return(u===undefined&&(u=1.70158),n/=r/2,n<1)?i/2*n*n*(((u*=1.525)+1)*n-u)+t:i/2*((n-=2)*n*(((u*=1.525)+1)*n+u)+2)+t}function r(n,i,r,u){return r-t(u-n,0,r,u)+i}function t(n,t,i,r){return(n/=r)<1/2.75?i*7.5625*n*n+t:n<2/2.75?i*(7.5625*(n-=1.5/2.75)*n+.75)+t:n<2.5/2.75?i*(7.5625*(n-=2.25/2.75)*n+.9375)+t:i*(7.5625*(n-=2.625/2.75)*n+.984375)+t}function et(n,i,u,f){return n<f/2?r(n*2,0,u,f)*.5+i:t(n*2-f,0,u,f)*.5+u*.5+i}fabric.util.ease={easeInQuad:function(n,t,i,r){return i*(n/=r)*n+t},easeOutQuad:function(n,t,i,r){return-i*(n/=r)*(n-2)+t},easeInOutQuad:function(n,t,i,r){return(n/=r/2,n<1)?i/2*n*n+t:-i/2*(--n*(n-2)-1)+t},easeInCubic:function(n,t,i,r){return i*(n/=r)*n*n+t},easeOutCubic:u,easeInOutCubic:f,easeInQuart:e,easeOutQuart:o,easeInOutQuart:s,easeInQuint:h,easeOutQuint:c,easeInOutQuint:l,easeInSine:a,easeOutSine:v,easeInOutSine:y,easeInExpo:p,easeOutExpo:w,easeInOutExpo:b,easeInCirc:k,easeOutCirc:d,easeInOutCirc:g,easeInElastic:nt,easeOutElastic:tt,easeInOutElastic:it,easeInBack:rt,easeOutBack:ut,easeInOutBack:ft,easeInBounce:r,easeOutBounce:t,easeInOutBounce:et}}(),function(n){"use strict";function f(n){return n in o?o[n]:n}function e(n,i,r){var u,f;return(n==="fill"||n==="stroke")&&i==="none"?i="":n==="fillRule"?i=i==="evenodd"?"destination-over":i:n==="strokeDashArray"?i=i.replace(/,/g," ").split(/\s+/):n==="transformMatrix"&&(i=r&&r.transformMatrix?v(r.transformMatrix,t.parseTransformAttribute(i)):t.parseTransformAttribute(i)),u=Object.prototype.toString.call(i)==="[object Array]",f=u?i.map(parseFloat):parseFloat(i),!u&&isNaN(f)?i:f}function y(n){var i,u;for(i in r)n[i]&&typeof n[r[i]]!="undefined"&&n[i].indexOf("url(")!==0&&(u=new t.Color(n[i]),n[i]=u.setAlpha(a(u.getAlpha()*n[r[i]],2)).toRgba(),delete n[r[i]]);return n}function s(n,t){var i=n.match(/(normal|italic)?\s*(normal|small-caps)?\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\s*(\d+)px(?:\/(normal|[\d\.]+))?\s+(.*)/);if(i){var f=i[1],r=i[3],e=i[4],u=i[5],o=i[6];f&&(t.fontStyle=f);r&&(t.fontSize=isNaN(parseFloat(r))?r:parseFloat(r));e&&(t.fontSize=parseFloat(e));o&&(t.fontFamily=o);u&&(t.lineHeight=u==="normal"?1:u)}}function p(n,t){var i,r;n.replace(/;$/,"").split(";").forEach(function(n){var u=n.split(":");i=f(u[0].trim().toLowerCase());r=e(i,u[1].trim());i==="font"?s(r,t):t[i]=r})}function w(n,t){var i,r;for(var u in n)typeof n[u]!="undefined"&&(i=f(u.toLowerCase()),r=e(i,n[u]),i==="font"?s(r,t):t[i]=r)}function b(n){var s=n.nodeName,u=n.getAttribute("class"),f=n.getAttribute("id"),e={},i,o,r;for(i in t.cssRules)if(o=u&&new RegExp("^\\."+u).test(i)||f&&new RegExp("^#"+f).test(i)||new RegExp("^"+s).test(i),o)for(r in t.cssRules[i])e[r]=t.cssRules[i][r];return e}function k(n){var i=n.objects,r=n.options;return i=i.map(function(n){return t[c(n.type)].fromObject(n)}),{objects:i,options:r}}function h(n,t,i){t[i]&&t[i].toSVG&&n.push('<pattern x="0" y="0" id="',i,'Pattern" ','width="',t[i].source.width,'" height="',t[i].source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',t[i].source.width,'" height="',t[i].source.height,'" xlink:href="',t[i].source.src,'"><\/image><\/pattern>')}var t=n.fabric||(n.fabric={}),i=t.util.object.extend,c=t.util.string.capitalize,l=t.util.object.clone,a=t.util.toFixed,v=t.util.multiplyTransformMatrices,o={"fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight",cx:"left",x:"left",r:"radius","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration",cy:"top",y:"top",transform:"transformMatrix"},r={stroke:"strokeOpacity",fill:"fillOpacity"},u;t.parseTransformAttribute=function(){function f(n,t){var i=t[0];n[0]=Math.cos(i);n[1]=Math.sin(i);n[2]=-Math.sin(i);n[3]=Math.cos(i)}function e(n,t){var i=t[0],r=t.length===2?t[1]:t[0];n[0]=i;n[3]=r}function o(n,t){n[2]=t[0]}function s(n,t){n[1]=t[0]}function h(n,t){n[4]=t[0];t.length===2&&(n[5]=t[1])}var u=[1,0,0,1,0,0],n="(?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)",i="(?:\\s+,?\\s*|,\\s*)",c="(?:(skewX)\\s*\\(\\s*("+n+")\\s*\\))",l="(?:(skewY)\\s*\\(\\s*("+n+")\\s*\\))",a="(?:(rotate)\\s*\\(\\s*("+n+")(?:"+i+"("+n+")"+i+"("+n+"))?\\s*\\))",v="(?:(scale)\\s*\\(\\s*("+n+")(?:"+i+"("+n+"))?\\s*\\))",y="(?:(translate)\\s*\\(\\s*("+n+")(?:"+i+"("+n+"))?\\s*\\))",p="(?:(matrix)\\s*\\(\\s*("+n+")"+i+"("+n+")"+i+"("+n+")"+i+"("+n+")"+i+"("+n+")"+i+"("+n+")\\s*\\))",r="(?:"+p+"|"+y+"|"+v+"|"+a+"|"+c+"|"+l+")",w="(?:"+r+"(?:"+i+r+")*)",b="^\\s*(?:"+w+"?)\\s*$",k=new RegExp(b),d=new RegExp(r,"g");return function(n){var i=u.concat(),c=[],l;if(!n||n&&!k.test(n))return i;for(n.replace(d,function(n){var l=new RegExp(r).exec(n).filter(function(n){return n!==""&&n!=null}),a=l[1],t=l.slice(2).map(parseFloat);switch(a){case"translate":h(i,t);break;case"rotate":f(i,t);break;case"scale":e(i,t);break;case"skewX":o(i,t);break;case"skewY":s(i,t);break;case"matrix":i=t}c.push(i.concat());i=u.concat()}),l=c[0];c.length>1;)c.shift(),l=t.util.multiplyTransformMatrices(l,c[0]);return l}}();t.parseSVGDocument=function(){function u(n,t){while(n&&(n=n.parentNode))if(t.test(n.nodeName))return!0;return!1}var i=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,n="(?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)",r=new RegExp("^\\s*("+n+"+)\\s*,?\\s*("+n+"+)\\s*,?\\s*("+n+"+)\\s*,?\\s*("+n+"+)\\s*$");return function(n,f,e){var w,o,y,h,b,c,p;if(n){if(w=new Date,o=t.util.toArray(n.getElementsByTagName("*")),o.length===0){for(o=n.selectNodes("//*[name(.)!='svg']"),y=[],h=0,b=o.length;h<b;h++)y[h]=o[h];o=y}if(c=o.filter(function(n){return i.test(n.tagName)&&!u(n,/^(?:pattern|defs)$/)}),c&&(!c||c.length)){var s=n.getAttribute("viewBox"),k=n.getAttribute("width"),d=n.getAttribute("height"),a=null,v=null,g,nt;s&&(s=s.match(r))&&(g=parseInt(s[1],10),nt=parseInt(s[2],10),a=parseInt(s[3],10),v=parseInt(s[4],10));a=k?parseFloat(k):a;v=d?parseFloat(d):v;p={width:a,height:v};t.gradientDefs=t.getGradientDefs(n);t.cssRules=t.getCSSRules(n);t.parseElements(c,function(n){t.documentParsingTime=new Date-w;f&&f(n,p)},l(p),e)}}}}();u={has:function(n,t){t(!1)},get:function(){},set:function(){}};i(t,{resolveGradients:function(n){for(var r,u,i=n.length;i--;)(r=n[i].get("fill"),/^url\(/.test(r))&&(u=r.slice(5,r.length-1),t.gradientDefs[u]&&n[i].set("fill",t.Gradient.fromElement(t.gradientDefs[u],n[i])))},getGradientDefs:function(n){for(var u=n.getElementsByTagName("linearGradient"),f=n.getElementsByTagName("radialGradient"),t,r={},i=u.length;i--;)t=u[i],r[t.getAttribute("id")]=t;for(i=f.length;i--;)t=f[i],r[t.getAttribute("id")]=t;return r},parseAttributes:function(n,r){var u,o,s;if(n)return o={},n.parentNode&&/^g$/i.test(n.parentNode.nodeName)&&(o=t.parseAttributes(n.parentNode,r)),s=r.reduce(function(t,i){return u=n.getAttribute(i),u&&(i=f(i),u=e(i,u,o),t[i]=u),t},{}),s=i(s,i(b(n),t.parseStyleAttribute(n))),y(i(o,s))},parseElements:function(n,i,r,u){t.ElementsParser.parse(n,i,r,u)},parseStyleAttribute:function(n){var t={},i=n.getAttribute("style");return i?(typeof i=="string"?p(i,t):w(i,t),t):t},parsePointsAttribute:function(n){var f,i,t,r,u;if(!n)return null;if(n=n.trim(),f=n.indexOf(",")>-1,n=n.split(/\s+/),i=[],f)for(t=0,r=n.length;t<r;t++)u=n[t].split(","),i.push({x:parseFloat(u[0]),y:parseFloat(u[1])});else for(t=0,r=n.length;t<r;t+=2)i.push({x:parseFloat(n[t]),y:parseFloat(n[t+1])});return i.length%2!=0,i},getCSSRules:function(n){for(var r,u=n.getElementsByTagName("style"),t={},i,f=0,e=u.length;f<e;f++)r=u[0].textContent,r=r.replace(/\/\*[\s\S]*?\*\//g,""),i=r.match(/[^{]*\{[\s\S]*?\}/g),i=i.map(function(n){return n.trim()}),i.forEach(function(n){var u=n.match(/([\s\S]*?)\s*\{([^}]*)\}/),f,r,i,e;for(n=u[1],f=u[2].trim(),r=f.replace(/;$/,"").split(/\s*;\s*/),t[n]||(t[n]={}),i=0,e=r.length;i<e;i++){var o=r[i].split(/\s*:\s*/),s=o[0],h=o[1];t[n][s]=h}});return t},loadSVGFromURL:function(n,i,r){function f(f){var e=f.responseXML;(!e.documentElement&&t.window.ActiveXObject&&f.responseText&&(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(f.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),e.documentElement)&&t.parseSVGDocument(e.documentElement,function(r,f){u.set(n,{objects:t.util.array.invoke(r,"toObject"),options:f});i(r,f)},r)}n=n.replace(/^\n\s*/,"").trim();u.has(n,function(r){r?u.get(n,function(n){var t=k(n);i(t.objects,t.options)}):new t.util.request(n,{method:"get",onComplete:f})})},loadSVGFromString:function(n,i,r){var u,f;n=n.trim();typeof DOMParser!="undefined"?(f=new DOMParser,f&&f.parseFromString&&(u=f.parseFromString(n,"text/xml"))):t.window.ActiveXObject&&(u=new ActiveXObject("Microsoft.XMLDOM"),u.async="false",u.loadXML(n.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));t.parseSVGDocument(u.documentElement,function(n,t){i(n,t)},r)},createSVGFontFacesMarkup:function(n){for(var i="",t=0,r=n.length;t<r;t++)n[t].type==="text"&&n[t].path&&(i+=["@font-face {","font-family: ",n[t].fontFamily,"; ","src: url('",n[t].path,"')","}"].join(""));return i&&(i=['<style type="text/css">',"<![CDATA[",i,"]\]>","<\/style>"].join("")),i},createSVGRefElementsMarkup:function(n){var t=[];return h(t,n,"backgroundColor"),h(t,n,"overlayColor"),t.join("")}})}(typeof exports!="undefined"?exports:this);fabric.ElementsParser={parse:function(n,t,i,r){this.elements=n;this.callback=t;this.options=i;this.reviver=r;this.instances=new Array(n.length);this.numElements=n.length;this.createObjects()},createObjects:function(){for(var n=0,t=this.elements.length;n<t;n++)this.createObject(this.elements[n],n)},createObject:function(n,t){var i=fabric[fabric.util.string.capitalize(n.tagName)];if(i&&i.fromElement)try{this._createObject(i,n,t)}catch(r){fabric.log(r)}else this.checkIfDone()},_createObject:function(n,t,i){if(n.async)n.fromElement(t,this.createCallback(i,t),this.options);else{var r=n.fromElement(t,this.options);this.reviver&&this.reviver(t,r);this.instances.splice(i,0,r);this.checkIfDone()}},createCallback:function(n,t){var i=this;return function(r){i.reviver&&i.reviver(t,r);i.instances.splice(n,0,r);i.checkIfDone()}},checkIfDone:function(){--this.numElements==0&&(this.instances=this.instances.filter(function(n){return n!=null}),fabric.resolveGradients(this.instances),this.callback(this.instances))}},function(n){"use strict";function t(n,t){this.x=n;this.y=t}var i=n.fabric||(n.fabric={});if(i.Point){i.warn("fabric.Point is already defined");return}i.Point=t;t.prototype={constructor:t,add:function(n){return new t(this.x+n.x,this.y+n.y)},addEquals:function(n){return this.x+=n.x,this.y+=n.y,this},scalarAdd:function(n){return new t(this.x+n,this.y+n)},scalarAddEquals:function(n){return this.x+=n,this.y+=n,this},subtract:function(n){return new t(this.x-n.x,this.y-n.y)},subtractEquals:function(n){return this.x-=n.x,this.y-=n.y,this},scalarSubtract:function(n){return new t(this.x-n,this.y-n)},scalarSubtractEquals:function(n){return this.x-=n,this.y-=n,this},multiply:function(n){return new t(this.x*n,this.y*n)},multiplyEquals:function(n){return this.x*=n,this.y*=n,this},divide:function(n){return new t(this.x/n,this.y/n)},divideEquals:function(n){return this.x/=n,this.y/=n,this},eq:function(n){return this.x===n.x&&this.y===n.y},lt:function(n){return this.x<n.x&&this.y<n.y},lte:function(n){return this.x<=n.x&&this.y<=n.y},gt:function(n){return this.x>n.x&&this.y>n.y},gte:function(n){return this.x>=n.x&&this.y>=n.y},lerp:function(n,i){return new t(this.x+(n.x-this.x)*i,this.y+(n.y-this.y)*i)},distanceFrom:function(n){var t=this.x-n.x,i=this.y-n.y;return Math.sqrt(t*t+i*i)},midPointFrom:function(n){return new t(this.x+(n.x-this.x)/2,this.y+(n.y-this.y)/2)},min:function(n){return new t(Math.min(this.x,n.x),Math.min(this.y,n.y))},max:function(n){return new t(Math.max(this.x,n.x),Math.max(this.y,n.y))},toString:function(){return this.x+","+this.y},setXY:function(n,t){this.x=n;this.y=t},setFromPoint:function(n){this.x=n.x;this.y=n.y},swap:function(n){var t=this.x,i=this.y;this.x=n.x;this.y=n.y;n.x=t;n.y=i}}}(typeof exports!="undefined"?exports:this),function(n){"use strict";function t(n){this.status=n;this.points=[]}var i=n.fabric||(n.fabric={});if(i.Intersection){i.warn("fabric.Intersection is already defined");return}i.Intersection=t;i.Intersection.prototype={appendPoint:function(n){this.points.push(n)},appendPoints:function(n){this.points=this.points.concat(n)}};i.Intersection.intersectLineLine=function(n,r,u,f){var e,c=(f.x-u.x)*(n.y-u.y)-(f.y-u.y)*(n.x-u.x),l=(r.x-n.x)*(n.y-u.y)-(r.y-n.y)*(n.x-u.x),s=(f.y-u.y)*(r.x-n.x)-(f.x-u.x)*(r.y-n.y),o,h;return s!==0?(o=c/s,h=l/s,0<=o&&o<=1&&0<=h&&h<=1?(e=new t("Intersection"),e.points.push(new i.Point(n.x+o*(r.x-n.x),n.y+o*(r.y-n.y)))):e=new t):e=c===0||l===0?new t("Coincident"):new t("Parallel"),e};i.Intersection.intersectLinePolygon=function(n,i,r){for(var u=new t,e=r.length,f=0;f<e;f++){var o=r[f],s=r[(f+1)%e],h=t.intersectLineLine(n,i,o,s);u.appendPoints(h.points)}return u.points.length>0&&(u.status="Intersection"),u};i.Intersection.intersectPolygonPolygon=function(n,i){for(var r=new t,f=n.length,u=0;u<f;u++){var e=n[u],o=n[(u+1)%f],s=t.intersectLinePolygon(e,o,i);r.appendPoints(s.points)}return r.points.length>0&&(r.status="Intersection"),r};i.Intersection.intersectPolygonRectangle=function(n,r,u){var e=r.min(u),o=r.max(u),s=new i.Point(o.x,e.y),h=new i.Point(e.x,o.y),c=t.intersectLinePolygon(e,s,n),l=t.intersectLinePolygon(s,o,n),a=t.intersectLinePolygon(o,h,n),v=t.intersectLinePolygon(h,e,n),f=new t;return f.appendPoints(c.points),f.appendPoints(l.points),f.appendPoints(a.points),f.appendPoints(v.points),f.points.length>0&&(f.status="Intersection"),f}}(typeof exports!="undefined"?exports:this),function(n){"use strict";function t(n){n?this._tryParsingColor(n):this.setSource([0,0,0,1])}function r(n,t,i){return(i<0&&(i+=1),i>1&&(i-=1),i<1/6)?n+(t-n)*6*i:i<1/2?t:i<2/3?n+(t-n)*(2/3-i)*6:n}var i=n.fabric||(n.fabric={});if(i.Color){i.warn("fabric.Color is already defined.");return}i.Color=t;i.Color.prototype={_tryParsingColor:function(n){var i;n in t.colorNameMap&&(n=t.colorNameMap[n]);i=t.sourceFromHex(n);i||(i=t.sourceFromRgb(n));i||(i=t.sourceFromHsl(n));i&&this.setSource(i)},_rgbToHsl:function(n,t,r){var f,s,h,u,e,o;if(n/=255,t/=255,r/=255,u=i.util.array.max([n,t,r]),e=i.util.array.min([n,t,r]),h=(u+e)/2,u===e)f=s=0;else{o=u-e;s=h>.5?o/(2-u-e):o/(u+e);switch(u){case n:f=(t-r)/o+(t<r?6:0);break;case t:f=(r-n)/o+2;break;case r:f=(n-t)/o+4}f/=6}return[Math.round(f*360),Math.round(s*100),Math.round(h*100)]},getSource:function(){return this._source},setSource:function(n){this._source=n},toRgb:function(){var n=this.getSource();return"rgb("+n[0]+","+n[1]+","+n[2]+")"},toRgba:function(){var n=this.getSource();return"rgba("+n[0]+","+n[1]+","+n[2]+","+n[3]+")"},toHsl:function(){var n=this.getSource(),t=this._rgbToHsl(n[0],n[1],n[2]);return"hsl("+t[0]+","+t[1]+"%,"+t[2]+"%)"},toHsla:function(){var n=this.getSource(),t=this._rgbToHsl(n[0],n[1],n[2]);return"hsla("+t[0]+","+t[1]+"%,"+t[2]+"%,"+n[3]+")"},toHex:function(){var r=this.getSource(),i=r[0].toString(16),n,t;return i=i.length===1?"0"+i:i,n=r[1].toString(16),n=n.length===1?"0"+n:n,t=r[2].toString(16),t=t.length===1?"0"+t:t,i.toUpperCase()+n.toUpperCase()+t.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(n){var t=this.getSource();return t[3]=n,this.setSource(t),this},toGrayscale:function(){var n=this.getSource(),t=parseInt((n[0]*.3+n[1]*.59+n[2]*.11).toFixed(0),10),i=n[3];return this.setSource([t,t,t,i]),this},toBlackWhite:function(n){var i=this.getSource(),t=(i[0]*.3+i[1]*.59+i[2]*.11).toFixed(0),r=i[3];return n=n||127,t=Number(t)<Number(n)?0:255,this.setSource([t,t,t,r]),this},overlayWith:function(n){var i;n instanceof t||(n=new t(n));var r=[],f=this.getAlpha(),u=.5,e=this.getSource(),o=n.getSource();for(i=0;i<3;i++)r.push(Math.round(e[i]*(1-u)+o[i]*u));return r[3]=f,this.setSource(r),this}};i.Color.reRGBa=/^rgba?\(\s*(\d{1,3}\%?)\s*,\s*(\d{1,3}\%?)\s*,\s*(\d{1,3}\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;i.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;i.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i;i.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"};i.Color.fromRgb=function(n){return t.fromSource(t.sourceFromRgb(n))};i.Color.sourceFromRgb=function(n){var i=n.match(t.reRGBa);if(i){var r=parseInt(i[1],10)/(/%$/.test(i[1])?100:1)*(/%$/.test(i[1])?255:1),u=parseInt(i[2],10)/(/%$/.test(i[2])?100:1)*(/%$/.test(i[2])?255:1),f=parseInt(i[3],10)/(/%$/.test(i[3])?100:1)*(/%$/.test(i[3])?255:1);return[parseInt(r,10),parseInt(u,10),parseInt(f,10),i[4]?parseFloat(i[4]):1]}};i.Color.fromRgba=t.fromRgb;i.Color.fromHsl=function(n){return t.fromSource(t.sourceFromHsl(n))};i.Color.sourceFromHsl=function(n){var i=n.match(t.reHSLa),f,o;if(i){var s=(parseFloat(i[1])%360+360)%360/360,e=parseFloat(i[2])/(/%$/.test(i[2])?100:1),u=parseFloat(i[3])/(/%$/.test(i[3])?100:1),h,c,l;return e===0?h=c=l=u:(f=u<=.5?u*(e+1):u+e-u*e,o=u*2-f,h=r(o,f,s+1/3),c=r(o,f,s),l=r(o,f,s-1/3)),[Math.round(h*255),Math.round(c*255),Math.round(l*255),i[4]?parseFloat(i[4]):1]}};i.Color.fromHsla=t.fromHsl;i.Color.fromHex=function(n){return t.fromSource(t.sourceFromHex(n))};i.Color.sourceFromHex=function(n){if(n.match(t.reHex)){var i=n.slice(n.indexOf("#")+1),r=i.length===3,u=r?i.charAt(0)+i.charAt(0):i.substring(0,2),f=r?i.charAt(1)+i.charAt(1):i.substring(2,4),e=r?i.charAt(2)+i.charAt(2):i.substring(4,6);return[parseInt(u,16),parseInt(f,16),parseInt(e,16),1]}};i.Color.fromSource=function(n){var i=new t;return i.setSource(n),i}}(typeof exports!="undefined"?exports:this),function(){function i(n){var e=n.getAttribute("style"),u=n.getAttribute("offset"),t,r,i,f;if(u=parseFloat(u)/(/%$/.test(u)?100:1),e)for(i=e.split(/\s*;\s*/),i[i.length-1]===""&&i.pop(),f=i.length;f--;){var o=i[f].split(/\s*:\s*/),s=o[0].trim(),h=o[1].trim();s==="stop-color"?t=h:s==="stop-opacity"&&(r=h)}return t||(t=n.getAttribute("stop-color")||"rgb(0,0,0)"),r||(r=n.getAttribute("stop-opacity")),t=new fabric.Color(t).toRgb(),{offset:u,color:t,opacity:isNaN(parseFloat(r))?1:parseFloat(r)}}function r(n){return{x1:n.getAttribute("x1")||0,y1:n.getAttribute("y1")||0,x2:n.getAttribute("x2")||"100%",y2:n.getAttribute("y2")||0}}function u(n){return{x1:n.getAttribute("fx")||n.getAttribute("cx")||"50%",y1:n.getAttribute("fy")||n.getAttribute("cy")||"50%",r1:0,x2:n.getAttribute("cx")||"50%",y2:n.getAttribute("cy")||"50%",r2:n.getAttribute("r")||"50%"}}function n(n,i){var r,u;for(r in i)typeof i[r]=="string"&&/^\d+%$/.test(i[r])&&(u=parseFloat(i[r],10),r==="x1"||r==="x2"||r==="r2"?i[r]=fabric.util.toFixed(n.width*u/100,2):(r==="y1"||r==="y2")&&(i[r]=fabric.util.toFixed(n.height*u/100,2))),t(i,r,n)}function t(n,t,i){t==="x1"||t==="x2"?n[t]-=fabric.util.toFixed(i.width/2,2):(t==="y1"||t==="y2")&&(n[t]-=fabric.util.toFixed(i.height/2,2))}function f(n,i){for(var r in i)t(i,r,n),r==="x1"||r==="x2"||r==="r2"?i[r]=fabric.util.toFixed(i[r]/n.width*100,2)+"%":(r==="y1"||r==="y2")&&(i[r]=fabric.util.toFixed(i[r]/n.height*100,2)+"%")}fabric.Gradient=fabric.util.createClass({initialize:function(n){n||(n={});var t={};this.id=fabric.Object.__uid++;this.type=n.type||"linear";t={x1:n.coords.x1||0,y1:n.coords.y1||0,x2:n.coords.x2||0,y2:n.coords.y2||0};this.type==="radial"&&(t.r1=n.coords.r1||0,t.r2=n.coords.r2||0);this.coords=t;this.gradientUnits=n.gradientUnits||"objectBoundingBox";this.colorStops=n.colorStops.slice()},addColorStop:function(n){var t,i;for(t in n)i=new fabric.Color(n[t]),this.colorStops.push({offset:t,color:i.toRgb(),opacity:i.getAlpha()});return this},toObject:function(){return{type:this.type,coords:this.coords,gradientUnits:this.gradientUnits,colorStops:this.colorStops}},toSVG:function(n,t){var i=fabric.util.object.clone(this.coords),u,r;for(this.colorStops.sort(function(n,t){return n.offset-t.offset}),t&&this.gradientUnits==="userSpaceOnUse"?(i.x1+=n.width/2,i.y1+=n.height/2,i.x2+=n.width/2,i.y2+=n.height/2):this.gradientUnits==="objectBoundingBox"&&f(n,i),this.type==="linear"?u=["<linearGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" x1="',i.x1,'" y1="',i.y1,'" x2="',i.x2,'" y2="',i.y2,'">']:this.type==="radial"&&(u=["<radialGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" cx="',i.x2,'" cy="',i.y2,'" r="',i.r2,'" fx="',i.x1,'" fy="',i.y1,'">']),r=0;r<this.colorStops.length;r++)u.push("<stop ",'offset="',this.colorStops[r].offset*100+"%",'" style="stop-color:',this.colorStops[r].color,this.colorStops[r].opacity?";stop-opacity: "+this.colorStops[r].opacity:";",'"/>');return u.push(this.type==="linear"?"<\/linearGradient>":"<\/radialGradient>"),u.join("")},toLive:function(n){var i,t,u;if(this.type){for(this.type==="linear"?i=n.createLinearGradient(this.coords.x1,this.coords.y1,this.coords.x2,this.coords.y2):this.type==="radial"&&(i=n.createRadialGradient(this.coords.x1,this.coords.y1,this.coords.r1,this.coords.x2,this.coords.y2,this.coords.r2)),t=0,u=this.colorStops.length;t<u;t++){var r=this.colorStops[t].color,f=this.colorStops[t].opacity,e=this.colorStops[t].offset;typeof f!="undefined"&&(r=new fabric.Color(r).setAlpha(f).toRgba());i.addColorStop(parseFloat(e),r)}return i}}});fabric.util.object.extend(fabric.Gradient,{fromElement:function(t,f){var h=t.getElementsByTagName("stop"),o=t.nodeName==="linearGradient"?"linear":"radial",l=t.getAttribute("gradientUnits")||"objectBoundingBox",c=[],e={},s;for(o==="linear"?e=r(t):o==="radial"&&(e=u(t)),s=h.length;s--;)c.push(i(h[s]));return n(f,e),new fabric.Gradient({type:o,coords:e,gradientUnits:l,colorStops:c})},forObject:function(t,i){return i||(i={}),n(t,i),new fabric.Gradient(i)}})}();fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(n){if(n||(n={}),this.id=fabric.Object.__uid++,n.source)if(typeof n.source=="string")if(typeof fabric.util.getFunctionBody(n.source)!="undefined")this.source=new Function(fabric.util.getFunctionBody(n.source));else{var t=this;this.source=fabric.util.createImage();fabric.util.loadImage(n.source,function(n){t.source=n})}else this.source=n.source;n.repeat&&(this.repeat=n.repeat);n.offsetX&&(this.offsetX=n.offsetX);n.offsetY&&(this.offsetY=n.offsetY)},toObject:function(){var n;return typeof this.source=="function"?n=String(this.source):typeof this.source.src=="string"&&(n=this.source.src),{source:n,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(n){var t=typeof this.source=="function"?this.source():this.source,r=t.width/n.getWidth(),u=t.height/n.getHeight(),i="";return t.src?i=t.src:t.toDataURL&&(i=t.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+this.offsetX+'" y="'+this.offsetY+'" width="'+r+'" height="'+u+'"><image x="0" y="0" width="'+t.width+'" height="'+t.height+'" xlink:href="'+i+'"><\/image><\/pattern>'},toLive:function(n){var t=typeof this.source=="function"?this.source():this.source;return typeof t.src!="undefined"&&(!t.complete||t.naturalWidth===0||t.naturalHeight===0)?"":n.createPattern(t,this.repeat)}}),function(n){"use strict";var t=n.fabric||(n.fabric={});if(t.Shadow){t.warn("fabric.Shadow is already defined.");return}t.Shadow=t.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(n){typeof n=="string"&&(n=this._parseShadow(n));for(var i in n)this[i]=n[i];this.id=t.Object.__uid++},_parseShadow:function(n){var r=n.trim(),i=t.Shadow.reOffsetsAndBlur.exec(r)||[],u=r.replace(t.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:u.trim(),offsetX:parseInt(i[1],10)||0,offsetY:parseInt(i[2],10)||0,blur:parseInt(i[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(n){var t="SourceAlpha";return n&&(n.fill===this.color||n.stroke===this.color)&&(t="SourceGraphic"),'<filter id="SVGID_'+this.id+'" y="-40%" height="180%"><feGaussianBlur in="'+t+'" stdDeviation="'+(this.blur?this.blur/3:0)+'"><\/feGaussianBlur><feOffset dx="'+this.offsetX+'" dy="'+this.offsetY+'"><\/feOffset><feMerge><feMergeNode><\/feMergeNode><feMergeNode in="SourceGraphic"><\/feMergeNode><\/feMerge><\/filter>'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY};var n={},i=t.Shadow.prototype;return this.color!==i.color&&(n.color=this.color),this.blur!==i.blur&&(n.blur=this.blur),this.offsetX!==i.offsetX&&(n.offsetX=this.offsetX),this.offsetY!==i.offsetY&&(n.offsetY=this.offsetY),n}});t.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/}(typeof exports!="undefined"?exports:this),function(){"use strict";if(fabric.StaticCanvas){fabric.warn("fabric.StaticCanvas is already defined.");return}var n=fabric.util.object.extend,r=fabric.util.getElementOffset,t=fabric.util.removeFromArray,i=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(n,t){t||(t={});this._initStatic(n,t);fabric.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,onBeforeScaleRotate:function(){},_initStatic:function(n,t){this._objects=[];this._createLowerCanvas(n);this._initOptions(t);t.overlayImage&&this.setOverlayImage(t.overlayImage,this.renderAll.bind(this));t.backgroundImage&&this.setBackgroundImage(t.backgroundImage,this.renderAll.bind(this));t.backgroundColor&&this.setBackgroundColor(t.backgroundColor,this.renderAll.bind(this));t.overlayColor&&this.setOverlayColor(t.overlayColor,this.renderAll.bind(this));this.calcOffset()},calcOffset:function(){return this._offset=r(this.lowerCanvasEl),this},setOverlayImage:function(n,t,i){return this.__setBgOverlayImage("overlayImage",n,t,i)},setBackgroundImage:function(n,t,i){return this.__setBgOverlayImage("backgroundImage",n,t,i)},setOverlayColor:function(n,t){return this.__setBgOverlayColor("overlayColor",n,t)},setBackgroundColor:function(n,t){return this.__setBgOverlayColor("backgroundColor",n,t)},__setBgOverlayImage:function(n,t,i,r){return typeof t=="string"?fabric.util.loadImage(t,function(t){this[n]=new fabric.Image(t,r);i&&i()},this):(this[n]=t,i&&i()),this},__setBgOverlayColor:function(n,t,i){if(t.source){var r=this;fabric.util.loadImage(t.source,function(u){r[n]=new fabric.Pattern({source:u,repeat:t.repeat,offsetX:t.offsetX,offsetY:t.offsetY});i&&i()})}else this[n]=t,i&&i();return this},_createCanvasElement:function(){var n=fabric.document.createElement("canvas");if(n.style||(n.style={}),!n)throw i;return this._initCanvasElement(n),n},_initCanvasElement:function(n){if(fabric.util.createCanvasElement(n),typeof n.getContext=="undefined")throw i;},_initOptions:function(n){for(var t in n)this[t]=n[t];(this.width=parseInt(this.lowerCanvasEl.width,10)||0,this.height=parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style)&&(this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px")},_createLowerCanvas:function(n){this.lowerCanvasEl=fabric.util.getById(n)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(n){return this._setDimension("width",n)},setHeight:function(n){return this._setDimension("height",n)},setDimensions:function(n){for(var t in n)this._setDimension(t,n[t]);return this},_setDimension:function(n,t){return this.lowerCanvasEl[n]=t,this.lowerCanvasEl.style[n]=t+"px",this.upperCanvasEl&&(this.upperCanvasEl[n]=t,this.upperCanvasEl.style[n]=t+"px"),this.cacheCanvasEl&&(this.cacheCanvasEl[n]=t),this.wrapperEl&&(this.wrapperEl.style[n]=t+"px"),this[n]=t,this.calcOffset(),this.renderAll(),this},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(n,t){if(t)if(this.controlsAboveOverlay){var i=t.hasBorders,r=t.hasControls;t.hasBorders=t.hasControls=!1;t.render(n);t.hasBorders=i;t.hasControls=r}else t.render(n)},_onObjectAdded:function(n){this.stateful&&n.setupState();n.setCoords();n.canvas=this;this.fire("object:added",{target:n});n.fire("added")},_onObjectRemoved:function(n){this.getActiveObject()===n&&(this.fire("before:selection:cleared",{target:n}),this._discardActiveObject(),this.fire("selection:cleared"));this.fire("object:removed",{target:n});n.fire("removed")},clearContext:function(n){return n.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.discardActiveGroup&&this.discardActiveGroup(),this.discardActiveObject&&this.discardActiveObject(),this.clearContext(this.contextContainer),this.contextTop&&this.clearContext(this.contextTop),this.fire("canvas:cleared"),this.renderAll(),this},renderAll:function(n){var t=this[n===!0&&this.interactive?"contextTop":"contextContainer"],i=this.getActiveGroup();return this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop),n||this.clearContext(t),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,t),this._renderBackground(t),this._renderObjects(t,i),this._renderActiveGroup(t,i),this.clipTo&&t.restore(),this._renderOverlay(t),this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.fire("after:render"),this},_renderObjects:function(n,t){for(var i=0,r=this._objects.length;i<r;++i)(!t||t&&this._objects[i]&&!t.contains(this._objects[i]))&&this._draw(n,this._objects[i])},_renderActiveGroup:function(n,t){if(t){var i=[];this.forEachObject(function(n){t.contains(n)&&i.push(n)});t._set("objects",i);this._draw(n,t)}},_renderBackground:function(n){this.backgroundColor&&(n.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(n):this.backgroundColor,n.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height));this.backgroundImage&&this.backgroundImage.render(n)},_renderOverlay:function(n){this.overlayColor&&(n.fillStyle=this.overlayColor.toLive?this.overlayColor.toLive(n):this.overlayColor,n.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height));this.overlayImage&&this.overlayImage.render(n)},renderTop:function(){var n=this.contextTop||this.contextContainer,t;return this.clearContext(n),this.selection&&this._groupSelector&&this._drawSelection(),t=this.getActiveGroup(),t&&t.render(n),this.overlayImage&&n.drawImage(this.overlayImage,this.overlayImageLeft,this.overlayImageTop),this.fire("after:render"),this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(n){return this._centerObject(n,new fabric.Point(this.getCenter().left,n.getCenterPoint().y)),this.renderAll(),this},centerObjectV:function(n){return this._centerObject(n,new fabric.Point(n.getCenterPoint().x,this.getCenter().top)),this.renderAll(),this},centerObject:function(n){var t=this.getCenter();return this._centerObject(n,new fabric.Point(t.left,t.top)),this.renderAll(),this},_centerObject:function(n,t){return n.setPositionByOrigin(t,"center","center"),this},toDatalessJSON:function(n){return this.toDatalessObject(n)},toObject:function(n){return this._toObjectMethod("toObject",n)},toDatalessObject:function(n){return this._toObjectMethod("toDatalessObject",n)},_toObjectMethod:function(t,i){var r=this.getActiveGroup(),u;return r&&this.discardActiveGroup(),u={objects:this._toObjects(t,i)},n(u,this.__serializeBgOverlay()),fabric.util.populateWithProperties(this,u,i),r&&(this.setActiveGroup(new fabric.Group(r.getObjects())),r.forEachObject(function(n){n.set("active",!0)})),u},_toObjects:function(n,t){return this.getObjects().map(function(i){return this._toObject(i,n,t)},this)},_toObject:function(n,t,i){var r,u;return this.includeDefaultValues||(r=n.includeDefaultValues,n.includeDefaultValues=!1),u=n[t](i),this.includeDefaultValues||(n.includeDefaultValues=r),u},__serializeBgOverlay:function(){var n={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};return this.overlayColor&&(n.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor),this.backgroundImage&&(n.backgroundImage=this.backgroundImage.toObject()),this.overlayImage&&(n.overlayImage=this.overlayImage.toObject()),n},toSVG:function(n,t){n||(n={});var i=[];return this._setSVGPreamble(i,n),this._setSVGHeader(i,n),this._setSVGBgOverlayColor(i,"backgroundColor"),this._setSVGBgOverlayImage(i,"backgroundImage"),this._setSVGObjects(i,t),this._setSVGBgOverlayColor(i,"overlayColor"),this._setSVGBgOverlayImage(i,"overlayImage"),i.push("<\/svg>"),i.join("")},_setSVGPreamble:function(n,t){t.suppressPreamble||n.push('<?xml version="1.0" encoding="',t.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(n,t){n.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',t.viewBox?t.viewBox.width:this.width,'" ','height="',t.viewBox?t.viewBox.height:this.height,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,t.viewBox?'viewBox="'+t.viewBox.x+" "+t.viewBox.y+" "+t.viewBox.width+" "+t.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"<\/desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"<\/defs>")},_setSVGObjects:function(n,t){var i=this.getActiveGroup();i&&this.discardActiveGroup();for(var r=0,u=this.getObjects(),f=u.length;r<f;r++)n.push(u[r].toSVG(t));i&&(this.setActiveGroup(new fabric.Group(i.getObjects())),i.forEachObject(function(n){n.set("active",!0)}))},_setSVGBgOverlayImage:function(n,t){this[t]&&this[t].toSVG&&n.push(this[t].toSVG())},_setSVGBgOverlayColor:function(n,t){this[t]&&this[t].source?n.push('<rect x="',this[t].offsetX,'" y="',this[t].offsetY,'" ','width="',this[t].repeat==="repeat-y"||this[t].repeat==="no-repeat"?this[t].source.width:this.width,'" height="',this[t].repeat==="repeat-x"||this[t].repeat==="no-repeat"?this[t].source.height:this.height,'" fill="url(#'+t+'Pattern)"',"><\/rect>"):this[t]&&t==="overlayColor"&&n.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[t],'"',"><\/rect>")},sendToBack:function(n){return t(this._objects,n),this._objects.unshift(n),this.renderAll&&this.renderAll()},bringToFront:function(n){return t(this._objects,n),this._objects.push(n),this.renderAll&&this.renderAll()},sendBackwards:function(n,i){var r=this._objects.indexOf(n),u;return r!==0&&(u=this._findNewLowerIndex(n,r,i),t(this._objects,n),this._objects.splice(u,0,n),this.renderAll&&this.renderAll()),this},_findNewLowerIndex:function(n,t,i){var u,r,f;if(i){for(u=t,r=t-1;r>=0;--r)if(f=n.intersectsWithObject(this._objects[r])||n.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(n),f){u=r;break}}else u=t-1;return u},bringForward:function(n,i){var r=this._objects.indexOf(n),u;return r!==this._objects.length-1&&(u=this._findNewUpperIndex(n,r,i),t(this._objects,n),this._objects.splice(u,0,n),this.renderAll&&this.renderAll()),this},_findNewUpperIndex:function(n,t,i){var u,r,f;if(i){for(u=t,r=t+1;r<this._objects.length;++r)if(f=n.intersectsWithObject(this._objects[r])||n.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(n),f){u=r;break}}else u=t+1;return u},moveTo:function(n,i){return t(this._objects,n),this._objects.splice(i,0,n),this.renderAll&&this.renderAll()},dispose:function(){return this.clear(),this.interactive&&this.removeListeners(),this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}});n(fabric.StaticCanvas.prototype,fabric.Observable);n(fabric.StaticCanvas.prototype,fabric.Collection);n(fabric.StaticCanvas.prototype,fabric.DataURLExporter);n(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(n){var t=fabric.util.createCanvasElement(),i;if(!t||!t.getContext||(i=t.getContext("2d"),!i))return null;switch(n){case"getImageData":return typeof i.getImageData!="undefined";case"setLineDash":return typeof i.setLineDash!="undefined";case"toDataURL":return typeof t.toDataURL!="undefined";case"toDataURLWithQuality":try{return t.toDataURL("image/jpeg",0),!0}catch(r){}return!1;default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}();fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",setShadow:function(n){return this.shadow=new fabric.Shadow(n),this},_setBrushStyles:function(){var n=this.canvas.contextTop;n.strokeStyle=this.color;n.lineWidth=this.width;n.lineCap=this.strokeLineCap;n.lineJoin=this.strokeLineJoin},_setShadow:function(){if(this.shadow){var n=this.canvas.contextTop;n.shadowColor=this.shadow.color;n.shadowBlur=this.shadow.blur;n.shadowOffsetX=this.shadow.offsetX;n.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var n=this.canvas.contextTop;n.shadowColor="";n.shadowBlur=n.shadowOffsetX=n.shadowOffsetY=0}}),function(){var n=fabric.util.array.min,t=fabric.util.array.max;fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(n){this.canvas=n;this._points=[]},onMouseDown:function(n){this._prepareForDrawing(n);this._captureDrawingPath(n);this._render()},onMouseMove:function(n){this._captureDrawingPath(n);this.canvas.clearContext(this.canvas.contextTop);this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(n){var t=new fabric.Point(n.x,n.y);this._reset();this._addPoint(t);this.canvas.contextTop.moveTo(t.x,t.y)},_addPoint:function(n){this._points.push(n)},_reset:function(){this._points.length=0;this._setBrushStyles();this._setShadow()},_captureDrawingPath:function(n){var t=new fabric.Point(n.x,n.y);this._addPoint(t)},_render:function(){var i=this.canvas.contextTop,n,t,r,f,u;for(i.beginPath(),n=this._points[0],t=this._points[1],this._points.length===2&&n.x===t.x&&n.y===t.y&&(n.x-=.5,t.x+=.5),i.moveTo(n.x,n.y),r=1,f=this._points.length;r<f;r++)u=n.midPointFrom(t),i.quadraticCurveTo(n.x,n.y,u.x,u.y),n=this._points[r],t=this._points[r+1];i.lineTo(n.x,n.y);i.stroke()},_getSVGPathData:function(){return this.box=this.getPathBoundingBox(this._points),this.convertPointsToSVGPath(this._points,this.box.minx,this.box.maxx,this.box.miny,this.box.maxy)},getPathBoundingBox:function(i){for(var o,r=[],u=[],f=i[0],h=i[1],s=f,e=1,c=i.length;e<c;e++)o=f.midPointFrom(h),r.push(s.x),r.push(o.x),u.push(s.y),u.push(o.y),f=i[e],h=i[e+1],s=o;return r.push(f.x),u.push(f.y),{minx:n(r),miny:n(u),maxx:t(r),maxy:t(u)}},convertPointsToSVGPath:function(n,t,i,r){var e=[],f=new fabric.Point(n[0].x-t,n[0].y-r),s=new fabric.Point(n[1].x-t,n[1].y-r),u,h,o;for(e.push("M ",n[0].x-t," ",n[0].y-r," "),u=1,h=n.length;u<h;u++)o=f.midPointFrom(s),e.push("Q ",f.x," ",f.y," ",o.x," ",o.y," "),f=new fabric.Point(n[u].x-t,n[u].y-r),u+1<n.length&&(s=new fabric.Point(n[u+1].x-t,n[u+1].y-r));return e.push("L ",f.x," ",f.y," "),e},createPath:function(n){var t=new fabric.Path(n);return t.fill=null,t.stroke=this.color,t.strokeWidth=this.width,t.strokeLineCap=this.strokeLineCap,t.strokeLineJoin=this.strokeLineJoin,this.shadow&&(this.shadow.affectStroke=!0,t.setShadow(this.shadow)),t},_finalizeAndAddPath:function(){var u=this.canvas.contextTop,t,i,r,n;if(u.closePath(),t=this._getSVGPathData().join(""),t==="M 0 0 Q 0 0 0 0 L 0 0"){this.canvas.renderAll();return}i=this.box.minx+(this.box.maxx-this.box.minx)/2;r=this.box.miny+(this.box.maxy-this.box.miny)/2;this.canvas.contextTop.arc(i,r,3,0,Math.PI*2,!1);n=this.createPath(t);n.set({left:i,top:r,originX:"center",originY:"center"});this.canvas.add(n);n.setCoords();this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderAll();this.canvas.fire("path:created",{path:n})}})}();fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(n){this.canvas=n;this.points=[]},drawDot:function(n){var i=this.addPoint(n),t=this.canvas.contextTop;t.fillStyle=i.fill;t.beginPath();t.arc(i.x,i.y,i.radius,0,Math.PI*2,!1);t.closePath();t.fill()},onMouseDown:function(n){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(n)},onMouseMove:function(n){this.drawDot(n)},onMouseUp:function(){var e=this.canvas.renderOnAddRemove,i,t,f,n,r,u;for(this.canvas.renderOnAddRemove=!1,i=[],t=0,f=this.points.length;t<f;t++)n=this.points[t],r=new fabric.Circle({radius:n.radius,left:n.x,top:n.y,originX:"center",originY:"center",fill:n.fill}),this.shadow&&r.setShadow(this.shadow),i.push(r);u=new fabric.Group(i,{originX:"center",originY:"center"});this.canvas.add(u);this.canvas.fire("path:created",{path:u});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=e;this.canvas.renderAll()},addPoint:function(n){var t=new fabric.Point(n.x,n.y),i=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,r=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return t.radius=i,t.fill=r,this.points.push(t),t}});fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(n){this.canvas=n;this.sprayChunks=[]},onMouseDown:function(n){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(n);this.render()},onMouseMove:function(n){this.addSprayChunk(n);this.render()},onMouseUp:function(){var s=this.canvas.renderOnAddRemove,i,r,e,t,n,o,u,f;for(this.canvas.renderOnAddRemove=!1,i=[],r=0,e=this.sprayChunks.length;r<e;r++)for(t=this.sprayChunks[r],n=0,o=t.length;n<o;n++)u=new fabric.Rect({width:t[n].width,height:t[n].width,left:t[n].x+1,top:t[n].y+1,originX:"center",originY:"center",fill:this.color}),this.shadow&&u.setShadow(this.shadow),i.push(u);this.optimizeOverlapping&&(i=this._getOptimizedRects(i));f=new fabric.Group(i,{originX:"center",originY:"center"});this.canvas.add(f);this.canvas.fire("path:created",{path:f});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=s;this.canvas.renderAll()},_getOptimizedRects:function(n){for(var u,r={},t,i=0,f=n.length;i<f;i++)t=n[i].left+""+n[i].top,r[t]||(r[t]=n[i]);u=[];for(t in r)u.push(r[t]);return u},render:function(){var t=this.canvas.contextTop,i,r,n;for(t.fillStyle=this.color,t.save(),i=0,r=this.sprayChunkPoints.length;i<r;i++)n=this.sprayChunkPoints[i],typeof n.opacity!="undefined"&&(t.globalAlpha=n.opacity),t.fillRect(n.x,n.y,n.width,n.width);t.restore()},addSprayChunk:function(n){var u,f,e,t,i,r;for(this.sprayChunkPoints=[],t=this.width/2,i=0;i<this.density;i++)u=fabric.util.getRandomInt(n.x-t,n.x+t),f=fabric.util.getRandomInt(n.y-t,n.y+t),e=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth,r={x:u,y:f,width:e},this.randomOpacity&&(r.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(r);this.sprayChunks.push(this.sprayChunkPoints)}});fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var t=20,i=fabric.document.createElement("canvas"),n=i.getContext("2d");return i.width=i.height=t+5,n.fillStyle=this.color,n.beginPath(),n.arc(t/2,t/2,t/2,0,Math.PI*2,!1),n.closePath(),n.fill(),i},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles");this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(n){var t=this.callSuper("createPath",n);return t.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()}),t}}),function(){var r=fabric.util.getPointer,f=fabric.util.degreesToRadians,e=fabric.util.radiansToDegrees,u=Math.atan2,n=Math.abs,t=.5,i;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(n,t){t||(t={});this._initStatic(n,t);this._initInteractive();this._createCacheCanvas();fabric.Canvas.activeInstance=this},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,_initInteractive:function(){this._currentTransform=null;this._groupSelector=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(n){var t=this._currentTransform;t.target.set({scaleX:t.original.scaleX,scaleY:t.original.scaleY,left:t.original.left,top:t.original.top});this._shouldCenterTransform(n,t.target)?t.action==="rotate"?this._setOriginToCenter(t.target):(t.originX!=="center"&&(t.mouseXSign=t.originX==="right"?-1:1),t.originY!=="center"&&(t.mouseYSign=t.originY==="bottom"?-1:1),t.originX="center",t.originY="center"):(t.originX=t.original.originX,t.originY=t.original.originY)},containsPoint:function(n,t){var i=this.getPointer(n),r=this._normalizePointer(t,i);return t.containsPoint(r)||t._findTargetCorner(n,this._offset)},_normalizePointer:function(n,t){var i=this.getActiveGroup(),r=t.x,u=t.y,f=i&&n.type!=="group"&&i.contains(n);return f&&(r-=i.left,u-=i.top),{x:r,y:u}},isTargetTransparent:function(n,t,i){var u=n.hasBorders,f=n.transparentCorners,r;return n.hasBorders=n.transparentCorners=!1,this._draw(this.contextCache,n),n.hasBorders=u,n.transparentCorners=f,r=fabric.util.isTransparent(this.contextCache,t,i,this.targetFindTolerance),this.clearContext(this.contextCache),r},_shouldClearSelection:function(n,t){var i=this.getActiveGroup(),r=this.getActiveObject();return!t||t&&i&&!i.contains(t)&&i!==t&&!n.shiftKey||t&&!t.evented||t&&!t.selectable&&r&&r!==t},_shouldCenterTransform:function(n,t){if(t){var i=this._currentTransform,r;return i.action==="scale"||i.action==="scaleX"||i.action==="scaleY"?r=this.centeredScaling||t.centeredScaling:i.action==="rotate"&&(r=this.centeredRotation||t.centeredRotation),r?!n.altKey:n.altKey}},_getOriginFromCorner:function(n,t){var i={x:n.originX,y:n.originY};return t==="ml"||t==="tl"||t==="bl"?i.x="right":(t==="mr"||t==="tr"||t==="br")&&(i.x="left"),t==="tl"||t==="mt"||t==="tr"?i.y="bottom":(t==="bl"||t==="mb"||t==="br")&&(i.y="top"),i},_getActionFromCorner:function(n,t){var i="drag";return t&&(i=t==="ml"||t==="mr"?"scaleX":t==="mt"||t==="mb"?"scaleY":t==="mtr"?"rotate":"scale"),i},_setupCurrentTransform:function(n,t){if(t){var e=t._findTargetCorner(n,this._offset),i=r(n,t.canvas.upperCanvasEl),o=this._getActionFromCorner(t,e),u=this._getOriginFromCorner(t,e);this._currentTransform={target:t,action:o,scaleX:t.scaleX,scaleY:t.scaleY,offsetX:i.x-t.left,offsetY:i.y-t.top,originX:u.x,originY:u.y,ex:i.x,ey:i.y,left:t.left,top:t.top,theta:f(t.angle),width:t.width*t.scaleX,mouseXSign:1,mouseYSign:1};this._currentTransform.original={left:t.left,top:t.top,scaleX:t.scaleX,scaleY:t.scaleY,originX:u.x,originY:u.y};this._resetCurrentTransform(n)}},_translateObject:function(n,t){var i=this._currentTransform.target;i.get("lockMovementX")||i.set("left",n-this._currentTransform.offsetX);i.get("lockMovementY")||i.set("top",t-this._currentTransform.offsetY)},_scaleObject:function(n,t,i){var r=this._currentTransform,e=this._offset,u=r.target,o=u.get("lockScalingX"),s=u.get("lockScalingY"),h,f;o&&s||(h=u.translateToOriginPoint(u.getCenterPoint(),r.originX,r.originY),f=u.toLocalPoint(new fabric.Point(n-e.left,t-e.top),r.originX,r.originY),this._setLocalMouse(f,r),this._setObjectScale(f,r,o,s,i),u.setPositionByOrigin(h,r.originX,r.originY))},_setObjectScale:function(n,t,i,r,u){var f=t.target;t.newScaleX=f.scaleX;t.newScaleY=f.scaleY;u!=="equally"||i||r?u?u!=="x"||f.get("lockUniScaling")?u!=="y"||f.get("lockUniScaling")||(t.newScaleY=n.y/(f.height+f.strokeWidth),r||f.set("scaleY",t.newScaleY)):(t.newScaleX=n.x/(f.width+f.strokeWidth),i||f.set("scaleX",t.newScaleX)):(t.newScaleX=n.x/(f.width+f.strokeWidth),t.newScaleY=n.y/(f.height+f.strokeWidth),i||f.set("scaleX",t.newScaleX),r||f.set("scaleY",t.newScaleY)):this._scaleObjectEqually(n,f,t);this._flipObject(t)},_scaleObjectEqually:function(n,t,i){var r=n.y+n.x,u=(t.height+t.strokeWidth)*i.original.scaleY+(t.width+t.strokeWidth)*i.original.scaleX;i.newScaleX=i.original.scaleX*r/u;i.newScaleY=i.original.scaleY*r/u;t.set("scaleX",i.newScaleX);t.set("scaleY",i.newScaleY)},_flipObject:function(n){n.newScaleX<0&&(n.originX==="left"?n.originX="right":n.originX==="right"&&(n.originX="left"));n.newScaleY<0&&(n.originY==="top"?n.originY="bottom":n.originY==="bottom"&&(n.originY="top"))},_setLocalMouse:function(t,i){var r=i.target;i.originX==="right"?t.x*=-1:i.originX==="center"&&(t.x*=i.mouseXSign*2,t.x<0&&(i.mouseXSign=-i.mouseXSign));i.originY==="bottom"?t.y*=-1:i.originY==="center"&&(t.y*=i.mouseYSign*2,t.y<0&&(i.mouseYSign=-i.mouseYSign));n(t.x)>r.padding?t.x<0?t.x+=r.padding:t.x-=r.padding:t.x=0;n(t.y)>r.padding?t.y<0?t.y+=r.padding:t.y-=r.padding:t.y=0},_rotateObject:function(n,t){var i=this._currentTransform,r=this._offset;if(!i.target.get("lockRotation")){var o=u(i.ey-i.top-r.top,i.ex-i.left-r.left),s=u(t-i.top-r.top,n-i.left-r.left),f=e(s-o+i.theta);f<0&&(f=360+f);i.target.angle=f}},_setCursor:function(n){this.upperCanvasEl.style.cursor=n},_resetObjectTransform:function(n){n.scaleX=1;n.scaleY=1;n.setAngle(0)},_drawSelection:function(){var i=this.contextTop,f=this._groupSelector,s=f.left,h=f.top,e=n(s),o=n(h),r,u;i.fillStyle=this.selectionColor;i.fillRect(f.ex-(s>0?0:-s),f.ey-(h>0?0:-h),e,o);i.lineWidth=this.selectionLineWidth;i.strokeStyle=this.selectionBorderColor;this.selectionDashArray.length>1?(r=f.ex+t-(s>0?0:e),u=f.ey+t-(h>0?0:o),i.beginPath(),fabric.util.drawDashedLine(i,r,u,r+e,u,this.selectionDashArray),fabric.util.drawDashedLine(i,r,u+o-1,r+e,u+o-1,this.selectionDashArray),fabric.util.drawDashedLine(i,r,u,r,u+o,this.selectionDashArray),fabric.util.drawDashedLine(i,r+e-1,u,r+e-1,u+o,this.selectionDashArray),i.closePath(),i.stroke()):i.strokeRect(f.ex+t-(s>0?0:e),f.ey+t-(h>0?0:o),e,o)},_isLastRenderedObject:function(n){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(n,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(n,this._offset)},findTarget:function(n,t){if(!this.skipTargetFind){if(this._isLastRenderedObject(n))return this.lastRenderedObjectWithControlsAboveOverlay;var i=this.getActiveGroup();return i&&!t&&this.containsPoint(n,i)?i:this._searchPossibleTargets(n)}},_searchPossibleTargets:function(n){for(var u,e,o,i=[],r,f=this.getPointer(n),t=this._objects.length;t--;)if(this._objects[t]&&this._objects[t].visible&&this._objects[t].evented&&this.containsPoint(n,this._objects[t]))if(this.perPixelTargetFind||this._objects[t].perPixelTargetFind)i[i.length]=this._objects[t];else{r=this._objects[t];this.relatedTarget=r;break}for(u=0,e=i.length;u<e;u++)if(f=this.getPointer(n),o=this.isTargetTransparent(i[u],f.x,f.y),!o){r=i[u];this.relatedTarget=r;break}return r},getPointer:function(n){var t=r(n,this.upperCanvasEl);return{x:t.x-this._offset.left,y:t.y-this._offset.top}},_createUpperCanvas:function(){var n=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+n);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(n){var t=this.getWidth()||n.width,i=this.getHeight()||n.height;fabric.util.setStyle(n,{position:"absolute",width:t+"px",height:i+"px",left:0,top:0});n.width=t;n.height=i;fabric.util.makeElementUnselectable(n)},_copyCanvasStyle:function(n,t){t.style.cssText=n.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(n){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=n;n.set("active",!0)},setActiveObject:function(n,t){return this._setActiveObject(n),this.renderAll(),this.fire("object:selected",{target:n,e:t}),n.fire("selected",{e:t}),this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=null},discardActiveObject:function(n){return this._discardActiveObject(),this.renderAll(),this.fire("selection:cleared",{e:n}),this},_setActiveGroup:function(n){this._activeGroup=n;n&&(n.canvas=this,n.set("active",!0))},setActiveGroup:function(n,t){return this._setActiveGroup(n),n&&(this.fire("object:selected",{target:n,e:t}),n.fire("selected",{e:t})),this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var n=this.getActiveGroup();n&&n.destroy();this.setActiveGroup(null)},discardActiveGroup:function(n){return this._discardActiveGroup(),this.fire("selection:cleared",{e:n}),this},deactivateAll:function(){for(var t=this.getObjects(),n=0,i=t.length;n<i;n++)t[n].set("active",!1);return this._discardActiveGroup(),this._discardActiveObject(),this},deactivateAllWithDispatch:function(n){var t=this.getActiveGroup()||this.getActiveObject();return t&&this.fire("before:selection:cleared",{target:t,e:n}),this.deactivateAll(),t&&this.fire("selection:cleared",{e:n}),this},drawControls:function(n){var t=this.getActiveGroup();t?this._drawGroupControls(n,t):this._drawObjectsControls(n)},_drawGroupControls:function(n,t){this._drawControls(n,t,"Group")},_drawObjectsControls:function(n){for(var t=0,i=this._objects.length;t<i;++t)this._objects[t]&&this._objects[t].active&&(this._drawControls(n,this._objects[t],"Object"),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[t])},_drawControls:function(n,t,i){n.save();fabric[i].prototype.transform.call(t,n);t.drawBorders(n).drawControls(n);n.restore()}});for(i in fabric.StaticCanvas)i!=="prototype"&&(fabric.Canvas[i]=fabric.StaticCanvas[i]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){});fabric.Element=fabric.Canvas}(),function(){var u=["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],i={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},n=fabric.util.addListener,t=fabric.util.removeListener,r=fabric.util.getPointer;fabric.util.object.extend(fabric.Canvas.prototype,{_initEventListeners:function(){this._bindEvents();n(fabric.window,"resize",this._onResize);n(this.upperCanvasEl,"mousedown",this._onMouseDown);n(this.upperCanvasEl,"mousemove",this._onMouseMove);n(this.upperCanvasEl,"mousewheel",this._onMouseWheel);n(this.upperCanvasEl,"touchstart",this._onMouseDown);n(this.upperCanvasEl,"touchmove",this._onMouseMove);typeof Event!="undefined"&&"add"in Event&&(Event.add(this.upperCanvasEl,"gesture",this._onGesture),Event.add(this.upperCanvasEl,"drag",this._onDrag),Event.add(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.add(this.upperCanvasEl,"shake",this._onShake))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){t(fabric.window,"resize",this._onResize);t(this.upperCanvasEl,"mousedown",this._onMouseDown);t(this.upperCanvasEl,"mousemove",this._onMouseMove);t(this.upperCanvasEl,"mousewheel",this._onMouseWheel);t(this.upperCanvasEl,"touchstart",this._onMouseDown);t(this.upperCanvasEl,"touchmove",this._onMouseMove);typeof Event!="undefined"&&"remove"in Event&&(Event.remove(this.upperCanvasEl,"gesture",this._onGesture),Event.remove(this.upperCanvasEl,"drag",this._onDrag),Event.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.remove(this.upperCanvasEl,"shake",this._onShake))},_onGesture:function(n,t){this.__onTransformGesture&&this.__onTransformGesture(n,t)},_onDrag:function(n,t){this.__onDrag&&this.__onDrag(n,t)},_onMouseWheel:function(n,t){this.__onMouseWheel&&this.__onMouseWheel(n,t)},_onOrientationChange:function(n,t){this.__onOrientationChange&&this.__onOrientationChange(n,t)},_onShake:function(n,t){this.__onShake&&this.__onShake(n,t)},_onMouseDown:function(i){this.__onMouseDown(i);n(fabric.document,"mouseup",this._onMouseUp);n(fabric.document,"touchend",this._onMouseUp);n(fabric.document,"mousemove",this._onMouseMove);n(fabric.document,"touchmove",this._onMouseMove);t(this.upperCanvasEl,"mousemove",this._onMouseMove);t(this.upperCanvasEl,"touchmove",this._onMouseMove)},_onMouseUp:function(i){this.__onMouseUp(i);t(fabric.document,"mouseup",this._onMouseUp);t(fabric.document,"touchend",this._onMouseUp);t(fabric.document,"mousemove",this._onMouseMove);t(fabric.document,"touchmove",this._onMouseMove);n(this.upperCanvasEl,"mousemove",this._onMouseMove);n(this.upperCanvasEl,"touchmove",this._onMouseMove)},_onMouseMove:function(n){!this.allowTouchScrolling&&n.preventDefault&&n.preventDefault();this.__onMouseMove(n)},_onResize:function(){this.calcOffset()},_shouldRender:function(n,t){var i=this.getActiveGroup()||this.getActiveObject();return!!(n&&(n.isMoving||n!==i)||!n&&!!i||!n&&!i&&!this._groupSelector||t&&this._previousPointer&&this.selection&&(t.x!==this._previousPointer.x||t.y!==this._previousPointer.y))},__onMouseUp:function(n){var t,i;if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(n);return}this._currentTransform?(this._finalizeCurrentTransform(),t=this._currentTransform.target):t=this.findTarget(n,!0);i=this._shouldRender(t,this.getPointer(n));this._maybeGroupObjects(n);t&&(t.isMoving=!1);i&&this.renderAll();this._handleCursorAndEvent(n,t)},_handleCursorAndEvent:function(n,t){this._setCursorFromEvent(n,t);var i=this;setTimeout(function(){i._setCursorFromEvent(n,t)},50);this.fire("mouse:up",{target:t,e:n});t&&t.fire("mouseup",{e:n})},_finalizeCurrentTransform:function(){var t=this._currentTransform,n=t.target;n._scaling&&(n._scaling=!1);n.setCoords();this.stateful&&n.hasStateChanged()&&(this.fire("object:modified",{target:n}),n.fire("modified"));this._restoreOriginXY(n)},_restoreOriginXY:function(n){if(this._previousOriginX&&this._previousOriginY){var t=n.translateToOriginPoint(n.getCenterPoint(),this._previousOriginX,this._previousOriginY);n.originX=this._previousOriginX;n.originY=this._previousOriginY;n.left=t.x;n.top=t.y;this._previousOriginX=null;this._previousOriginY=null}},_onMouseDownInDrawingMode:function(n){this._isCurrentlyDrawing=!0;this.discardActiveObject(n).renderAll();this.clipTo&&fabric.util.clipContext(this,this.contextTop);this.freeDrawingBrush.onMouseDown(this.getPointer(n));this.fire("mouse:down",{e:n})},_onMouseMoveInDrawingMode:function(n){if(this._isCurrentlyDrawing){var t=this.getPointer(n);this.freeDrawingBrush.onMouseMove(t)}this.upperCanvasEl.style.cursor=this.freeDrawingCursor;this.fire("mouse:move",{e:n})},_onMouseUpInDrawingMode:function(n){this._isCurrentlyDrawing=!1;this.clipTo&&this.contextTop.restore();this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:n})},__onMouseDown:function(n){var f="which"in n?n.which===1:n.button===1,t,i,u,r;if(f||fabric.isTouchSupported){if(this.isDrawingMode){this._onMouseDownInDrawingMode(n);return}this._currentTransform||(t=this.findTarget(n),i=this.getPointer(n),this._previousPointer=i,u=this._shouldRender(t,i),r=this._shouldGroup(n,t),this._shouldClearSelection(n,t)?this._clearSelection(n,t,i):r&&(this._handleGrouping(n,t),t=this.getActiveGroup()),t&&t.selectable&&!r&&(this._beforeTransform(n,t),this._setupCurrentTransform(n,t)),u&&this.renderAll(),this.fire("mouse:down",{target:t,e:n}),t&&t.fire("mousedown",{e:n}))}},_beforeTransform:function(n,t){var i;if(this.stateful&&t.saveState(),i=t._findTargetCorner(n,this._offset))this.onBeforeScaleRotate(t);t!==this.getActiveGroup()&&t!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(t,n))},_clearSelection:function(n,t,i){this.deactivateAllWithDispatch(n);t&&t.selectable?this.setActiveObject(t,n):this.selection&&(this._groupSelector={ex:i.x,ey:i.y,top:0,left:0})},_setOriginToCenter:function(n){this._previousOriginX=this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;var t=n.getCenterPoint();n.originX="center";n.originY="center";n.left=t.x;n.top=t.y;this._currentTransform.left=n.left;this._currentTransform.top=n.top},_setCenterToOrigin:function(n){var t=n.translateToOriginPoint(n.getCenterPoint(),this._previousOriginX,this._previousOriginY);n.originX=this._previousOriginX;n.originY=this._previousOriginY;n.left=t.x;n.top=t.y;this._previousOriginX=null;this._previousOriginY=null},__onMouseMove:function(n){var t,u,i;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(n);return}i=this._groupSelector;i?(u=r(n,this.upperCanvasEl),i.left=u.x-this._offset.left-i.ex,i.top=u.y-this._offset.top-i.ey,this.renderTop()):this._currentTransform?this._transformObject(n):(t=this.findTarget(n),t&&(!t||t.selectable)?this._setCursorFromEvent(n,t):this.upperCanvasEl.style.cursor=this.defaultCursor);this.fire("mouse:move",{target:t,e:n});t&&t.fire("mousemove",{e:n})},_transformObject:function(n){var i=r(n,this.upperCanvasEl),t=this._currentTransform;t.reset=!1;t.target.isMoving=!0;this._beforeScaleTransform(n,t);this._performTransformAction(n,t,i);this.renderAll()},_performTransformAction:function(n,t,i){var r=i.x,u=i.y,f=t.target,e=t.action;e==="rotate"?(this._rotateObject(r,u),this._fire("rotating",f,n)):e==="scale"?(this._onScale(n,t,r,u),this._fire("scaling",f,n)):e==="scaleX"?(this._scaleObject(r,u,"x"),this._fire("scaling",f,n)):e==="scaleY"?(this._scaleObject(r,u,"y"),this._fire("scaling",f,n)):(this._translateObject(r,u),this._fire("moving",f,n),this._setCursor(this.moveCursor))},_fire:function(n,t,i){this.fire("object:"+n,{target:t,e:i});t.fire(n,{e:i})},_beforeScaleTransform:function(n,t){if(t.action==="scale"||t.action==="scaleX"||t.action==="scaleY"){var i=this._shouldCenterTransform(n,t.target);(i&&(t.originX!=="center"||t.originY!=="center")||!i&&t.originX==="center"&&t.originY==="center")&&(this._resetCurrentTransform(n),t.reset=!0)}},_onScale:function(n,t,i,r){(n.shiftKey||this.uniScaleTransform)&&!t.target.get("lockUniScaling")?(t.currentAction="scale",this._scaleObject(i,r)):(t.reset||t.currentAction!=="scale"||this._resetCurrentTransform(n,t.target),t.currentAction="scaleEqually",this._scaleObject(i,r,"equally"))},_setCursorFromEvent:function(n,t){var u=this.upperCanvasEl.style,i,r;if(t&&t.selectable)i=this.getActiveGroup(),r=t._findTargetCorner&&(!i||!i.contains(t))&&t._findTargetCorner(n,this._offset),r?this._setCornerCursor(r,t):u.cursor=t.hoverCursor||this.hoverCursor;else return u.cursor=this.defaultCursor,!1;return!0},_setCornerCursor:function(n,t){var r=this.upperCanvasEl.style;if(n in i)r.cursor=this._getRotatedCornerCursor(n,t);else if(n==="mtr"&&t.hasRotatingPoint)r.cursor=this.rotationCursor;else return r.cursor=this.defaultCursor,!1},_getRotatedCornerCursor:function(n,t){var r=Math.round(t.getAngle()%360/45);return r<0&&(r+=8),r+=i[n],r%=8,u[r]}})}(),function(){var n=Math.min,t=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(n,t){var i=this.getActiveObject();return n.shiftKey&&(this.getActiveGroup()||i&&i!==t)&&this.selection},_handleGrouping:function(n,t){(t!==this.getActiveGroup()||(t=this.findTarget(n,!0),t&&!t.isType("group")))&&(this.getActiveGroup()?this._updateActiveGroup(t,n):this._createActiveGroup(t,n),this._activeGroup&&this._activeGroup.saveCoords())},_updateActiveGroup:function(n,t){var i=this.getActiveGroup();if(i.contains(n)){if(i.removeWithUpdate(n),this._resetObjectTransform(i),n.set("active",!1),i.size()===1){this.discardActiveGroup(t);this.setActiveObject(i.item(0));return}}else i.addWithUpdate(n),this._resetObjectTransform(i);this.fire("selection:created",{target:i,e:t});i.set("active",!0)},_createActiveGroup:function(n,t){if(this._activeObject&&n!==this._activeObject){var i=this._createGroup(n);this.setActiveGroup(i);this._activeObject=null;this.fire("selection:created",{target:i,e:t})}n.set("active",!0)},_createGroup:function(n){var t=this.getObjects(),i=t.indexOf(this._activeObject)<t.indexOf(n),r=i?[this._activeObject,n]:[n,this._activeObject];return new fabric.Group(r,{originX:"center",originY:"center"})},_groupSelectedObjects:function(n){var t=this._collectObjects();t.length===1?this.setActiveObject(t[0],n):t.length>1&&(t=new fabric.Group(t.reverse(),{originX:"center",originY:"center"}),this.setActiveGroup(t,n),t.saveCoords(),this.fire("selection:created",{target:t}),this.renderAll())},_collectObjects:function(){for(var h=[],i,r=this._groupSelector.ex,u=this._groupSelector.ey,f=r+this._groupSelector.left,e=u+this._groupSelector.top,o=new fabric.Point(n(r,f),n(u,e)),s=new fabric.Point(t(r,f),t(u,e)),l=r===f&&u===e,c=this._objects.length;c--;)if((i=this._objects[c],i&&i.selectable&&i.visible)&&(i.intersectsWithRect(o,s)||i.isContainedWithinRect(o,s)||i.containsPoint(o)||i.containsPoint(s))&&(i.set("active",!0),h.push(i),l))break;return h},_maybeGroupObjects:function(n){this.selection&&this._groupSelector&&this._groupSelectedObjects(n);var t=this.getActiveGroup();t&&(t.setObjectsCoords().setCoords(),t.isMoving=!1,this._setCursor(this.defaultCursor));this._groupSelector=null;this._currentTransform=null}})}();fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(n){n||(n={});var t=n.format||"png",i=n.quality||1,r=n.multiplier||1,u={left:n.left,top:n.top,width:n.width,height:n.height};return r!==1?this.__toDataURLWithMultiplier(t,i,u,r):this.__toDataURL(t,i,u)},__toDataURL:function(n,t,i){var u,r,f;return this.renderAll(!0),u=this.upperCanvasEl||this.lowerCanvasEl,r=this.__getCroppedCanvas(u,i),n==="jpg"&&(n="jpeg"),f=fabric.StaticCanvas.supports("toDataURLWithQuality")?(r||u).toDataURL("image/"+n,t):(r||u).toDataURL("image/"+n),this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),r&&(r=null),f},__getCroppedCanvas:function(n,t){var i,r,u="left"in t||"top"in t||"width"in t||"height"in t;return u&&(i=fabric.util.createCanvasElement(),r=i.getContext("2d"),i.width=t.width||this.width,i.height=t.height||this.height,r.drawImage(n,-t.left||0,-t.top||0)),i},__toDataURLWithMultiplier:function(n,t,i,r){var f=this.getWidth(),e=this.getHeight(),c=f*r,l=e*r,o=this.getActiveObject(),u=this.getActiveGroup(),s=this.contextTop||this.contextContainer,h;return this.setWidth(c).setHeight(l),s.scale(r,r),i.left&&(i.left*=r),i.top&&(i.top*=r),i.width&&(i.width*=r),i.height&&(i.height*=r),u?this._tempRemoveBordersControlsFromGroup(u):o&&this.deactivateAll&&this.deactivateAll(),this.renderAll(!0),h=this.__toDataURL(n,t,i),this.width=f,this.height=e,s.scale(1/r,1/r),this.setWidth(f).setHeight(e),u?this._restoreBordersControlsOnGroup(u):o&&this.setActiveObject&&this.setActiveObject(o),this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),h},toDataURLWithMultiplier:function(n,t,i){return this.toDataURL({format:n,multiplier:t,quality:i})},_tempRemoveBordersControlsFromGroup:function(n){n.origHasControls=n.hasControls;n.origBorderColor=n.borderColor;n.hasControls=!0;n.borderColor="rgba(0,0,0,0)";n.forEachObject(function(n){n.origBorderColor=n.borderColor;n.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(n){n.hideControls=n.origHideControls;n.borderColor=n.origBorderColor;n.forEachObject(function(n){n.borderColor=n.origBorderColor;delete n.origBorderColor})}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(n,t,i){return this.loadFromJSON(n,t,i)},loadFromJSON:function(n,t,i){var r,u;if(n)return r=typeof n=="string"?JSON.parse(n):n,this.clear(),u=this,this._enlivenObjects(r.objects,function(){u._setBgOverlay(r,t)},i),this},_setBgOverlay:function(n,t){var u=this,i={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1},r;if(!n.backgroundImage&&!n.overlayImage&&!n.background&&!n.overlay){t&&t();return}r=function(){i.backgroundImage&&i.overlayImage&&i.backgroundColor&&i.overlayColor&&(u.renderAll(),t&&t())};this.__setBgOverlay("backgroundImage",n.backgroundImage,i,r);this.__setBgOverlay("overlayImage",n.overlayImage,i,r);this.__setBgOverlay("backgroundColor",n.background,i,r);this.__setBgOverlay("overlayColor",n.overlay,i,r);r()},__setBgOverlay:function(n,t,i,r){var u=this;if(!t){i[n]=!0;return}n==="backgroundImage"||n==="overlayImage"?fabric.Image.fromObject(t,function(t){u[n]=t;i[n]=!0;r&&r()}):this["set"+fabric.util.string.capitalize(n,!0)](t,function(){i[n]=!0;r&&r()})},_enlivenObjects:function(n,t,i){var r=this,u;n.length===0&&t&&t();u=this.renderOnAddRemove;this.renderOnAddRemove=!1;fabric.util.enlivenObjects(n,function(n){n.forEach(function(n,t){r.insertAt(n,t,!0)});r.renderOnAddRemove=u;t&&t()},null,i)},_toDataURL:function(n,t){this.clone(function(i){t(i.toDataURL(n))})},_toDataURLWithMultiplier:function(n,t,i){this.clone(function(r){i(r.toDataURLWithMultiplier(n,t))})},clone:function(n,t){var i=JSON.stringify(this.toJSON(t));this.cloneWithoutData(function(t){t.loadFromJSON(i,function(){n&&n(t)})})},cloneWithoutData:function(n){var i=fabric.document.createElement("canvas"),t;i.width=this.getWidth();i.height=this.getHeight();t=new fabric.Canvas(i);t.clipTo=this.clipTo;this.backgroundImage?(t.setBackgroundImage(this.backgroundImage.src,function(){t.renderAll();n&&n(t)}),t.backgroundImageOpacity=this.backgroundImageOpacity,t.backgroundImageStretch=this.backgroundImageStretch):n&&n(t)}}),function(n){"use strict";var t=n.fabric||(n.fabric={}),r=t.util.object.extend,i=t.util.toFixed,u=t.util.string.capitalize,f=t.util.degreesToRadians,e=t.StaticCanvas.supports("setLineDash");t.Object||(t.Object=t.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule shadow clipTo visible backgroundColor".split(" "),initialize:function(n){n&&this.setOptions(n)},_initGradient:function(n){!n.fill||!n.fill.colorStops||n.fill instanceof t.Gradient||this.set("fill",new t.Gradient(n.fill))},_initPattern:function(n){!n.fill||!n.fill.source||n.fill instanceof t.Pattern||this.set("fill",new t.Pattern(n.fill));!n.stroke||!n.stroke.source||n.stroke instanceof t.Pattern||this.set("stroke",new t.Pattern(n.stroke))},_initClipping:function(n){if(n.clipTo&&typeof n.clipTo=="string"){var i=t.util.getFunctionBody(n.clipTo);typeof i!="undefined"&&(this.clipTo=new Function("ctx",i))}},setOptions:function(n){for(var t in n)this.set(t,n[t]);this._initGradient(n);this._initPattern(n);this._initClipping(n)},transform:function(n,t){n.globalAlpha=this.opacity;var i=t?this._getLeftTopCoords():this.getCenterPoint();n.translate(i.x,i.y);n.rotate(f(this.angle));n.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(n){var r=t.Object.NUM_FRACTION_DIGITS,u={type:this.type,originX:this.originX,originY:this.originY,left:i(this.left,r),top:i(this.top,r),width:i(this.width,r),height:i(this.height,r),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:i(this.strokeWidth,r),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:i(this.strokeMiterLimit,r),scaleX:i(this.scaleX,r),scaleY:i(this.scaleY,r),angle:i(this.getAngle(),r),flipX:this.flipX,flipY:this.flipY,opacity:i(this.opacity,r),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor};return this.includeDefaultValues||(u=this._removeDefaultValues(u)),t.util.populateWithProperties(this,u,n),u},toDatalessObject:function(n){return this.toObject(n)},_removeDefaultValues:function(n){var i=t.util.getKlass(n.type).prototype,r=i.stateProperties;return r.forEach(function(t){n[t]===i[t]&&delete n[t]}),n},toString:function(){return"#<fabric."+u(this.type)+">"},get:function(n){return this[n]},set:function(n,t){if(typeof n=="object")for(var i in n)this._set(i,n[i]);else typeof t=="function"&&n!=="clipTo"?this._set(n,t(this.get(n))):this._set(n,t);return this},_set:function(n,r){var u=n==="scaleX"||n==="scaleY";return u&&(r=this._constrainScale(r)),n==="scaleX"&&r<0?(this.flipX=!this.flipX,r*=-1):n==="scaleY"&&r<0?(this.flipY=!this.flipY,r*=-1):n==="width"||n==="height"?this.minScaleLimit=i(Math.min(.1,1/Math.max(this.width,this.height)),2):n!=="shadow"||!r||r instanceof t.Shadow||(r=new t.Shadow(r)),this[n]=r,this},toggle:function(n){var t=this.get(n);return typeof t=="boolean"&&this.set(n,!t),this},setSourcePath:function(n){return this.sourcePath=n,this},render:function(n,i){if(this.width!==0&&this.height!==0&&this.visible){n.save();this._transform(n,i);this._setStrokeStyles(n);this._setFillStyles(n);var r=this.transformMatrix;r&&this.group&&(n.translate(-this.group.width/2,-this.group.height/2),n.transform(r[0],r[1],r[2],r[3],r[4],r[5]));this._setShadow(n);this.clipTo&&t.util.clipContext(this,n);this._render(n,i);this.clipTo&&n.restore();this._removeShadow(n);this.active&&!i&&(this.drawBorders(n),this.drawControls(n));n.restore()}},_transform:function(n,t){var i=this.transformMatrix;i&&!this.group&&n.setTransform(i[0],i[1],i[2],i[3],i[4],i[5]);t||this.transform(n)},_setStrokeStyles:function(n){this.stroke&&(n.lineWidth=this.strokeWidth,n.lineCap=this.strokeLineCap,n.lineJoin=this.strokeLineJoin,n.miterLimit=this.strokeMiterLimit,n.strokeStyle=this.stroke.toLive?this.stroke.toLive(n):this.stroke)},_setFillStyles:function(n){this.fill&&(n.fillStyle=this.fill.toLive?this.fill.toLive(n):this.fill)},_setShadow:function(n){this.shadow&&(n.shadowColor=this.shadow.color,n.shadowBlur=this.shadow.blur,n.shadowOffsetX=this.shadow.offsetX,n.shadowOffsetY=this.shadow.offsetY)},_removeShadow:function(n){n.shadowColor="";n.shadowBlur=n.shadowOffsetX=n.shadowOffsetY=0},_renderFill:function(n){this.fill&&(this.fill.toLive&&(n.save(),n.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0)),n.fill(),this.fill.toLive&&n.restore(),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(n))},_renderStroke:function(n){this.stroke&&(n.save(),this.strokeDashArray?(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),e?(n.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(n)):this._renderDashedStroke&&this._renderDashedStroke(n),n.stroke()):this._stroke?this._stroke(n):n.stroke(),this._removeShadow(n),n.restore())},clone:function(n,i){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(i),n):new t.Object(this.toObject(i))},cloneAsImage:function(n){var i=this.toDataURL();return t.util.loadImage(i,function(i){n&&n(new t.Image(i))}),this},toDataURL:function(n){var i,u,r,f,e,o;return n||(n={}),i=t.util.createCanvasElement(),u=this.getBoundingRect(),i.width=u.width,i.height=u.height,t.util.wrapElement(i,"div"),r=new t.Canvas(i),n.format==="jpg"&&(n.format="jpeg"),n.format==="jpeg"&&(r.backgroundColor="#fff"),f={active:this.get("active"),left:this.getLeft(),top:this.getTop()},this.set("active",!1),this.setPositionByOrigin(new t.Point(i.width/2,i.height/2),"center","center"),e=this.canvas,r.add(this),o=r.toDataURL(n),this.set(f).setCoords(),this.canvas=e,r.dispose(),r=null,o},isType:function(n){return this.type===n},complexity:function(){return 0},toJSON:function(n){return this.toObject(n)},setGradient:function(n,i){var r,u,f;i||(i={});r={colorStops:[]};r.type=i.type||(i.r1||i.r2?"radial":"linear");r.coords={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2};(i.r1||i.r2)&&(r.coords.r1=i.r1,r.coords.r2=i.r2);for(u in i.colorStops)f=new t.Color(i.colorStops[u]),r.colorStops.push({offset:u,color:f.toRgb(),opacity:f.getAlpha()});return this.set(n,t.Gradient.forObject(this,r))},setPatternFill:function(n){return this.set("fill",new t.Pattern(n))},setShadow:function(n){return this.set("shadow",new t.Shadow(n))},setColor:function(n){return this.set("fill",n),this},centerH:function(){return this.canvas.centerObjectH(this),this},centerV:function(){return this.canvas.centerObjectV(this),this},center:function(){return this.canvas.centerObject(this),this},remove:function(){return this.canvas.remove(this)},getLocalPointer:function(n,t){t=t||this.canvas.getPointer(n);var i=this.translateToOriginPoint(this.getCenterPoint(),"left","top");return{x:t.x-i.x,y:t.y-i.y}}}),t.util.createAccessors(t.Object),t.Object.prototype.rotate=t.Object.prototype.setAngle,r(t.Object.prototype,t.Observable),t.Object.NUM_FRACTION_DIGITS=2,t.Object.__uid=0)}(typeof exports!="undefined"?exports:this),function(){var n=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(t,i,r){var f=t.x,e=t.y,u=this.stroke?this.strokeWidth:0;return i==="left"?f=t.x+(this.getWidth()+u*this.scaleX)/2:i==="right"&&(f=t.x-(this.getWidth()+u*this.scaleX)/2),r==="top"?e=t.y+(this.getHeight()+u*this.scaleY)/2:r==="bottom"&&(e=t.y-(this.getHeight()+u*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(f,e),t,n(this.angle))},translateToOriginPoint:function(t,i,r){var f=t.x,e=t.y,u=this.stroke?this.strokeWidth:0;return i==="left"?f=t.x-(this.getWidth()+u*this.scaleX)/2:i==="right"&&(f=t.x+(this.getWidth()+u*this.scaleX)/2),r==="top"?e=t.y-(this.getHeight()+u*this.scaleY)/2:r==="bottom"&&(e=t.y+(this.getHeight()+u*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(f,e),t,n(this.angle))},getCenterPoint:function(){var n=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(n,this.originX,this.originY)},getPointByOrigin:function(n,t){var i=this.getCenterPoint();return this.translateToOriginPoint(i,n,t)},toLocalPoint:function(t,i,r){var u=this.getCenterPoint(),f=this.stroke?this.strokeWidth:0,e,o;return i&&r?(e=i==="left"?u.x-(this.getWidth()+f*this.scaleX)/2:i==="right"?u.x+(this.getWidth()+f*this.scaleX)/2:u.x,o=r==="top"?u.y-(this.getHeight()+f*this.scaleY)/2:r==="bottom"?u.y+(this.getHeight()+f*this.scaleY)/2:u.y):(e=this.left,o=this.top),fabric.util.rotatePoint(new fabric.Point(t.x,t.y),u,-n(this.angle)).subtractEquals(new fabric.Point(e,o))},setPositionByOrigin:function(n,t,i){var u=this.translateToCenterPoint(n,t,i),r=this.translateToOriginPoint(u,this.originX,this.originY);this.set("left",r.x);this.set("top",r.y)},adjustPosition:function(t){var i=n(this.angle),r=this.getWidth()/2,u=Math.cos(i)*r,f=Math.sin(i)*r,e=this.getWidth(),o=Math.cos(i)*e,s=Math.sin(i)*e;this.originX==="center"&&t==="left"||this.originX==="right"&&t==="center"?(this.left-=u,this.top-=f):this.originX==="left"&&t==="center"||this.originX==="center"&&t==="right"?(this.left+=u,this.top+=f):this.originX==="left"&&t==="right"?(this.left+=o,this.top+=s):this.originX==="right"&&t==="left"&&(this.left-=o,this.top-=s);this.setCoords();this.originX=t},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})}(),function(){var n=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(n,t){var i=this.oCoords,r=new fabric.Point(i.tl.x,i.tl.y),u=new fabric.Point(i.tr.x,i.tr.y),f=new fabric.Point(i.bl.x,i.bl.y),e=new fabric.Point(i.br.x,i.br.y),o=fabric.Intersection.intersectPolygonRectangle([r,u,e,f],n,t);return o.status==="Intersection"},intersectsWithObject:function(n){function r(n){return{tl:new fabric.Point(n.tl.x,n.tl.y),tr:new fabric.Point(n.tr.x,n.tr.y),bl:new fabric.Point(n.bl.x,n.bl.y),br:new fabric.Point(n.br.x,n.br.y)}}var t=r(this.oCoords),i=r(n.oCoords),u=fabric.Intersection.intersectPolygonPolygon([t.tl,t.tr,t.br,t.bl],[i.tl,i.tr,i.br,i.bl]);return u.status==="Intersection"},isContainedWithinObject:function(n){var t=n.getBoundingRect(),i=new fabric.Point(t.left,t.top),r=new fabric.Point(t.left+t.width,t.top+t.height);return this.isContainedWithinRect(i,r)},isContainedWithinRect:function(n,t){var i=this.getBoundingRect();return i.left>n.x&&i.left+i.width<t.x&&i.top>n.y&&i.top+i.height<t.y},containsPoint:function(n){var i=this._getImageLines(this.oCoords),t=this._findCrossPoints(n,i);return t!==0&&t%2==1},_getImageLines:function(n){return{topline:{o:n.tl,d:n.tr},rightline:{o:n.tr,d:n.br},bottomline:{o:n.br,d:n.bl},leftline:{o:n.bl,d:n.tl}}},_findCrossPoints:function(n,t){var r,f,e,s,u,h,o=0,i;for(var c in t)if((i=t[c],!(i.o.y<n.y)||!(i.d.y<n.y))&&(!(i.o.y>=n.y)||!(i.d.y>=n.y))&&(i.o.x===i.d.x&&i.o.x>=n.x?(u=i.o.x,h=n.y):(r=0,f=(i.d.y-i.o.y)/(i.d.x-i.o.x),e=n.y-r*n.x,s=i.o.y-f*i.o.x,u=-(e-s)/(r-f),h=e+r*u),u>=n.x&&(o+=1),o===2))break;return o},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var n=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],t=fabric.util.array.min(n),u=fabric.util.array.max(n),f=Math.abs(t-u),i=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],r=fabric.util.array.min(i),e=fabric.util.array.max(i),o=Math.abs(r-e);return{left:t,top:r,width:f,height:o}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(n){return Math.abs(n)<this.minScaleLimit?n<0?-this.minScaleLimit:this.minScaleLimit:n},scale:function(n){return n=this._constrainScale(n),n<0&&(this.flipX=!this.flipX,this.flipY=!this.flipY,n*=-1),this.scaleX=n,this.scaleY=n,this.setCoords(),this},scaleToWidth:function(n){var t=this.getBoundingRectWidth()/this.getWidth();return this.scale(n/this.width/t)},scaleToHeight:function(n){var t=this.getBoundingRectHeight()/this.getHeight();return this.scale(n/this.height/t)},setCoords:function(){var s=this.strokeWidth>1?this.strokeWidth:0,h=this.padding,f=n(this.angle);this.currentWidth=(this.width+s)*this.scaleX+h*2;this.currentHeight=(this.height+s)*this.scaleY+h*2;this.currentWidth<0&&(this.currentWidth=Math.abs(this.currentWidth));var c=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2)),l=Math.atan(isFinite(this.currentHeight/this.currentWidth)?this.currentHeight/this.currentWidth:0),v=Math.cos(l+f)*c,y=Math.sin(l+f)*c,i=Math.sin(f),r=Math.cos(f),a=this.getCenterPoint(),t={x:a.x-v,y:a.y-y},u={x:t.x+this.currentWidth*r,y:t.y+this.currentWidth*i},p={x:u.x-this.currentHeight*i,y:u.y+this.currentHeight*r},e={x:t.x-this.currentHeight*i,y:t.y+this.currentHeight*r},w={x:t.x-this.currentHeight/2*i,y:t.y+this.currentHeight/2*r},o={x:t.x+this.currentWidth/2*r,y:t.y+this.currentWidth/2*i},b={x:u.x-this.currentHeight/2*i,y:u.y+this.currentHeight/2*r},k={x:e.x+this.currentWidth/2*r,y:e.y+this.currentWidth/2*i},d={x:o.x,y:o.y};return this.oCoords={tl:t,tr:u,br:p,bl:e,ml:w,mt:o,mr:b,mb:k,mtr:d},this._setCornerCoords&&this._setCornerCoords(),this}})}();fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(n){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,n):this.canvas.sendBackwards(this,n),this},bringForward:function(n){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,n):this.canvas.bringForward(this,n),this},moveTo:function(n){return this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,n):this.canvas.moveTo(this,n),this}});fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(){var n=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",t=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",i=this.strokeWidth?this.strokeWidth:"0",r=this.strokeDashArray?this.strokeDashArray.join(" "):"",u=this.strokeLineCap?this.strokeLineCap:"butt",f=this.strokeLineJoin?this.strokeLineJoin:"miter",e=this.strokeMiterLimit?this.strokeMiterLimit:"4",o=typeof this.opacity!="undefined"?this.opacity:"1",s=this.visible?"":" visibility: hidden;",h=this.shadow&&this.type!=="text"?"filter: url(#SVGID_"+this.shadow.id+");":"";return["stroke: ",t,"; ","stroke-width: ",i,"; ","stroke-dasharray: ",r,"; ","stroke-linecap: ",u,"; ","stroke-linejoin: ",f,"; ","stroke-miterlimit: ",e,"; ","fill: ",n,"; ","opacity: ",o,";",h,s].join("")},getSvgTransform:function(){var n=fabric.util.toFixed,i=this.getAngle(),r=this.getCenterPoint(),t=fabric.Object.NUM_FRACTION_DIGITS,u="translate("+n(r.x,t)+" "+n(r.y,t)+")",f=i!==0?" rotate("+n(i,t)+")":"",e=this.scaleX===1&&this.scaleY===1?"":" scale("+n(this.scaleX,t)+" "+n(this.scaleY,t)+")",o=this.flipX?"matrix(-1 0 0 1 0 0) ":"",s=this.flipY?"matrix(1 0 0 -1 0 0)":"";return[u,f,e,o,s].join("")},_createBaseSVGMarkup:function(){var n=[];return this.fill&&this.fill.toLive&&n.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&n.push(this.stroke.toSVG(this,!1)),this.shadow&&n.push(this.shadow.toSVG(this)),n}});fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(n){return this.get(n)!==this.originalState[n]},this)},saveState:function(n){return this.stateProperties.forEach(function(n){this.originalState[n]=this.get(n)},this),n&&n.stateProperties&&n.stateProperties.forEach(function(n){this.originalState[n]=this.get(n)},this),this},setupState:function(){return this.originalState={},this.saveState(),this}}),function(){var t=fabric.util.getPointer,n=fabric.util.degreesToRadians,i=typeof G_vmlCanvasManager!="undefined";fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(n,i){var r;if(!this.hasControls||!this.active)return!1;var f=t(n,this.canvas.upperCanvasEl),o=f.x-i.left,s=f.y-i.top,u,e;for(r in this.oCoords)if(this.isControlVisible(r)&&(r!=="mtr"||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||r!=="mt"&&r!=="mr"&&r!=="mb"&&r!=="ml")&&(e=this._getImageLines(this.oCoords[r].corner),u=this._findCrossPoints({x:o,y:s},e),u!==0&&u%2==1))return this.__corner=r,r;return!1},_setCornerCoords:function(){var t=this.oCoords,e=n(this.angle),o=n(45-this.angle),s=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,i=s*Math.cos(o),r=s*Math.sin(o),u=Math.sin(e),f=Math.cos(e);t.tl.corner={tl:{x:t.tl.x-r,y:t.tl.y-i},tr:{x:t.tl.x+i,y:t.tl.y-r},bl:{x:t.tl.x-i,y:t.tl.y+r},br:{x:t.tl.x+r,y:t.tl.y+i}};t.tr.corner={tl:{x:t.tr.x-r,y:t.tr.y-i},tr:{x:t.tr.x+i,y:t.tr.y-r},br:{x:t.tr.x+r,y:t.tr.y+i},bl:{x:t.tr.x-i,y:t.tr.y+r}};t.bl.corner={tl:{x:t.bl.x-r,y:t.bl.y-i},bl:{x:t.bl.x-i,y:t.bl.y+r},br:{x:t.bl.x+r,y:t.bl.y+i},tr:{x:t.bl.x+i,y:t.bl.y-r}};t.br.corner={tr:{x:t.br.x+i,y:t.br.y-r},bl:{x:t.br.x-i,y:t.br.y+r},br:{x:t.br.x+r,y:t.br.y+i},tl:{x:t.br.x-r,y:t.br.y-i}};t.ml.corner={tl:{x:t.ml.x-r,y:t.ml.y-i},tr:{x:t.ml.x+i,y:t.ml.y-r},bl:{x:t.ml.x-i,y:t.ml.y+r},br:{x:t.ml.x+r,y:t.ml.y+i}};t.mt.corner={tl:{x:t.mt.x-r,y:t.mt.y-i},tr:{x:t.mt.x+i,y:t.mt.y-r},bl:{x:t.mt.x-i,y:t.mt.y+r},br:{x:t.mt.x+r,y:t.mt.y+i}};t.mr.corner={tl:{x:t.mr.x-r,y:t.mr.y-i},tr:{x:t.mr.x+i,y:t.mr.y-r},bl:{x:t.mr.x-i,y:t.mr.y+r},br:{x:t.mr.x+r,y:t.mr.y+i}};t.mb.corner={tl:{x:t.mb.x-r,y:t.mb.y-i},tr:{x:t.mb.x+i,y:t.mb.y-r},bl:{x:t.mb.x-i,y:t.mb.y+r},br:{x:t.mb.x+r,y:t.mb.y+i}};t.mtr.corner={tl:{x:t.mtr.x-r+u*this.rotatingPointOffset,y:t.mtr.y-i-f*this.rotatingPointOffset},tr:{x:t.mtr.x+i+u*this.rotatingPointOffset,y:t.mtr.y-r-f*this.rotatingPointOffset},bl:{x:t.mtr.x-i+u*this.rotatingPointOffset,y:t.mtr.y+r-f*this.rotatingPointOffset},br:{x:t.mtr.x+r+u*this.rotatingPointOffset,y:t.mtr.y+i-f*this.rotatingPointOffset}}},drawBorders:function(n){var o,s,u,r,f;if(!this.hasBorders)return this;var i=this.padding,e=i*2,t=~~(this.strokeWidth/2)*2;return n.save(),n.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,n.strokeStyle=this.borderColor,o=1/this._constrainScale(this.scaleX),s=1/this._constrainScale(this.scaleY),n.lineWidth=1/this.borderScaleFactor,n.scale(o,s),u=this.getWidth(),r=this.getHeight(),n.strokeRect(~~(-(u/2)-i-t/2*this.scaleX)-.5,~~(-(r/2)-i-t/2*this.scaleY)-.5,~~(u+e+t*this.scaleX)+1,~~(r+e+t*this.scaleY)+1),this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls&&(f=(this.flipY?r+t*this.scaleY+i*2:-r-t*this.scaleY-i*2)/2,n.beginPath(),n.moveTo(0,f),n.lineTo(0,f+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset)),n.closePath(),n.stroke()),n.restore(),this},drawControls:function(n){if(!this.hasControls)return this;var a=this.cornerSize,l=a/2,t=~~(this.strokeWidth/2),r=-(this.width/2),i=-(this.height/2),o=this.padding/this.scaleX,f=this.padding/this.scaleY,c=l/this.scaleY,e=l/this.scaleX,y=(l-a)/this.scaleX,v=(l-a)/this.scaleY,s=this.height,h=this.width,u=this.transparentCorners?"strokeRect":"fillRect";return n.save(),n.lineWidth=1/Math.max(this.scaleX,this.scaleY),n.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,n.strokeStyle=n.fillStyle=this.cornerColor,this._drawControl("tl",n,u,r-e-t-o,i-c-t-f),this._drawControl("tr",n,u,r+h-e+t+o,i-c-t-f),this._drawControl("tr",n,u,r-e-t-o,i+s+v+t+f),this._drawControl("br",n,u,r+h+y+t+o,i+s+v+t+f),this.get("lockUniScaling")||(this._drawControl("mt",n,u,r+h/2-e,i-c-t-f),this._drawControl("mb",n,u,r+h/2-e,i+s+v+t+f),this._drawControl("mb",n,u,r+h+y+t+o,i+s/2-c),this._drawControl("ml",n,u,r-e-t-o,i+s/2-c)),this.hasRotatingPoint&&this._drawControl("mtr",n,u,r+h/2-e,this.flipY?i+s+this.rotatingPointOffset/this.scaleY-this.cornerSize/this.scaleX/2+t+f:i-this.rotatingPointOffset/this.scaleY-this.cornerSize/this.scaleY/2-t-f),n.restore(),this},_drawControl:function(n,t,r,u,f){var e=this.cornerSize/this.scaleX,o=this.cornerSize/this.scaleY;this.isControlVisible(n)&&(i||this.transparentCorners||t.clearRect(u,f,e,o),t[r](u,f,e,o))},isControlVisible:function(n){return this._getControlsVisibility()[n]},setControlVisible:function(n,t){return this._getControlsVisibility()[n]=t,this},setControlsVisibility:function(n){n||(n={});for(var t in n)this.setControlVisible(t,n[t]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility}})}();fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(n,t){t=t||{};var i=function(){},r=t.onComplete||i,u=t.onChange||i,f=this;return fabric.util.animate({startValue:n.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(t){n.set("left",t);f.renderAll();u()},onComplete:function(){n.setCoords();r()}}),this},fxCenterObjectV:function(n,t){t=t||{};var i=function(){},r=t.onComplete||i,u=t.onChange||i,f=this;return fabric.util.animate({startValue:n.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(t){n.set("top",t);f.renderAll();u()},onComplete:function(){n.setCoords();r()}}),this},fxRemove:function(n,t){t=t||{};var i=function(){},u=t.onComplete||i,f=t.onChange||i,r=this;return fabric.util.animate({startValue:n.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){n.set("active",!1)},onChange:function(t){n.set("opacity",t);r.renderAll();f()},onComplete:function(){r.remove(n);u()}}),this}});fabric.util.object.extend(fabric.Object.prototype,{animate:function(){var i,n,u,t,r;if(arguments[0]&&typeof arguments[0]=="object"){i=[];for(n in arguments[0])i.push(n);for(t=0,r=i.length;t<r;t++)n=i[t],u=t!==r-1,this._animate(n,arguments[0][n],arguments[1],u)}else this._animate.apply(this,arguments);return this},_animate:function(n,t,i,r){var f=this,u,e;t=t.toString();i=i?fabric.util.object.clone(i):{};~n.indexOf(".")&&(u=n.split("."));e=u?this.get(u[0])[u[1]]:this.get(n);"from"in i||(i.from=e);t=~t.indexOf("=")?e+parseFloat(t.replace("=","")):parseFloat(t);fabric.util.animate({startValue:i.from,endValue:t,byValue:i.by,easing:i.easing,duration:i.duration,abort:i.abort&&function(){return i.abort.call(f)},onChange:function(t){(u?f[u[0]][u[1]]=t:f.set(n,t),r)||i.onChange&&i.onChange()},onComplete:function(){r||(f.setCoords(),i.onComplete&&i.onComplete())}})}}),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend,r={x1:1,x2:1,y1:1,y2:1},u=t.StaticCanvas.supports("setLineDash");if(t.Line){t.warn("fabric.Line is already defined");return}t.Line=t.util.createClass(t.Object,{type:"line",initialize:function(n,t){t=t||{};n||(n=[0,0,0,0]);this.callSuper("initialize",t);this.set("x1",n[0]);this.set("y1",n[1]);this.set("x2",n[2]);this.set("y2",n[3]);this._setWidthHeight(t)},_setWidthHeight:function(n){n||(n={});this.set("width",Math.abs(this.x2-this.x1)||1);this.set("height",Math.abs(this.y2-this.y1)||1);this.set("left","left"in n?n.left:Math.min(this.x1,this.x2)+this.width/2);this.set("top","top"in n?n.top:Math.min(this.y1,this.y2)+this.height/2)},_set:function(n,t){return this[n]=t,n in r&&this._setWidthHeight(),this},_render:function(n){var r,t,i,f;n.beginPath();r=this.group&&this.group.type==="path-group";r&&!this.transformMatrix&&n.translate(-this.group.width/2+this.left,-this.group.height/2+this.top);(!this.strokeDashArray||this.strokeDashArray&&u)&&(t=this.x1<=this.x2?-1:1,i=this.y1<=this.y2?-1:1,n.moveTo(this.width===1?0:t*this.width/2,this.height===1?0:i*this.height/2),n.lineTo(this.width===1?0:t*-1*this.width/2,this.height===1?0:i*-1*this.height/2));n.lineWidth=this.strokeWidth;f=n.strokeStyle;n.strokeStyle=this.stroke||n.fillStyle;this._renderStroke(n);n.strokeStyle=f},_renderDashedStroke:function(n){var u=this.x1<=this.x2?-1:1,f=this.y1<=this.y2?-1:1,i=this.width===1?0:u*this.width/2,r=this.height===1?0:f*this.height/2;n.beginPath();t.util.drawDashedLine(n,i,r,-i,-r,this.strokeDashArray);n.closePath()},toObject:function(n){return i(this.callSuper("toObject",n),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})},toSVG:function(n){var t=this._createBaseSVGMarkup();return t.push("<line ",'x1="',this.get("x1"),'" y1="',this.get("y1"),'" x2="',this.get("x2"),'" y2="',this.get("y2"),'" style="',this.getSvgStyles(),'"/>'),n?n(t.join("")):t.join("")},complexity:function(){return 1}});t.Line.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" "));t.Line.fromElement=function(n,r){var u=t.parseAttributes(n,t.Line.ATTRIBUTE_NAMES),f=[u.x1||0,u.y1||0,u.x2||0,u.y2||0];return new t.Line(f,i(u,r))};t.Line.fromObject=function(n){var i=[n.x1,n.y1,n.x2,n.y2];return new t.Line(i,n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";function u(n){return"radius"in n&&n.radius>0}var t=n.fabric||(n.fabric={}),r=Math.PI*2,i=t.util.object.extend;if(t.Circle){t.warn("fabric.Circle is already defined.");return}t.Circle=t.util.createClass(t.Object,{type:"circle",initialize:function(n){n=n||{};this.set("radius",n.radius||0);this.callSuper("initialize",n)},_set:function(n,t){return this.callSuper("_set",n,t),n==="radius"&&this.setRadius(t),this},toObject:function(n){return i(this.callSuper("toObject",n),{radius:this.get("radius")})},toSVG:function(n){var t=this._createBaseSVGMarkup();return t.push("<circle ",'cx="0" cy="0" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),n?n(t.join("")):t.join("")},_render:function(n,t){n.beginPath();n.globalAlpha=this.group?n.globalAlpha*this.opacity:this.opacity;n.arc(t?this.left:0,t?this.top:0,this.radius,0,r,!1);n.closePath();this._renderFill(n);this._renderStroke(n)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(n){this.radius=n;this.set("width",n*2).set("height",n*2)},complexity:function(){return 1}});t.Circle.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy r".split(" "));t.Circle.fromElement=function(n,r){var f,e;if(r||(r={}),f=t.parseAttributes(n,t.Circle.ATTRIBUTE_NAMES),!u(f))throw new Error("value of `r` attribute is required and can not be negative");return"left"in f&&(f.left-=r.width/2||0),"top"in f&&(f.top-=r.height/2||0),e=new t.Circle(i(f,r)),e.cx=parseFloat(n.getAttribute("cx"))||0,e.cy=parseFloat(n.getAttribute("cy"))||0,e};t.Circle.fromObject=function(n){return new t.Circle(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={});if(t.Triangle){t.warn("fabric.Triangle is already defined");return}t.Triangle=t.util.createClass(t.Object,{type:"triangle",initialize:function(n){n=n||{};this.callSuper("initialize",n);this.set("width",n.width||100).set("height",n.height||100)},_render:function(n){var i=this.width/2,t=this.height/2;n.beginPath();n.moveTo(-i,t);n.lineTo(0,-t);n.lineTo(i,t);n.closePath();this._renderFill(n);this._renderStroke(n)},_renderDashedStroke:function(n){var r=this.width/2,i=this.height/2;n.beginPath();t.util.drawDashedLine(n,-r,i,0,-i,this.strokeDashArray);t.util.drawDashedLine(n,0,-i,r,i,this.strokeDashArray);t.util.drawDashedLine(n,r,i,-r,i,this.strokeDashArray);n.closePath()},toSVG:function(n){var t=this._createBaseSVGMarkup(),r=this.width/2,i=this.height/2,u=[-r+" "+i,"0 "+-i,r+" "+i].join(",");return t.push("<polygon ",'points="',u,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),n?n(t.join("")):t.join("")},complexity:function(){return 1}});t.Triangle.fromObject=function(n){return new t.Triangle(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),r=Math.PI*2,i=t.util.object.extend;if(t.Ellipse){t.warn("fabric.Ellipse is already defined.");return}t.Ellipse=t.util.createClass(t.Object,{type:"ellipse",rx:0,ry:0,initialize:function(n){n=n||{};this.callSuper("initialize",n);this.set("rx",n.rx||0);this.set("ry",n.ry||0);this.set("width",this.get("rx")*2);this.set("height",this.get("ry")*2)},toObject:function(n){return i(this.callSuper("toObject",n),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(n){var t=this._createBaseSVGMarkup();return t.push("<ellipse ",'rx="',this.get("rx"),'" ry="',this.get("ry"),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),n?n(t.join("")):t.join("")},render:function(n,t){if(this.rx!==0&&this.ry!==0)return this.callSuper("render",n,t)},_render:function(n,t){n.beginPath();n.save();n.globalAlpha=this.group?n.globalAlpha*this.opacity:this.opacity;this.transformMatrix&&this.group&&n.translate(this.cx,this.cy);n.transform(1,0,0,this.ry/this.rx,0,0);n.arc(t?this.left:0,t?this.top:0,this.rx,0,r,!1);this._renderFill(n);this._renderStroke(n);n.restore()},complexity:function(){return 1}});t.Ellipse.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" "));t.Ellipse.fromElement=function(n,r){var f;r||(r={});var u=t.parseAttributes(n,t.Ellipse.ATTRIBUTE_NAMES),e=u.left,o=u.top;return"left"in u&&(u.left-=r.width/2||0),"top"in u&&(u.top-=r.height/2||0),f=new t.Ellipse(i(u,r)),f.cx=e||0,f.cy=o||0,f};t.Ellipse.fromObject=function(n){return new t.Ellipse(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";function u(n){return n.left=n.left||0,n.top=n.top||0,n}var t=n.fabric||(n.fabric={}),r=t.util.object.extend,i;if(t.Rect){console.warn("fabric.Rect is already defined");return}i=t.Object.prototype.stateProperties.concat();i.push("rx","ry","x","y");t.Rect=t.util.createClass(t.Object,{stateProperties:i,type:"rect",rx:0,ry:0,x:0,y:0,strokeDashArray:null,initialize:function(n){n=n||{};this.callSuper("initialize",n);this._initRxRy();this.x=n.x||0;this.y=n.y||0},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(n){var r=this.rx||0,e=this.ry||0,t=-this.width/2,i=-this.height/2,u=this.width,f=this.height,s=this.group&&this.group.type==="path-group",o;n.beginPath();n.globalAlpha=s?n.globalAlpha*this.opacity:this.opacity;this.transformMatrix&&s&&n.translate(this.width/2+this.x,this.height/2+this.y);!this.transformMatrix&&s&&n.translate(-this.group.width/2+this.width/2+this.x,-this.group.height/2+this.height/2+this.y);o=r!==0||e!==0;n.moveTo(t+r,i);n.lineTo(t+u-r,i);o&&n.quadraticCurveTo(t+u,i,t+u,i+e,t+u,i+e);n.lineTo(t+u,i+f-e);o&&n.quadraticCurveTo(t+u,i+f,t+u-r,i+f,t+u-r,i+f);n.lineTo(t+r,i+f);o&&n.quadraticCurveTo(t,i+f,t,i+f-e,t,i+f-e);n.lineTo(t,i+e);o&&n.quadraticCurveTo(t,i,t+r,i,t+r,i);n.closePath();this._renderFill(n);this._renderStroke(n)},_renderDashedStroke:function(n){var i=-this.width/2,r=-this.height/2,u=this.width,f=this.height;n.beginPath();t.util.drawDashedLine(n,i,r,i+u,r,this.strokeDashArray);t.util.drawDashedLine(n,i+u,r,i+u,r+f,this.strokeDashArray);t.util.drawDashedLine(n,i+u,r+f,i,r+f,this.strokeDashArray);t.util.drawDashedLine(n,i,r+f,i,r,this.strokeDashArray);n.closePath()},_normalizeLeftTopProperties:function(n){return"left"in n&&this.set("left",n.left+this.getWidth()/2),this.set("x",n.left||0),"top"in n&&this.set("top",n.top+this.getHeight()/2),this.set("y",n.top||0),this},toObject:function(n){var t=r(this.callSuper("toObject",n),{rx:this.get("rx")||0,ry:this.get("ry")||0,x:this.get("x"),y:this.get("y")});return this.includeDefaultValues||this._removeDefaultValues(t),t},toSVG:function(n){var t=this._createBaseSVGMarkup();return t.push("<rect ",'x="',this.width/-2,'" y="',this.height/-2,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),n?n(t.join("")):t.join("")},complexity:function(){return 1}});t.Rect.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" "));t.Rect.fromElement=function(n,i){var f,e;return n?(f=t.parseAttributes(n,t.Rect.ATTRIBUTE_NAMES),f=u(f),e=new t.Rect(r(i?t.util.object.clone(i):{},f)),e._normalizeLeftTopProperties(f),e):null};t.Rect.fromObject=function(n){return new t.Rect(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.toFixed;if(t.Polyline){t.warn("fabric.Polyline is already defined");return}t.Polyline=t.util.createClass(t.Object,{type:"polyline",initialize:function(n,t,i){t=t||{};this.set("points",n);this.callSuper("initialize",t);this._calcDimensions(i)},_calcDimensions:function(n){return t.Polygon.prototype._calcDimensions.call(this,n)},toObject:function(n){return t.Polygon.prototype.toObject.call(this,n)},toSVG:function(n){for(var u=[],r=this._createBaseSVGMarkup(),t=0,f=this.points.length;t<f;t++)u.push(i(this.points[t].x,2),",",i(this.points[t].y,2)," ");return r.push("<polyline ",'points="',u.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),n?n(r.join("")):r.join("")},_render:function(n){var i,t,r;for(n.beginPath(),n.moveTo(this.points[0].x,this.points[0].y),t=0,r=this.points.length;t<r;t++)i=this.points[t],n.lineTo(i.x,i.y);this._renderFill(n);this._renderStroke(n)},_renderDashedStroke:function(n){var r,u,i,f;for(n.beginPath(),i=0,f=this.points.length;i<f;i++)r=this.points[i],u=this.points[i+1]||r,t.util.drawDashedLine(n,r.x,r.y,u.x,u.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}});t.Polyline.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat();t.Polyline.fromElement=function(n,i){if(!n)return null;i||(i={});var r=t.parsePointsAttribute(n.getAttribute("points")),u=t.parseAttributes(n,t.Polyline.ATTRIBUTE_NAMES);return t.util.normalizePoints(r,i),new t.Polyline(r,t.util.object.extend(u,i),!0)};t.Polyline.fromObject=function(n){var i=n.points;return new t.Polyline(i,n,!0)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend,r=t.util.array.min,u=t.util.array.max,f=t.util.toFixed;if(t.Polygon){t.warn("fabric.Polygon is already defined");return}t.Polygon=t.util.createClass(t.Object,{type:"polygon",initialize:function(n,t,i){t=t||{};this.points=n;this.callSuper("initialize",t);this._calcDimensions(i)},_calcDimensions:function(n){var t=this.points,i=r(t,"x"),f=r(t,"y"),s=u(t,"x"),h=u(t,"y"),e,o;(this.width=s-i||1,this.height=h-f||1,this.minX=i,this.minY=f,n)||(e=this.width/2+this.minX,o=this.height/2+this.minY,this.points.forEach(function(n){n.x-=e;n.y-=o},this))},toObject:function(n){return i(this.callSuper("toObject",n),{points:this.points.concat()})},toSVG:function(n){for(var r=[],i=this._createBaseSVGMarkup(),t=0,u=this.points.length;t<u;t++)r.push(f(this.points[t].x,2),",",f(this.points[t].y,2)," ");return i.push("<polygon ",'points="',r.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),n?n(i.join("")):i.join("")},_render:function(n){var i,t,r;for(n.beginPath(),n.moveTo(this.points[0].x,this.points[0].y),t=0,r=this.points.length;t<r;t++)i=this.points[t],n.lineTo(i.x,i.y);this._renderFill(n);(this.stroke||this.strokeDashArray)&&(n.closePath(),this._renderStroke(n))},_renderDashedStroke:function(n){var r,u,i,f;for(n.beginPath(),i=0,f=this.points.length;i<f;i++)r=this.points[i],u=this.points[i+1]||this.points[0],t.util.drawDashedLine(n,r.x,r.y,u.x,u.y,this.strokeDashArray);n.closePath()},complexity:function(){return this.points.length}});t.Polygon.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat();t.Polygon.fromElement=function(n,r){if(!n)return null;r||(r={});var u=t.parsePointsAttribute(n.getAttribute("points")),f=t.parseAttributes(n,t.Polygon.ATTRIBUTE_NAMES);return t.util.normalizePoints(u,r),new t.Polygon(u,i(f,r),!0)};t.Polygon.fromObject=function(n){return new t.Polygon(n.points,n,!0)}}(typeof exports!="undefined"?exports:this),function(n){function i(n){return n[0]==="H"?n[1]:n[n.length-2]}function r(n){return n[0]==="V"?n[1]:n[n.length-1]}var s={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7};"use strict";var t=n.fabric||(n.fabric={}),f=t.util.array.min,e=t.util.array.max,u=t.util.object.extend,h=Object.prototype.toString,o=t.util.drawArc;if(t.Path){t.warn("fabric.Path is already defined");return}t.Path=t.util.createClass(t.Object,{type:"path",initialize:function(n,t){if(t=t||{},this.setOptions(t),!n)throw new Error("`path` argument is required");var i=h.call(n)==="[object Array]";(this.path=i?n:n.match&&n.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path)&&(i||(this.path=this._parsePath()),this._initializePath(t),t.sourcePath&&this.setSourcePath(t.sourcePath))},_initializePath:function(n){var t="width"in n&&n.width!=null,i="height"in n&&n.width!=null,r="left"in n,f="top"in n,e=r?this.left:0,o=f?this.top:0;t&&i?(f||(this.top=this.height/2),r||(this.left=this.width/2)):(u(this,this._parseDimensions()),t&&(this.width=n.width),i&&(this.height=n.height));this.pathOffset=this.pathOffset||this._calculatePathOffset(e,o)},_calculatePathOffset:function(n,t){return{x:this.left-n-this.width/2,y:this.top-t-this.height/2}},_render:function(n){for(var t,l=null,i=0,r=0,e=0,s=0,h,c,y,p,u=-(this.width/2+this.pathOffset.x),f=-(this.height/2+this.pathOffset.y),a,v=0,w=this.path.length;v<w;++v){t=this.path[v];switch(t[0]){case"l":i+=t[1];r+=t[2];n.lineTo(i+u,r+f);break;case"L":i=t[1];r=t[2];n.lineTo(i+u,r+f);break;case"h":i+=t[1];n.lineTo(i+u,r+f);break;case"H":i=t[1];n.lineTo(i+u,r+f);break;case"v":r+=t[1];n.lineTo(i+u,r+f);break;case"V":r=t[1];n.lineTo(i+u,r+f);break;case"m":i+=t[1];r+=t[2];a=l&&(l[0]==="m"||l[0]==="M")?"lineTo":"moveTo";n[a](i+u,r+f);break;case"M":i=t[1];r=t[2];a=l&&(l[0]==="m"||l[0]==="M")?"lineTo":"moveTo";n[a](i+u,r+f);break;case"c":h=i+t[5];c=r+t[6];e=i+t[3];s=r+t[4];n.bezierCurveTo(i+t[1]+u,r+t[2]+f,e+u,s+f,h+u,c+f);i=h;r=c;break;case"C":i=t[5];r=t[6];e=t[3];s=t[4];n.bezierCurveTo(t[1]+u,t[2]+f,e+u,s+f,i+u,r+f);break;case"s":h=i+t[3];c=r+t[4];e=e?2*i-e:i;s=s?2*r-s:r;n.bezierCurveTo(e+u,s+f,i+t[1]+u,r+t[2]+f,h+u,c+f);e=i+t[1];s=r+t[2];i=h;r=c;break;case"S":h=t[3];c=t[4];e=2*i-e;s=2*r-s;n.bezierCurveTo(e+u,s+f,t[1]+u,t[2]+f,h+u,c+f);i=h;r=c;e=t[1];s=t[2];break;case"q":h=i+t[3];c=r+t[4];e=i+t[1];s=r+t[2];n.quadraticCurveTo(e+u,s+f,h+u,c+f);i=h;r=c;break;case"Q":h=t[3];c=t[4];n.quadraticCurveTo(t[1]+u,t[2]+f,h+u,c+f);i=h;r=c;e=t[1];s=t[2];break;case"t":h=i+t[1];c=r+t[2];l[0].match(/[QqTt]/)===null?(e=i,s=r):l[0]==="t"?(e=2*i-y,s=2*r-p):l[0]==="q"&&(e=2*i-e,s=2*r-s);y=e;p=s;n.quadraticCurveTo(e+u,s+f,h+u,c+f);i=h;r=c;e=i+t[1];s=r+t[2];break;case"T":h=t[1];c=t[2];e=2*i-e;s=2*r-s;n.quadraticCurveTo(e+u,s+f,h+u,c+f);i=h;r=c;break;case"a":o(n,i+u,r+f,[t[1],t[2],t[3],t[4],t[5],t[6]+i+u,t[7]+r+f]);i+=t[6];r+=t[7];break;case"A":o(n,i+u,r+f,[t[1],t[2],t[3],t[4],t[5],t[6]+u,t[7]+f]);i=t[6];r=t[7];break;case"z":case"Z":n.closePath()}l=t}},render:function(n,i){if(this.visible){n.save();var r=this.transformMatrix;r&&n.transform(r[0],r[1],r[2],r[3],r[4],r[5]);i||this.transform(n);this._setStrokeStyles(n);this._setFillStyles(n);this._setShadow(n);this.clipTo&&t.util.clipContext(this,n);n.beginPath();this._render(n);this._renderFill(n);this._renderStroke(n);this.clipTo&&n.restore();this._removeShadow(n);!i&&this.active&&(this.drawBorders(n),this.drawControls(n));n.restore()}},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(n){var t=u(this.callSuper("toObject",n),{path:this.path,pathOffset:this.pathOffset});return this.sourcePath&&(t.sourcePath=this.sourcePath),this.transformMatrix&&(t.transformMatrix=this.transformMatrix),t},toDatalessObject:function(n){var t=this.toObject(n);return this.sourcePath&&(t.path=this.sourcePath),delete t.sourcePath,t},toSVG:function(n){for(var u,r=[],t=this._createBaseSVGMarkup(),i=0,f=this.path.length;i<f;i++)r.push(this.path[i].join(" "));return u=r.join(" "),t.push('<g transform="',this.group?"":this.getSvgTransform(),'">',"<path ",'d="',u,'" style="',this.getSvgStyles(),'" transform="translate(',-this.width/2," ",-this.height/2,")",'" stroke-linecap="round" ',"/>","<\/g>"),n?n(t.join("")):t.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var r,a,v,u,t,y,f=[],i=[],e,o,p=/(-?\.\d+)|(-?\d+(\.\d+)?)/g,c,l,h=0,n,w=this.path.length;h<w;h++){for(e=this.path[h],l=e.slice(1).trim(),i.length=0;c=p.exec(l);)i.push(c[0]);for(n=[e.charAt(0)],r=0,a=i.length;r<a;r++)o=parseFloat(i[r]),isNaN(o)||n.push(o);if(v=n[0].toLowerCase(),u=s[v],n.length-1>u)for(t=1,y=n.length;t<y;t+=u)f.push([n[0]].concat(n.slice(t,t+u)));else f.push(n)}return f},_parseDimensions:function(){var n=[],t=[],s={};this.path.forEach(function(i,r){this._getCoordsFromCommand(i,r,n,t,s)},this);var i=f(n),r=f(t),h=e(n),c=e(t),u=h-i,o=c-r;return{left:this.left+(i+u/2),top:this.top+(r+o/2),width:u,height:o}},_getCoordsFromCommand:function(n,t,u,f,e){var h=!1,s,o;n[0]!=="H"&&(e.x=t===0?i(n):i(this.path[t-1]));n[0]!=="V"&&(e.y=t===0?r(n):r(this.path[t-1]));n[0]===n[0].toLowerCase()&&(h=!0);s=this._getXY(n,h,e);o=parseInt(s.x,10);isNaN(o)||u.push(o);o=parseInt(s.y,10);isNaN(o)||f.push(o)},_getXY:function(n,t,u){var f=t?u.x+i(n):n[0]==="V"?u.x:i(n),e=t?u.y+r(n):n[0]==="H"?u.y:r(n);return{x:f,y:e}}});t.Path.fromObject=function(n,i){typeof n.path=="string"?t.loadSVGFromURL(n.path,function(r){var u=r[0],f=n.path;delete n.path;t.util.object.extend(u,n);u.setSourcePath(f);i(u)}):i(new t.Path(n.path,n))};t.Path.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(["d"]);t.Path.fromElement=function(n,i,r){var f=t.parseAttributes(n,t.Path.ATTRIBUTE_NAMES);i&&i(new t.Path(f.d,u(f,r)))};t.Path.async=!0}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend,r=t.util.array.invoke,u=t.Object.prototype.toObject;if(t.PathGroup){t.warn("fabric.PathGroup is already defined");return}t.PathGroup=t.util.createClass(t.Path,{type:"path-group",fill:"",initialize:function(n,t){t=t||{};this.paths=n||[];for(var i=this.paths.length;i--;)this.paths[i].group=this;this.setOptions(t);this.setCoords();t.sourcePath&&this.setSourcePath(t.sourcePath)},render:function(n){var i,r,u;if(this.visible){for(n.save(),i=this.transformMatrix,i&&n.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this.transform(n),this._setShadow(n),this.clipTo&&t.util.clipContext(this,n),r=0,u=this.paths.length;r<u;++r)this.paths[r].render(n,!0);this.clipTo&&n.restore();this._removeShadow(n);this.active&&(this.drawBorders(n),this.drawControls(n));n.restore()}},_set:function(n,t){if(n==="fill"&&t&&this.isSameColor())for(var i=this.paths.length;i--;)this.paths[i]._set(n,t);return this.callSuper("_set",n,t)},toObject:function(n){var t=i(u.call(this,n),{paths:r(this.getObjects(),"toObject",n)});return this.sourcePath&&(t.sourcePath=this.sourcePath),t},toDatalessObject:function(n){var t=this.toObject(n);return this.sourcePath&&(t.paths=this.sourcePath),t},toSVG:function(n){for(var r=this.getObjects(),t=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',">"],i=0,u=r.length;i<u;i++)t.push(r[i].toSVG(n));return t.push("<\/g>"),n?n(t.join("")):t.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var n=this.getObjects()[0].get("fill");return this.getObjects().every(function(t){return t.get("fill")===n})},complexity:function(){return this.paths.reduce(function(n,t){return n+(t&&t.complexity?t.complexity():0)},0)},getObjects:function(){return this.paths}});t.PathGroup.fromObject=function(n,i){typeof n.paths=="string"?t.loadSVGFromURL(n.paths,function(r){var f=n.paths,u;delete n.paths;u=t.util.groupSVGElements(r,n,f);i(u)}):t.util.enlivenObjects(n.paths,function(r){delete n.paths;i(new t.PathGroup(r,n))})};t.PathGroup.async=!0}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend,r=t.util.array.min,u=t.util.array.max,e=t.util.array.invoke,f;t.Group||(f={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0},t.Group=t.util.createClass(t.Object,t.Collection,{type:"group",initialize:function(n,t){t=t||{};this._objects=n||[];for(var r=this._objects.length;r--;)this._objects[r].group=this;this.originalState={};this.callSuper("initialize");this._calcBounds();this._updateObjectsCoords();t&&i(this,t);this._setOpacityIfSame();this.setCoords(!0);this.saveCoords()},_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(n){var t=n.getLeft(),i=n.getTop();n.set({originalLeft:t,originalTop:i,left:t-this.left,top:i-this.top});n.setCoords();n.__origHasControls=n.hasControls;n.hasControls=!1},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(n){return this._restoreObjectsState(),this._objects.push(n),n.group=this,this.forEachObject(this._setObjectActive,this),this._calcBounds(),this._updateObjectsCoords(),this},_setObjectActive:function(n){n.set("active",!0);n.group=this},removeWithUpdate:function(n){return this._moveFlippedObject(n),this._restoreObjectsState(),this.forEachObject(this._setObjectActive,this),this.remove(n),this._calcBounds(),this._updateObjectsCoords(),this},_onObjectAdded:function(n){n.group=this},_onObjectRemoved:function(n){delete n.group;n.set("active",!1)},delegatedProperties:{fill:!0,opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(n,t){if(n in this.delegatedProperties){var i=this._objects.length;for(this[n]=t;i--;)this._objects[i].set(n,t)}else this[n]=t},toObject:function(n){return i(this.callSuper("toObject",n),{objects:e(this._objects,"toObject",n)})},render:function(n,i){if(this.visible){n.save();this.transform(n);this.clipTo&&t.util.clipContext(this,n);for(var r=0,u=this._objects.length;r<u;r++)this._renderObject(this._objects[r],n);this.clipTo&&n.restore();!i&&this.active&&(this.drawBorders(n),this.drawControls(n));n.restore()}},_renderObject:function(n,t){var i=n.borderScaleFactor,r=n.hasRotatingPoint,u=Math.max(this.scaleX,this.scaleY);n.visible&&(n.borderScaleFactor=u,n.hasRotatingPoint=!1,n.render(t),n.borderScaleFactor=i,n.hasRotatingPoint=r)},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},_moveFlippedObject:function(n){var i=n.get("originX"),r=n.get("originY"),u=n.getCenterPoint(),t;return n.set({originX:"center",originY:"center",left:u.x,top:u.y}),this._toggleFlipping(n),t=n.getPointByOrigin(i,r),n.set({originX:i,originY:r,left:t.x,top:t.y}),this},_toggleFlipping:function(n){this.flipX&&(n.toggle("flipX"),n.set("left",-n.get("left")),n.setAngle(-n.getAngle()));this.flipY&&(n.toggle("flipY"),n.set("top",-n.get("top")),n.setAngle(-n.getAngle()))},_restoreObjectState:function(n){return this._setObjectPosition(n),n.setCoords(),n.hasControls=n.__origHasControls,delete n.__origHasControls,n.set("active",!1),n.setCoords(),delete n.group,this},_setObjectPosition:function(n){var i=this.getLeft(),r=this.getTop(),t=this._getRotatedLeftTop(n);n.set({angle:n.getAngle()+this.getAngle(),left:i+t.left,top:r+t.top,scaleX:n.get("scaleX")*this.get("scaleX"),scaleY:n.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(n){var t=this.getAngle()*(Math.PI/180);return{left:-Math.sin(t)*n.getTop()*this.get("scaleY")+Math.cos(t)*n.getLeft()*this.get("scaleX"),top:Math.cos(t)*n.getTop()*this.get("scaleY")+Math.sin(t)*n.getLeft()*this.get("scaleX")}},destroy:function(){return this._objects.forEach(this._moveFlippedObject,this),this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){return this.forEachObject(function(n){n.setCoords()}),this},_setOpacityIfSame:function(){var n=this.getObjects(),t=n[0]?n[0].get("opacity"):1,i=n.every(function(n){return n.get("opacity")===t});i&&(this.opacity=t)},_calcBounds:function(){for(var i,r=[],u=[],n,t=0,f=this._objects.length;t<f;++t){n=this._objects[t];n.setCoords();for(i in n.oCoords)r.push(n.oCoords[i].x),u.push(n.oCoords[i].y)}this.set(this._getBounds(r,u))},_getBounds:function(n,t){var i=r(n),s=u(n),f=r(t),h=u(t),e=s-i||0,o=h-f||0;return{width:e,height:o,left:i+e/2||0,top:f+o/2||0}},toSVG:function(n){for(var t=["<g ",'transform="',this.getSvgTransform(),'">'],i=0,r=this._objects.length;i<r;i++)t.push(this._objects[i].toSVG(n));return t.push("<\/g>"),n?n(t.join("")):t.join("")},get:function(n){if(n in f){if(this[n])return this[n];for(var t=0,i=this._objects.length;t<i;t++)if(this._objects[t][n])return!0;return!1}return n in this.delegatedProperties?this._objects[0]&&this._objects[0].get(n):this[n]}}),t.Group.fromObject=function(n,i){t.util.enlivenObjects(n.objects,function(r){delete n.objects;i&&i(new t.Group(r,n))})},t.Group.async=!0)}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=fabric.util.object.extend;if(n.fabric||(n.fabric={}),n.fabric.Image){fabric.warn("fabric.Image is already defined.");return}fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",initialize:function(n,t){t||(t={});this.filters=[];this.callSuper("initialize",t);this._initElement(n,t);this._initConfig(t);t.filters&&(this.filters=t.filters,this.applyFilters())},getElement:function(){return this._element},setElement:function(n,t){return this._element=n,this._originalElement=n,this._initConfig(),this.filters.length!==0&&this.applyFilters(t),this},setCrossOrigin:function(n){return this.crossOrigin=n,this._element.crossOrigin=n,this},getOriginalSize:function(){var n=this.getElement();return{width:n.width,height:n.height}},render:function(n,t){if(this.visible){n.save();var i=this.transformMatrix,r=this.group&&this.group.type==="path-group";r&&n.translate(-this.group.width/2+this.width/2,-this.group.height/2+this.height/2);i&&n.transform(i[0],i[1],i[2],i[3],i[4],i[5]);t||this.transform(n);n.save();this._setShadow(n);this.clipTo&&fabric.util.clipContext(this,n);this._render(n);this.shadow&&!this.shadow.affectStroke&&this._removeShadow(n);this._renderStroke(n);this.clipTo&&n.restore();n.restore();this.active&&!t&&(this.drawBorders(n),this.drawControls(n));n.restore()}},_stroke:function(n){n.save();this._setStrokeStyles(n);n.beginPath();n.strokeRect(-this.width/2,-this.height/2,this.width,this.height);n.closePath();n.restore()},_renderDashedStroke:function(n){var t=-this.width/2,i=-this.height/2,r=this.width,u=this.height;n.save();this._setStrokeStyles(n);n.beginPath();fabric.util.drawDashedLine(n,t,i,t+r,i,this.strokeDashArray);fabric.util.drawDashedLine(n,t+r,i,t+r,i+u,this.strokeDashArray);fabric.util.drawDashedLine(n,t+r,i+u,t,i+u,this.strokeDashArray);fabric.util.drawDashedLine(n,t,i+u,t,i,this.strokeDashArray);n.closePath();n.restore()},toObject:function(n){return t(this.callSuper("toObject",n),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(n){return n&&n.toObject()}),crossOrigin:this.crossOrigin})},toSVG:function(n){var t=[],i;return t.push('<g transform="',this.getSvgTransform(),'">','<image xlink:href="',this.getSvgSrc(),'" style="',this.getSvgStyles(),'" transform="translate('+-this.width/2+" "+-this.height/2+")",'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="none"',"><\/image>"),(this.stroke||this.strokeDashArray)&&(i=this.fill,this.fill=null,t.push("<rect ",'x="',this.width/-2,'" y="',this.height/-2,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>'),this.fill=i),t.push("<\/g>"),n?n(t.join("")):t.join("")},getSrc:function(){return this.getElement().src||this.getElement()._src},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(n,t){this.constructor.fromObject(this.toObject(t),n)},applyFilters:function(n){if(this.filters.length===0){this._element=this._originalElement;n&&n();return}var t=this._originalElement,r=fabric.util.createCanvasElement(),i=fabric.util.createImage(),u=this;return r.width=t.width,r.height=t.height,r.getContext("2d").drawImage(t,0,0,t.width,t.height),this.filters.forEach(function(n){n&&n.applyTo(r)}),i.width=t.width,i.height=t.height,fabric.isLikelyNode?(i.src=r.toBuffer(undefined,fabric.Image.pngCompression),u._element=i,n&&n()):(i.onload=function(){u._element=i;n&&n();i.onload=r=t=null},i.src=r.toDataURL("image/png")),this},_render:function(n){n.drawImage(this._element,-this.width/2,-this.height/2,this.width,this.height)},_resetWidthHeight:function(){var n=this.getElement();this.set("width",n.width);this.set("height",n.height)},_initElement:function(n){this.setElement(fabric.util.getById(n));fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(n){n||(n={});this.setOptions(n);this._setWidthHeight(n);this._element.crossOrigin=this.crossOrigin},_initFilters:function(n,t){n.filters&&n.filters.length?fabric.util.enlivenObjects(n.filters,function(n){t&&t(n)},"fabric.Image.filters"):t&&t()},_setWidthHeight:function(n){this.width="width"in n?n.width:this.getElement().width||0;this.height="height"in n?n.height:this.getElement().height||0},complexity:function(){return 1}});fabric.Image.CSS_CANVAS="canvas-img";fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc;fabric.Image.fromObject=function(n,t){fabric.util.loadImage(n.src,function(i){fabric.Image.prototype._initFilters.call(n,n,function(r){n.filters=r||[];var u=new fabric.Image(i,n);t&&t(u)})},null,n.crossOrigin)};fabric.Image.fromURL=function(n,t,i){fabric.util.loadImage(n,function(n){t(new fabric.Image(n,i))},null,i&&i.crossOrigin)};fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height xlink:href".split(" "));fabric.Image.fromElement=function(n,i,r){var u=fabric.parseAttributes(n,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(u["xlink:href"],i,t(r?fabric.util.object.clone(r):{},u))};fabric.Image.async=!0;fabric.Image.pngCompression=1}(typeof exports!="undefined"?exports:this);fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var n=this.getAngle()%360;return n>0?Math.round((n-1)/90)*90:Math.round(n/90)*90},straighten:function(){return this.setAngle(this._getAngleValueForStraighten()),this},fxStraighten:function(n){n=n||{};var i=function(){},r=n.onComplete||i,u=n.onChange||i,t=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(n){t.setAngle(n);u()},onComplete:function(){t.setCoords();r()},onStart:function(){t.set("active",!1)}}),this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(n){return n.straighten(),this.renderAll(),this},fxStraightenObject:function(n){return n.fxStraighten({onChange:this.renderAll.bind(this)}),this}});fabric.Image.filters=fabric.Image.filters||{};fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}}),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Brightness=t.util.createClass(t.Image.filters.BaseFilter,{type:"Brightness",initialize:function(n){n=n||{};this.brightness=n.brightness||100},applyTo:function(n){for(var u=n.getContext("2d"),f=u.getImageData(0,0,n.width,n.height),i=f.data,r=this.brightness,t=0,e=i.length;t<e;t+=4)i[t]+=r,i[t+1]+=r,i[t+2]+=r;u.putImageData(f,0,0)},toObject:function(){return i(this.callSuper("toObject"),{brightness:this.brightness})}});t.Image.filters.Brightness.fromObject=function(n){return new t.Image.filters.Brightness(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Convolute=t.util.createClass(t.Image.filters.BaseFilter,{type:"Convolute",initialize:function(n){n=n||{};this.opaque=n.opaque;this.matrix=n.matrix||[0,0,0,0,1,0,0,0,0];var i=t.util.createCanvasElement();this.tmpCtx=i.getContext("2d")},_createImageData:function(n,t){return this.tmpCtx.createImageData(n,t)},applyTo:function(n){for(var t,i,r,l,a,u,f,b=this.matrix,k=n.getContext("2d"),v=k.getImageData(0,0,n.width,n.height),e=Math.round(Math.sqrt(b.length)),d=Math.floor(e/2),o=v.data,y=v.width,g=v.height,p=y,nt=g,tt=this._createImageData(p,nt),s=tt.data,ft=this.opaque?1:0,h=0;h<nt;h++)for(t=0;t<p;t++){var et=h,ot=t,c=(h*p+t)*4,it=0,rt=0,ut=0,w=0;for(i=0;i<e;i++)for(r=0;r<e;r++)(l=et+i-d,a=ot+r-d,l<0||l>g||a<0||a>y)||(u=(l*y+a)*4,f=b[i*e+r],it+=o[u]*f,rt+=o[u+1]*f,ut+=o[u+2]*f,w+=o[u+3]*f);s[c]=it;s[c+1]=rt;s[c+2]=ut;s[c+3]=w+ft*(255-w)}k.putImageData(tt,0,0)},toObject:function(){return i(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}});t.Image.filters.Convolute.fromObject=function(n){return new t.Image.filters.Convolute(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.GradientTransparency=t.util.createClass(t.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(n){n=n||{};this.threshold=n.threshold||100},applyTo:function(n){for(var r=n.getContext("2d"),u=r.getImageData(0,0,n.width,n.height),i=u.data,e=this.threshold,f=i.length,t=0,o=i.length;t<o;t+=4)i[t+3]=e+255*(f-t)/f;r.putImageData(u,0,0)},toObject:function(){return i(this.callSuper("toObject"),{threshold:this.threshold})}});t.Image.filters.GradientTransparency.fromObject=function(n){return new t.Image.filters.GradientTransparency(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={});t.Image.filters.Grayscale=t.util.createClass(t.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(n){for(var f=n.getContext("2d"),r=f.getImageData(0,0,n.width,n.height),i=r.data,e=r.width*r.height*4,t=0,u;t<e;)u=(i[t]+i[t+1]+i[t+2])/3,i[t]=u,i[t+1]=u,i[t+2]=u,t+=4;f.putImageData(r,0,0)}});t.Image.filters.Grayscale.fromObject=function(){return new t.Image.filters.Grayscale}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={});t.Image.filters.Invert=t.util.createClass(t.Image.filters.BaseFilter,{type:"Invert",applyTo:function(n){for(var r=n.getContext("2d"),u=r.getImageData(0,0,n.width,n.height),i=u.data,f=i.length,t=0;t<f;t+=4)i[t]=255-i[t],i[t+1]=255-i[t+1],i[t+2]=255-i[t+2];r.putImageData(u,0,0)}});t.Image.filters.Invert.fromObject=function(){return new t.Image.filters.Invert}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Mask=t.util.createClass(t.Image.filters.BaseFilter,{type:"Mask",initialize:function(n){n=n||{};this.mask=n.mask;this.channel=[0,1,2,3].indexOf(n.channel)>-1?n.channel:0},applyTo:function(n){var o,s;if(this.mask){var e=n.getContext("2d"),u=e.getImageData(0,0,n.width,n.height),h=u.data,i=this.mask.getElement(),f=t.util.createCanvasElement(),c=this.channel,r,l=u.width*u.height*4;for(f.width=i.width,f.height=i.height,f.getContext("2d").drawImage(i,0,0,i.width,i.height),o=f.getContext("2d").getImageData(0,0,i.width,i.height),s=o.data,r=0;r<l;r+=4)h[r+3]=s[r+c];e.putImageData(u,0,0)}},toObject:function(){return i(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}});t.Image.filters.Mask.fromObject=function(n,i){t.util.loadImage(n.mask.src,function(r){n.mask=new t.Image(r,n.mask);i&&i(new t.Image.filters.Mask(n))})};t.Image.filters.Mask.async=!0}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Noise=t.util.createClass(t.Image.filters.BaseFilter,{type:"Noise",initialize:function(n){n=n||{};this.noise=n.noise||100},applyTo:function(n){for(var u=n.getContext("2d"),f=u.getImageData(0,0,n.width,n.height),i=f.data,e=this.noise,r,t=0,o=i.length;t<o;t+=4)r=(.5-Math.random())*e,i[t]+=r,i[t+1]+=r,i[t+2]+=r;u.putImageData(f,0,0)},toObject:function(){return i(this.callSuper("toObject"),{noise:this.noise})}});t.Image.filters.Noise.fromObject=function(n){return new t.Image.filters.Noise(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Pixelate=t.util.createClass(t.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(n){n=n||{};this.blocksize=n.blocksize||4},applyTo:function(n){for(var h=n.getContext("2d"),f=h.getImageData(0,0,n.width,n.height),i=f.data,w=f.height,s=f.width,t,u,c,l,a,v,e,y,o,p,r=0;r<w;r+=this.blocksize)for(u=0;u<s;u+=this.blocksize)for(t=r*4*s+u*4,c=i[t],l=i[t+1],a=i[t+2],v=i[t+3],e=r,y=r+this.blocksize;e<y;e++)for(o=u,p=u+this.blocksize;o<p;o++)t=e*4*s+o*4,i[t]=c,i[t+1]=l,i[t+2]=a,i[t+3]=v;h.putImageData(f,0,0)},toObject:function(){return i(this.callSuper("toObject"),{blocksize:this.blocksize})}});t.Image.filters.Pixelate.fromObject=function(n){return new t.Image.filters.Pixelate(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.RemoveWhite=t.util.createClass(t.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(n){n=n||{};this.threshold=n.threshold||30;this.distance=n.distance||20},applyTo:function(n){for(var h=n.getContext("2d"),c=h.getImageData(0,0,n.width,n.height),i=c.data,l=this.threshold,e=this.distance,o=255-l,s=Math.abs,r,u,f,t=0,a=i.length;t<a;t+=4)r=i[t],u=i[t+1],f=i[t+2],r>o&&u>o&&f>o&&s(r-u)<e&&s(r-f)<e&&s(u-f)<e&&(i[t+3]=1);h.putImageData(c,0,0)},toObject:function(){return i(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}});t.Image.filters.RemoveWhite.fromObject=function(n){return new t.Image.filters.RemoveWhite(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={});t.Image.filters.Sepia=t.util.createClass(t.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(n){for(var u=n.getContext("2d"),f=u.getImageData(0,0,n.width,n.height),i=f.data,e=i.length,r,t=0;t<e;t+=4)r=.3*i[t]+.59*i[t+1]+.11*i[t+2],i[t]=r+100,i[t+1]=r+50,i[t+2]=r+255;u.putImageData(f,0,0)}});t.Image.filters.Sepia.fromObject=function(){return new t.Image.filters.Sepia}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={});t.Image.filters.Sepia2=t.util.createClass(t.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(n){for(var e=n.getContext("2d"),o=e.getImageData(0,0,n.width,n.height),i=o.data,s=i.length,r,u,f,t=0;t<s;t+=4)r=i[t],u=i[t+1],f=i[t+2],i[t]=(r*.393+u*.769+f*.189)/1.351,i[t+1]=(r*.349+u*.686+f*.168)/1.203,i[t+2]=(r*.272+u*.534+f*.131)/2.14;e.putImageData(o,0,0)}});t.Image.filters.Sepia2.fromObject=function(){return new t.Image.filters.Sepia2}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Tint=t.util.createClass(t.Image.filters.BaseFilter,{type:"Tint",initialize:function(n){n=n||{};this.color=n.color||"#000000";this.opacity=typeof n.opacity!="undefined"?n.opacity:new t.Color(this.color).getAlpha()},applyTo:function(n){var e=n.getContext("2d"),o=e.getImageData(0,0,n.width,n.height),r=o.data,y=r.length,i,s,h,c,l,a,v,u,f;for(f=new t.Color(this.color).getSource(),s=f[0]*this.opacity,h=f[1]*this.opacity,c=f[2]*this.opacity,u=1-this.opacity,i=0;i<y;i+=4)l=r[i],a=r[i+1],v=r[i+2],r[i]=s+l*u,r[i+1]=h+a*u,r[i+2]=c+v*u;e.putImageData(o,0,0)},toObject:function(){return i(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}});t.Image.filters.Tint.fromObject=function(n){return new t.Image.filters.Tint(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),u=t.util.object.extend,f=t.util.object.clone,i=t.util.toFixed,e=t.StaticCanvas.supports("setLineDash"),r;if(t.Text){t.warn("fabric.Text is already defined");return}r=t.Object.prototype.stateProperties.concat();r.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor","useNative","path");t.Text=t.util.createClass(t.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,textDecoration:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.3,textBackgroundColor:"",path:null,useNative:!0,stateProperties:r,stroke:null,shadow:null,initialize:function(n,t){t=t||{};this.text=n;this.__skipDimension=!0;this.setOptions(t);this.__skipDimension=!1;this._initDimensions();this.setCoords()},_initDimensions:function(){if(!this.__skipDimension){var n=t.util.createCanvasElement();this._render(n.getContext("2d"))}},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(n){var t=this.group&&this.group.type==="path-group";t&&!this.transformMatrix?n.translate(-this.group.width/2+this.left,-this.group.height/2+this.top):t&&this.transformMatrix&&n.translate(-this.group.width/2,-this.group.height/2);typeof Cufon=="undefined"||this.useNative===!0?this._renderViaNative(n):this._renderViaCufon(n)},_renderViaNative:function(n){var i=this.text.split(this._reNewline);this.transform(n,t.isLikelyNode);this._setTextStyles(n);this.width=this._getTextWidth(n,i);this.height=this._getTextHeight(n,i);this.clipTo&&t.util.clipContext(this,n);this._renderTextBackground(n,i);this._translateForTextAlign(n);this._renderText(n,i);this.textAlign!=="left"&&this.textAlign!=="justify"&&n.restore();this._renderTextDecoration(n,i);this.clipTo&&n.restore();this._setBoundaries(n,i);this._totalLineHeight=0},_renderText:function(n,t){n.save();this._setShadow(n);this._renderTextFill(n,t);this._renderTextStroke(n,t);this._removeShadow(n);n.restore()},_translateForTextAlign:function(n){this.textAlign!=="left"&&this.textAlign!=="justify"&&(n.save(),n.translate(this.textAlign==="center"?this.width/2:this.width,0))},_setBoundaries:function(n,t){var i,u,r,f;for(this._boundaries=[],i=0,u=t.length;i<u;i++)r=this._getLineWidth(n,t[i]),f=this._getLineLeftOffset(r),this._boundaries.push({height:this.fontSize*this.lineHeight,width:r,left:f})},_setTextStyles:function(n){this._setFillStyles(n);this._setStrokeStyles(n);n.textBaseline="alphabetic";this.skipTextAlign||(n.textAlign=this.textAlign);n.font=this._getFontDeclaration()},_getTextHeight:function(n,t){return this.fontSize*t.length*this.lineHeight},_getTextWidth:function(n,t){for(var u,i=n.measureText(t[0]||"|").width,r=1,f=t.length;r<f;r++)u=n.measureText(t[r]).width,u>i&&(i=u);return i},_renderChars:function(n,t,i,r,u){t[n](i,r,u)},_renderTextLine:function(n,t,i,r,u,f){var h,s,e,l;if(u-=this.fontSize/4,this.textAlign!=="justify"){this._renderChars(n,t,i,r,u,f);return}if(h=t.measureText(i).width,s=this.width,s>h){var o=i.split(/\s+/),a=t.measureText(i.replace(/\s+/g,"")).width,v=s-a,y=o.length-1,p=v/y,c=0;for(e=0,l=o.length;e<l;e++)this._renderChars(n,t,o[e],r+c,u,f),c+=t.measureText(o[e]).width+p}else this._renderChars(n,t,i,r,u,f)},_getLeftOffset:function(){return t.isLikelyNode?0:-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(n,t){var r,i,u,f;if(this.fill||this.skipFillStrokeCheck)for(this._boundaries=[],r=0,i=0,u=t.length;i<u;i++)f=this._getHeightOfLine(n,i,t),r+=f,this._renderTextLine("fillText",n,t[i],this._getLeftOffset(),this._getTopOffset()+r,i)},_renderTextStroke:function(n,t){var r,i,u,f;if(this.stroke||this.skipFillStrokeCheck){for(r=0,n.save(),this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),e&&n.setLineDash(this.strokeDashArray)),n.beginPath(),i=0,u=t.length;i<u;i++)f=this._getHeightOfLine(n,i,t),r+=f,this._renderTextLine("strokeText",n,t[i],this._getLeftOffset(),this._getTopOffset()+r,i);n.closePath();n.restore()}},_getHeightOfLine:function(){return this.fontSize*this.lineHeight},_renderTextBackground:function(n,t){this._renderTextBoxBackground(n);this._renderTextLinesBackground(n,t)},_renderTextBoxBackground:function(n){this.backgroundColor&&(n.save(),n.fillStyle=this.backgroundColor,n.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),n.restore())},_renderTextLinesBackground:function(n,t){var i,u,r,f;if(this.textBackgroundColor){for(n.save(),n.fillStyle=this.textBackgroundColor,i=0,u=t.length;i<u;i++)t[i]!==""&&(r=this._getLineWidth(n,t[i]),f=this._getLineLeftOffset(r),n.fillRect(this._getLeftOffset()+f,this._getTopOffset()+i*this.fontSize*this.lineHeight,r,this.fontSize*this.lineHeight));n.restore()}},_getLineLeftOffset:function(n){return this.textAlign==="center"?(this.width-n)/2:this.textAlign==="right"?this.width-n:0},_getLineWidth:function(n,t){return this.textAlign==="justify"?this.width:n.measureText(t).width},_renderTextDecoration:function(n,t){function r(r){for(var e,s,f=0,o=t.length;f<o;f++)e=i._getLineWidth(n,t[f]),s=i._getLineLeftOffset(e),n.fillRect(i._getLeftOffset()+s,~~(r+f*i._getHeightOfLine(n,f,t)-u),e,1)}if(this.textDecoration){var u=this._getTextHeight(n,t)/2,i=this;this.textDecoration.indexOf("underline")>-1&&r(this.fontSize*this.lineHeight);this.textDecoration.indexOf("line-through")>-1&&r(this.fontSize*this.lineHeight-this.fontSize/2);this.textDecoration.indexOf("overline")>-1&&r(this.fontSize*this.lineHeight-this.fontSize)}},_getFontDeclaration:function(){return[t.isLikelyNode?this.fontWeight:this.fontStyle,t.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",t.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(n,t){this.visible&&(n.save(),this._render(n),!t&&this.active&&(this.drawBorders(n),this.drawControls(n)),n.restore())},toObject:function(n){var t=u(this.callSuper("toObject",n),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,path:this.path,textBackgroundColor:this.textBackgroundColor,useNative:this.useNative});return this.includeDefaultValues||this._removeDefaultValues(t),t},toSVG:function(n){var i=[],r=this.text.split(this._reNewline),t=this._getSVGLeftTopOffsets(r),u=this._getSVGTextAndBg(t.lineTop,t.textLeft,r),f=this._getSVGShadows(t.lineTop,r);return t.textTop+=this._fontAscent?this._fontAscent/5*this.lineHeight:0,this._wrapSVGTextAndBg(i,u,f,t),n?n(i.join("")):i.join("")},_getSVGLeftTopOffsets:function(n){var t=this.useNative?this.fontSize*this.lineHeight:-this._fontAscent-this._fontAscent/5*this.lineHeight,i=-(this.width/2),r=this.useNative?this.fontSize-1:this.height/2-n.length*this.fontSize-this._totalLineHeight;return{textLeft:i,textTop:r,lineTop:t}},_wrapSVGTextAndBg:function(n,t,r,u){n.push('<g transform="',this.getSvgTransform(),'">',t.textBgRects.join(""),"<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" ','transform="translate(',i(u.textLeft,2)," ",i(u.textTop,2),')">',r.join(""),t.textSpans.join(""),"<\/text>","<\/g>")},_getSVGShadows:function(n,r){var f=[],u,o,e=1,s;if(!this.shadow||!this._boundaries)return f;for(u=0,o=r.length;u<o;u++)r[u]!==""?(s=this._boundaries&&this._boundaries[u]?this._boundaries[u].left:0,f.push('<tspan x="',i(s+e+this.shadow.offsetX,2),u===0||this.useNative?'" y':'" dy','="',i(this.useNative?n*u-this.height/2+this.shadow.offsetY:n+(u===0?this.shadow.offsetY:0),2),'" ',this._getFillAttributes(this.shadow.color),">",t.util.string.escapeXml(r[u]),"<\/tspan>"),e=1):e++;return f},_getSVGTextAndBg:function(n,t,i){var e=[],u=[],f=1,r,o;for(this._setSVGBg(u),r=0,o=i.length;r<o;r++)(i[r]!==""?(this._setSVGTextLineText(i[r],r,e,n,f,u),f=1):f++,this.textBackgroundColor&&this._boundaries)&&this._setSVGTextLineBg(u,r,t,n);return{textSpans:e,textBgRects:u}},_setSVGTextLineText:function(n,r,u,f,e){var o=this._boundaries&&this._boundaries[r]?i(this._boundaries[r].left,2):0;u.push('<tspan x="',o,'" ',r===0||this.useNative?"y":"dy",'="',i(this.useNative?f*r-this.height/2:f*e,2),'" ',this._getFillAttributes(this.fill),">",t.util.string.escapeXml(n),"<\/tspan>")},_setSVGTextLineBg:function(n,t,r,u){n.push("<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',i(r+this._boundaries[t].left,2),'" y="',i(u*t-this.height/2,2),'" width="',i(this._boundaries[t].width,2),'" height="',i(this._boundaries[t].height,2),'"><\/rect>')},_setSVGBg:function(n){this.backgroundColor&&this._boundaries&&n.push("<rect ",this._getFillAttributes(this.backgroundColor),' x="',i(-this.width/2,2),'" y="',i(-this.height/2,2),'" width="',i(this.width,2),'" height="',i(this.height,2),'"><\/rect>')},_getFillAttributes:function(n){var i=n&&typeof n=="string"?new t.Color(n):"";return!i||!i.getSource()||i.getAlpha()===1?'fill="'+n+'"':'opacity="'+i.getAlpha()+'" fill="'+i.setAlpha(1).toRgb()+'"'},_set:function(n,t){n==="fontFamily"&&this.path&&(this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,"$1"+t+"$3"));this.callSuper("_set",n,t);n in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}});t.Text.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y font-family font-style font-weight font-size text-decoration".split(" "));t.Text.fromElement=function(n,i){var u,r;return n?(u=t.parseAttributes(n,t.Text.ATTRIBUTE_NAMES),i=t.util.object.extend(i?t.util.object.clone(i):{},u),r=new t.Text(n.textContent,i),r.set({left:r.getLeft()+r.getWidth()/2,top:r.getTop()-r.getHeight()/2}),r):null};t.Text.fromObject=function(n){return new t.Text(n.text,f(n))};t.util.createAccessors(t.Text)}(typeof exports!="undefined"?exports:this),function(){var n=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,styles:null,skipFillStrokeCheck:!0,_reSpace:/\s|\n/,_fontSizeFraction:4,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,_charWidthsCache:{},initialize:function(n,t){this.styles=t?t.styles||{}:{};this.callSuper("initialize",n,t);this.initBehavior();fabric.IText.instances.push(this);this.__lineWidths={};this.__lineHeights={};this.__lineOffsets={}},isEmptyStyles:function(){var n,t,i,r;if(!this.styles)return!0;n=this.styles;for(t in n)for(i in n[t])for(r in n[t][i])return!1;return!0},setSelectionStart:function(n){this.selectionStart=n;this.hiddenTextarea&&(this.hiddenTextarea.selectionStart=n)},setSelectionEnd:function(n){this.selectionEnd=n;this.hiddenTextarea&&(this.hiddenTextarea.selectionEnd=n)},getSelectionStyles:function(){var n=this.get2DCursorLocation();return this.styles[n.lineIndex]?this.styles[n.lineIndex][n.charIndex]||{}:{}},setSelectionStyles:function(n){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,n);else for(var t=this.selectionStart;t<this.selectionEnd;t++)this._extendStyles(t,n);return this},_extendStyles:function(n,t){var i=this.get2DCursorLocation(n);this.styles[i.lineIndex]||(this.styles[i.lineIndex]={});this.styles[i.lineIndex][i.charIndex]||(this.styles[i.lineIndex][i.charIndex]={});fabric.util.object.extend(this.styles[i.lineIndex][i.charIndex],t)},_render:function(n){this.callSuper("_render",n);this.ctx=n;this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(this.active){var t=this.text.split(""),n;this.selectionStart===this.selectionEnd?(n=this._getCursorBoundaries(t,"cursor"),this.renderCursor(n)):(n=this._getCursorBoundaries(t,"selection"),this.renderSelection(t,n))}},get2DCursorLocation:function(n){typeof n=="undefined"&&(n=this.selectionStart);var i=this.text.slice(0,n),t=i.split(this._reNewline);return{lineIndex:t.length-1,charIndex:t[t.length-1].length}},getCurrentCharFontSize:function(n,t){return this.styles[n]&&this.styles[n][t===0?0:t-1]&&this.styles[n][t===0?0:t-1].fontSize||this.fontSize},getCurrentCharColor:function(n,t){return this.styles[n]&&this.styles[n][t===0?0:t-1]&&this.styles[n][t===0?0:t-1].fill||this.cursorColor},_getCursorBoundaries:function(n,t){var r=this.get2DCursorLocation(),u=this.text.split(this._reNewline),f=Math.round(this._getLeftOffset()),e=-this.height/2,i=this._getCursorBoundariesOffsets(n,t,r,u);return{left:f,top:e,leftOffset:i.left+i.lineLeft,topOffset:i.top}},_getCursorBoundariesOffsets:function(n,t,i,r){for(var c,s=0,u=0,e=0,o=0,h=t==="cursor"?this._getHeightOfLine(this.ctx,0)-this.getCurrentCharFontSize(i.lineIndex,i.charIndex):0,f=0;f<this.selectionStart;f++)n[f]==="\n"?(o=0,c=u+(t==="cursor"?1:0),h+=this._getCachedLineHeight(c),u++,e=0):(o+=this._getWidthOfChar(this.ctx,n[f],u,e),e++),s=this._getCachedLineOffset(u,r);return this._clearCache(),{top:h,left:o,lineLeft:s}},_clearCache:function(){this.__lineWidths={};this.__lineHeights={};this.__lineOffsets={}},_getCachedLineHeight:function(n){return this.__lineHeights[n]||(this.__lineHeights[n]=this._getHeightOfLine(this.ctx,n))},_getCachedLineWidth:function(n,t){return this.__lineWidths[n]||(this.__lineWidths[n]=this._getWidthOfLine(this.ctx,n,t))},_getCachedLineOffset:function(n,t){var i=this._getCachedLineWidth(n,t);return this.__lineOffsets[n]||(this.__lineOffsets[n]=this._getLineLeftOffset(i))},renderCursor:function(n){var t=this.ctx;t.save();var i=this.get2DCursorLocation(),r=i.lineIndex,u=i.charIndex,f=this.getCurrentCharFontSize(r,u);t.fillStyle=this.getCurrentCharColor(r,u);t.globalAlpha=this._currentCursorOpacity;t.fillRect(n.left+n.leftOffset,n.top+n.topOffset,this.cursorWidth/this.scaleX,f);t.restore()},renderSelection:function(n,t){var i=this.ctx,u,e,o;i.save();i.fillStyle=this.selectionColor;var s=this.get2DCursorLocation(),r=s.lineIndex,f=s.charIndex,h=this.text.split(this._reNewline),c=r;for(u=this.selectionStart;u<this.selectionEnd;u++)n[u]==="\n"?(t.leftOffset=0,t.topOffset+=this._getHeightOfLine(i,r),r++,f=0):u!==this.text.length&&(e=this._getWidthOfChar(i,n[u],r,f),o=this._getLineLeftOffset(this._getWidthOfLine(i,r,h))||0,r===c&&(o=0),i.fillRect(t.left+t.leftOffset+o,t.top+t.topOffset,e,this._getHeightOfLine(i,r)),t.leftOffset+=e,f++);i.restore()},_renderChars:function(n,t,i,r,u,f){var e,h;if(this.isEmptyStyles())return this._renderCharsFast(n,t,i,r,u);this.skipTextAlign=!0;r-=this.textAlign==="center"?this.width/2:this.textAlign==="right"?this.width:0;var o=this.text.split(this._reNewline),c=this._getWidthOfLine(t,f,o),l=this._getHeightOfLine(t,f,o),a=this._getLineLeftOffset(c),s=i.split("");for(r+=a||0,t.save(),e=0,h=s.length;e<h;e++)this._renderChar(n,t,f,e,s[e],r,u,l);t.restore()},_renderCharsFast:function(n,t,i,r,u){this.skipTextAlign=!1;n==="fillText"&&this.fill&&this.callSuper("_renderChars",n,t,i,r,u);n==="strokeText"&&this.stroke&&this.callSuper("_renderChars",n,t,i,r,u)},_renderChar:function(n,t,i,r,u,f,e,o){var s,h,c,l;this.styles&&this.styles[i]&&(s=this.styles[i][r])?(c=s.stroke||this.stroke,l=s.fill||this.fill,t.save(),h=this._applyCharStylesGetWidth(t,u,i,r,s),l&&t.fillText(u,f,e),c&&t.strokeText(u,f,e),this._renderCharDecoration(t,s,f,e,h,o),t.restore(),t.translate(h,0)):(n==="strokeText"&&this.stroke&&t[n](u,f,e),n==="fillText"&&this.fill&&t[n](u,f,e),h=this._applyCharStylesGetWidth(t,u,i,r),this._renderCharDecoration(t,null,f,e,h,o),t.translate(t.measureText(u).width,0))},_renderCharDecoration:function(n,t,i,r,u,f){var e=t?t.textDecoration||this.textDecoration:this.textDecoration;e&&(e.indexOf("underline")>-1&&this._renderCharDecorationAtOffset(n,i,r+this.fontSize/this._fontSizeFraction,u,0),e.indexOf("line-through")>-1&&this._renderCharDecorationAtOffset(n,i,r+this.fontSize/this._fontSizeFraction,u,f/this._fontSizeFraction),e.indexOf("overline")>-1&&this._renderCharDecorationAtOffset(n,i,r,u,f-this.fontSize/this._fontSizeFraction))},_renderCharDecorationAtOffset:function(n,t,i,r,u){n.fillRect(t,i-u,r,1)},_renderTextLine:function(n,t,i,r,u,f){u+=this.fontSize/4;this.callSuper("_renderTextLine",n,t,i,r,u,f)},_renderTextDecoration:function(n,t){if(this.isEmptyStyles())return this.callSuper("_renderTextDecoration",n,t)},_renderTextLinesBackground:function(n,t){var u,e,i,h,f,o,s,r,c,l;if(this.textBackgroundColor||this.styles){for(n.save(),this.textBackgroundColor&&(n.fillStyle=this.textBackgroundColor),u=0,e=this.fontSize/this._fontSizeFraction,i=0,h=t.length;i<h;i++){if(f=this._getHeightOfLine(n,i,t),t[i]===""){u+=f;continue}if(o=this._getWidthOfLine(n,i,t),s=this._getLineLeftOffset(o),this.textBackgroundColor&&(n.fillStyle=this.textBackgroundColor,n.fillRect(this._getLeftOffset()+s,this._getTopOffset()+u+e,o,f)),this.styles[i])for(r=0,c=t[i].length;r<c;r++)this.styles[i]&&this.styles[i][r]&&this.styles[i][r].textBackgroundColor&&(l=t[i][r],n.fillStyle=this.styles[i][r].textBackgroundColor,n.fillRect(this._getLeftOffset()+s+this._getWidthOfCharsAt(n,i,r,t),this._getTopOffset()+u+e,this._getWidthOfChar(n,l,i,r,t)+1,f));u+=f}n.restore()}},_getCacheProp:function(n,t){return n+t.fontFamily+t.fontSize+t.fontWeight+t.fontStyle+t.shadow},_applyCharStylesGetWidth:function(t,i,r,u,f){var e=f||this.styles[r]&&this.styles[r][u],o,s;return(e=e?n(e):{},this._applyFontStyles(e),o=this._getCacheProp(i,e),this.isEmptyStyles()&&this._charWidthsCache[o])?this._charWidthsCache[o]:(typeof e.shadow=="string"&&(e.shadow=new fabric.Shadow(e.shadow)),s=e.fill||this.fill,t.fillStyle=s.toLive?s.toLive(t):s,e.stroke&&(t.strokeStyle=e.stroke&&e.stroke.toLive?e.stroke.toLive(t):e.stroke),t.lineWidth=e.strokeWidth||this.strokeWidth,t.font=this._getFontDeclaration.call(e),this._setShadow.call(e,t),this._charWidthsCache[o]||(this._charWidthsCache[o]=t.measureText(i).width),this._charWidthsCache[o])},_applyFontStyles:function(n){n.fontFamily||(n.fontFamily=this.fontFamily);n.fontSize||(n.fontSize=this.fontSize);n.fontWeight||(n.fontWeight=this.fontWeight);n.fontStyle||(n.fontStyle=this.fontStyle)},_getWidthOfChar:function(n,t,i,r){n.save();var u=this._applyCharStylesGetWidth(n,t,i,r);return n.restore(),u},_getHeightOfChar:function(n,t,i,r){return this.styles[i]&&this.styles[i][r]?this.styles[i][r].fontSize||this.fontSize:this.fontSize},_getWidthOfCharAt:function(n,t,i,r){r=r||this.text.split(this._reNewline);var u=r[t].split("")[i];return this._getWidthOfChar(n,u,t,i)},_getHeightOfCharAt:function(n,t,i,r){r=r||this.text.split(this._reNewline);var u=r[t].split("")[i];return this._getHeightOfChar(n,u,t,i)},_getWidthOfCharsAt:function(n,t,i,r){for(var f=0,u=0;u<i;u++)f+=this._getWidthOfCharAt(n,t,u,r);return f},_getWidthOfLine:function(n,t,i){return this._getWidthOfCharsAt(n,t,i[t].length,i)},_getTextWidth:function(n,t){var i,r,f,u;if(this.isEmptyStyles())return this.callSuper("_getTextWidth",n,t);for(i=this._getWidthOfLine(n,0,t),r=1,f=t.length;r<f;r++)u=this._getWidthOfLine(n,r,t),u>i&&(i=u);return i},_getHeightOfLine:function(n,t,i){var r,o,f;i=i||this.text.split(this._reNewline);var u=this._getHeightOfChar(n,i[t][0],t,0),s=i[t],e=s.split("");for(r=1,o=e.length;r<o;r++)f=this._getHeightOfChar(n,e[r],t,r),f>u&&(u=f);return u*this.lineHeight},_getTextHeight:function(n,t){for(var r=0,i=0,u=t.length;i<u;i++)r+=this._getHeightOfLine(n,i,t);return r},_getTopOffset:function(){var n=fabric.Text.prototype._getTopOffset.call(this);return n-this.fontSize/this._fontSizeFraction},toObject:function(t){return fabric.util.object.extend(this.callSuper("toObject",t),{styles:n(this.styles)})}});fabric.IText.fromObject=function(t){return new fabric.IText(t.text,n(t))};fabric.IText.instances=[]}(),function(){var n=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initKeyHandlers();this.initCursorSelectionHandlers();this.initDoubleClickSimulation();this.initHiddenTextarea()},initSelectedHandler:function(){this.on("selected",function(){var n=this;setTimeout(function(){n.selected=!0},100);this._hasCanvasHandlers||(this._initCanvasHandlers(),this._hasCanvasHandlers=!0)})},_initCanvasHandlers:function(){var n=this;this.canvas.on("selection:cleared",function(t){t.e&&n.canvas.containsPoint(t.e,n)||n.exitEditing()});this.canvas.on("mouse:up",function(){this.getObjects("i-text").forEach(function(n){n.__isMousedown=!1})})},_tick:function(){var n=this;this._abortCursorAnimation||this.animate("_currentCursorOpacity",1,{duration:this.cursorDuration,onComplete:function(){n._onTickComplete()},onChange:function(){n.canvas&&n.canvas.renderAll()},abort:function(){return n._abortCursorAnimation}})},_onTickComplete:function(){if(!this._abortCursorAnimation){var n=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1);this._cursorTimeout1=setTimeout(function(){n.animate("_currentCursorOpacity",0,{duration:this.cursorDuration/2,onComplete:function(){n._tick()},onChange:function(){n.canvas&&n.canvas.renderAll()},abort:function(){return n._abortCursorAnimation}})},100)}},initDelayedCursor:function(){var n=this;this._cursorTimeout2&&clearTimeout(this._cursorTimeout2);this._cursorTimeout2=setTimeout(function(){n._abortCursorAnimation=!1;n._tick()},this.cursorDelay)},abortCursorAnimation:function(){this._abortCursorAnimation=!0;clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);this._currentCursorOpacity=0;this.canvas&&this.canvas.renderAll();var n=this;setTimeout(function(){n._abortCursorAnimation=!1},10)},selectAll:function(){this.selectionStart=0;this.selectionEnd=this.text.length},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(n){var i=0,t=n-1;if(this._reSpace.test(this.text.charAt(t)))while(this._reSpace.test(this.text.charAt(t)))i++,t--;while(/\S/.test(this.text.charAt(t))&&t>-1)i++,t--;return n-i},findWordBoundaryRight:function(n){var i=0,t=n;if(this._reSpace.test(this.text.charAt(t)))while(this._reSpace.test(this.text.charAt(t)))i++,t++;while(/\S/.test(this.text.charAt(t))&&t<this.text.length)i++,t++;return n+i},findLineBoundaryLeft:function(n){for(var i=0,t=n-1;!/\n/.test(this.text.charAt(t))&&t>-1;)i++,t--;return n-i},findLineBoundaryRight:function(n){for(var i=0,t=n;!/\n/.test(this.text.charAt(t))&&t<this.text.length;)i++,t++;return n+i},getNumNewLinesInSelectedText:function(){for(var r=this.getSelectedText(),t=0,n=0,i=r.split(""),u=i.length;n<u;n++)i[n]==="\n"&&t++;return t},searchWordBoundary:function(n,t){for(var i=n,r=this.text.charAt(i),u=/[ \n\.,;!\?\-]/;!u.test(r)&&i>0&&i<this.text.length;)i+=t,r=this.text.charAt(i);return u.test(r)&&r!=="\n"&&(i+=t===1?0:1),i},selectWord:function(n){var t=this.searchWordBoundary(n,-1),i=this.searchWordBoundary(n,1);this.setSelectionStart(t);this.setSelectionEnd(i)},selectLine:function(n){var t=this.findLineBoundaryLeft(n),i=this.findLineBoundaryRight(n);this.setSelectionStart(t);this.setSelectionEnd(i)},enterEditing:function(){if(!this.isEditing&&this.editable)return this.exitEditingOnOthers(),this.isEditing=!0,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._tick(),this.canvas&&this.canvas.renderAll(),this.fire("editing:entered"),this},exitEditingOnOthers:function(){fabric.IText.instances.forEach(function(n){n!==this&&n.exitEditing()},this)},_setEditingProps:function(){this.hoverCursor="text";this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text");this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=!1;this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){this.hiddenTextarea&&(this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart,this.hiddenTextarea.focus())},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&this.hiddenTextarea.blur(),this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this.fire("editing:exited"),this},_removeExtraneousStyles:function(){var t=this.text.split(this._reNewline);for(var n in this.styles)t[n]||delete this.styles[n]},_removeCharsFromTo:function(n,t){for(var i=t,u,f,r;i!==n;)u=this.get2DCursorLocation(i).charIndex,i--,f=this.get2DCursorLocation(i).charIndex,r=f>u,r?this.removeStyleObject(r,i+1):this.removeStyleObject(this.get2DCursorLocation(i).charIndex===0,i);this.text=this.text.slice(0,n)+this.text.slice(t)},insertChars:function(n){var t=this.text.slice(this.selectionStart,this.selectionStart+1)==="\n";this.text=this.text.slice(0,this.selectionStart)+n+this.text.slice(this.selectionEnd);this.selectionStart===this.selectionEnd?this.insertStyleObject(n,t):this.selectionEnd-this.selectionStart>1;this.selectionStart+=n.length;this.selectionEnd=this.selectionStart;this.canvas&&this.canvas.renderAll().renderAll();this.setCoords();this.fire("text:changed")},insertNewlineStyleObject:function(t,i,r){var e,u,f;if(this.shiftLineStyles(t,1),this.styles[t+1]||(this.styles[t+1]={}),e=this.styles[t][i-1],u={},r)u[0]=n(e),this.styles[t+1]=u;else{for(f in this.styles[t])parseInt(f,10)>=i&&(u[parseInt(f,10)-i]=this.styles[t][f],delete this.styles[t][f]);this.styles[t+1]=u}},insertCharStyleObject:function(t,i){var u=this.styles[t],f=n(u),e,r;i===0&&(i=1);for(e in f)r=parseInt(e,10),r>=i&&(u[r+1]=f[r]);this.styles[t][i]=n(u[i-1])},insertStyleObject:function(n,t){if(!this.isEmptyStyles()){var r=this.get2DCursorLocation(),i=r.lineIndex,u=r.charIndex;this.styles[i]||(this.styles[i]={});n==="\n"?this.insertNewlineStyleObject(i,u,t):this.insertCharStyleObject(i,u)}},shiftLineStyles:function(t,i){var f=n(this.styles),u,r;for(u in this.styles)r=parseInt(u,10),r>t&&(this.styles[r+i]=f[r])},removeStyleObject:function(t,i){var s=this.get2DCursorLocation(i),r=s.lineIndex,e=s.charIndex,u,h,o,c,f;if(t){var l=this.text.split(this._reNewline),a=l[r-1],v=a.length;this.styles[r-1]||(this.styles[r-1]={});for(e in this.styles[r])this.styles[r-1][parseInt(e,10)+v]=this.styles[r][e];this.shiftLineStyles(r,-1)}else{u=this.styles[r];u&&(h=this.selectionStart===this.selectionEnd?-1:0,delete u[e+h]);o=n(u);for(c in o)f=parseInt(c,10),f>=e&&f!==0&&(u[f-1]=o[f],delete u[f])}},insertNewline:function(){this.insertChars("\n")}})}();fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date;this.__lastLastClickTime=+new Date;this.lastPointer={};this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(n){this.__newClickTime=+new Date;var t=this.canvas.getPointer(n.e);this.isTripleClick(t)?(this.fire("tripleclick",n),this._stopEvent(n.e)):this.isDoubleClick(t)&&(this.fire("dblclick",n),this._stopEvent(n.e));this.__lastLastClickTime=this.__lastClickTime;this.__lastClickTime=this.__newClickTime;this.__lastPointer=t},isDoubleClick:function(n){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===n.x&&this.__lastPointer.y===n.y},isTripleClick:function(n){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===n.x&&this.__lastPointer.y===n.y},_stopEvent:function(n){n.preventDefault&&n.preventDefault();n.stopPropagation&&n.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler();this.initMousedownHandler();this.initMousemoveHandler();this.initMouseupHandler();this.initClicks()},initClicks:function(){this.on("dblclick",function(n){this.selectWord(this.getSelectionStartFromPointer(n.e))});this.on("tripleclick",function(n){this.selectLine(this.getSelectionStartFromPointer(n.e))})},initMousedownHandler:function(){this.on("mousedown",function(n){var t=this.canvas.getPointer(n.e);this.__mousedownX=t.x;this.__mousedownY=t.y;this.__isMousedown=!0;this.hiddenTextarea&&this.canvas&&this.canvas.wrapperEl.appendChild(this.hiddenTextarea);this.isEditing?(this.setCursorByClick(n.e),this.__selectionStartOnMouseDown=this.selectionStart):this.exitEditingOnOthers()})},initMousemoveHandler:function(){this.on("mousemove",function(n){if(this.__isMousedown&&this.isEditing){var t=this.getSelectionStartFromPointer(n.e);t>=this.__selectionStartOnMouseDown?(this.setSelectionStart(this.__selectionStartOnMouseDown),this.setSelectionEnd(t)):(this.setSelectionStart(t),this.setSelectionEnd(this.__selectionStartOnMouseDown))}})},_isObjectMoved:function(n){var t=this.canvas.getPointer(n);return this.__mousedownX!==t.x||this.__mousedownY!==t.y},initMouseupHandler:function(){this.on("mouseup",function(n){(this.__isMousedown=!1,this._isObjectMoved(n.e))||this.selected&&this.enterEditing()})},setCursorByClick:function(n){var t=this.getSelectionStartFromPointer(n);n.shiftKey?t<this.selectionStart?(this.setSelectionEnd(this.selectionStart),this.setSelectionStart(t)):this.setSelectionEnd(t):(this.setSelectionStart(t),this.setSelectionEnd(t))},_getLocalRotatedPointer:function(n){var t=this.canvas.getPointer(n),i=new fabric.Point(t.x,t.y),r=new fabric.Point(this.left,this.top),u=fabric.util.rotatePoint(i,r,fabric.util.degreesToRadians(-this.angle));return this.getLocalPointer(n,u)},getSelectionStartFromPointer:function(n){for(var c,l,r,f,a,e=this._getLocalRotatedPointer(n),i=this.text.split(this._reNewline),o=0,u=0,s=0,h=0,v,t=0,y=i.length;t<y;t++)for(s+=this._getHeightOfLine(this.ctx,t)*this.scaleY,c=this._getWidthOfLine(this.ctx,t,i),l=this._getLineLeftOffset(c),u=l,this.flipX&&(i[t]=i[t].split("").reverse().join("")),r=0,f=i[t].length;r<f;r++){if(a=i[t][r],o=u,u+=this._getWidthOfChar(this.ctx,a,t,this.flipX?f-r:r)*this.scaleX,s<=e.y||u<=e.x){h++;continue}return this._getNewSelectionStartFromOffset(e,o,u,h+t,f)}if(typeof v=="undefined")return this.text.length},_getNewSelectionStartFromOffset:function(n,t,i,r,u){var e=n.x-t,o=i-n.x,s=o>e?0:1,f=r+s;return this.flipX&&(f=u-f),f>this.text.length&&(f=this.text.length),f}});fabric.util.object.extend(fabric.IText.prototype,{initKeyHandlers:function(){fabric.util.addListener(fabric.document,"keydown",this.onKeyDown.bind(this));fabric.util.addListener(fabric.document,"keypress",this.onKeyPress.bind(this))},initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea");this.hiddenTextarea.setAttribute("autocapitalize","off");this.hiddenTextarea.style.cssText="position: absolute; top: 0; left: -9999px";fabric.document.body.appendChild(this.hiddenTextarea)},_keysMap:{8:"removeChars",13:"insertNewline",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMap:{65:"selectAll",67:"copy",86:"paste",88:"cut"},onKeyDown:function(n){if(this.isEditing){if(n.keyCode in this._keysMap)this[this._keysMap[n.keyCode]](n);else if(n.keyCode in this._ctrlKeysMap&&(n.ctrlKey||n.metaKey))this[this._ctrlKeysMap[n.keyCode]](n);else return;n.preventDefault();n.stopPropagation();this.canvas&&this.canvas.renderAll()}},forwardDelete:function(n){this.selectionStart===this.selectionEnd&&this.moveCursorRight(n);this.removeChars(n)},copy:function(){var n=this.getSelectedText();this.copiedText=n},paste:function(){this.copiedText&&this.insertChars(this.copiedText)},cut:function(n){this.copy();this.removeChars(n)},onKeyPress:function(n){!this.isEditing||n.metaKey||n.ctrlKey||n.keyCode===8||n.keyCode===13||(this.insertChars(String.fromCharCode(n.which)),n.preventDefault(),n.stopPropagation())},getDownCursorOffset:function(n,t){var r=t?this.selectionEnd:this.selectionStart,f=this.text.split(this._reNewline),o,s,h=this.text.slice(0,r),c=this.text.slice(r),l=h.slice(h.lastIndexOf("\n")+1),w=c.match(/(.*)\n?/)[1],b=(c.match(/.*\n(.*)\n?/)||{})[1]||"",u=this.get2DCursorLocation(r),a,e,v,i,y,p;if(u.lineIndex===f.length-1||n.metaKey)return this.text.length-r;for(a=this._getWidthOfLine(this.ctx,u.lineIndex,f),s=this._getLineLeftOffset(a),e=s,v=u.lineIndex,i=0,y=l.length;i<y;i++)o=l[i],e+=this._getWidthOfChar(this.ctx,o,v,i);return p=this._getIndexOnNextLine(u,b,e,f),w.length+1+p},_getIndexOnNextLine:function(n,t,i,r){for(var c,o,s=n.lineIndex+1,l=this._getWidthOfLine(this.ctx,s,r),a=this._getLineLeftOffset(l),f=a,e=0,h,u=0,v=t.length;u<v;u++)if(c=t[u],o=this._getWidthOfChar(this.ctx,c,s,u),f+=o,f>i){h=!0;var y=f-o,p=f,w=Math.abs(y-i),b=Math.abs(p-i);e=b<w?u+1:u;break}return h||(e=t.length),e},moveCursorDown:function(n){this.abortCursorAnimation();this._currentCursorOpacity=1;var t=this.getDownCursorOffset(n,this._selectionDirection==="right");n.shiftKey?this.moveCursorDownWithShift(t):this.moveCursorDownWithoutShift(t);this.initDelayedCursor()},moveCursorDownWithoutShift:function(n){this._selectionDirection="right";this.selectionStart+=n;this.selectionStart>this.text.length&&(this.selectionStart=this.text.length);this.selectionEnd=this.selectionStart},moveCursorDownWithShift:function(n){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd){this.selectionStart+=n;this._selectionDirection="left";return}this._selectionDirection="right";this.selectionEnd+=n;this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length)},getUpCursorOffset:function(n,t){var u=t?this.selectionEnd:this.selectionStart,r=this.get2DCursorLocation(u),o,a,i,v,y;if(r.lineIndex===0||n.metaKey)return u;var f=this.text.slice(0,u),e=f.slice(f.lastIndexOf("\n")+1),s=(f.match(/\n?(.*)\n.*$/)||{})[1]||"",h=this.text.split(this._reNewline),c,l,p=this._getWidthOfLine(this.ctx,r.lineIndex,h);for(l=this._getLineLeftOffset(p),o=l,a=r.lineIndex,i=0,v=e.length;i<v;i++)c=e[i],o+=this._getWidthOfChar(this.ctx,c,a,i);return y=this._getIndexOnPrevLine(r,s,o,h),s.length-y+e.length},_getIndexOnPrevLine:function(n,t,i,r){for(var c,o,s=n.lineIndex-1,l=this._getWidthOfLine(this.ctx,s,r),a=this._getLineLeftOffset(l),f=a,e=0,h,u=0,v=t.length;u<v;u++)if(c=t[u],o=this._getWidthOfChar(this.ctx,c,s,u),f+=o,f>i){h=!0;var y=f-o,p=f,w=Math.abs(y-i),b=Math.abs(p-i);e=b<w?u:u-1;break}return h||(e=t.length-1),e},moveCursorUp:function(n){this.abortCursorAnimation();this._currentCursorOpacity=1;var t=this.getUpCursorOffset(n,this._selectionDirection==="right");n.shiftKey?this.moveCursorUpWithShift(t):this.moveCursorUpWithoutShift(t);this.initDelayedCursor()},moveCursorUpWithShift:function(n){if(this.selectionStart===this.selectionEnd)this.selectionStart-=n;else{if(this._selectionDirection==="right"){this.selectionEnd-=n;this._selectionDirection="right";return}this.selectionStart-=n}this.selectionStart<0&&(this.selectionStart=0);this._selectionDirection="left"},moveCursorUpWithoutShift:function(n){this.selectionStart===this.selectionEnd&&(this.selectionStart-=n);this.selectionStart<0&&(this.selectionStart=0);this.selectionEnd=this.selectionStart;this._selectionDirection="left"},moveCursorLeft:function(n){(this.selectionStart!==0||this.selectionEnd!==0)&&(this.abortCursorAnimation(),this._currentCursorOpacity=1,n.shiftKey?this.moveCursorLeftWithShift(n):this.moveCursorLeftWithoutShift(n),this.initDelayedCursor())},_move:function(n,t,i){n.altKey?this[t]=this["findWordBoundary"+i](this[t]):n.metaKey?this[t]=this["findLineBoundary"+i](this[t]):this[t]+=i==="Left"?-1:1},_moveLeft:function(n,t){this._move(n,t,"Left")},_moveRight:function(n,t){this._move(n,t,"Right")},moveCursorLeftWithoutShift:function(n){this._selectionDirection="left";this.selectionEnd===this.selectionStart&&this._moveLeft(n,"selectionStart");this.selectionEnd=this.selectionStart},moveCursorLeftWithShift:function(n){this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd?this._moveLeft(n,"selectionEnd"):(this._selectionDirection="left",this._moveLeft(n,"selectionStart"),this.text.charAt(this.selectionStart)==="\n"&&this.selectionStart--,this.selectionStart<0&&(this.selectionStart=0))},moveCursorRight:function(n){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||(this.abortCursorAnimation(),this._currentCursorOpacity=1,n.shiftKey?this.moveCursorRightWithShift(n):this.moveCursorRightWithoutShift(n),this.initDelayedCursor())},moveCursorRightWithShift:function(n){this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd?this._moveRight(n,"selectionStart"):(this._selectionDirection="right",this._moveRight(n,"selectionEnd"),this.text.charAt(this.selectionEnd-1)==="\n"&&this.selectionEnd++,this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length))},moveCursorRightWithoutShift:function(n){this._selectionDirection="right";this.selectionStart===this.selectionEnd?(this._moveRight(n,"selectionStart"),this.selectionEnd=this.selectionStart):(this.selectionEnd+=this.getNumNewLinesInSelectedText(),this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length),this.selectionStart=this.selectionEnd)},removeChars:function(n){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(n):this._removeCharsFromTo(this.selectionStart,this.selectionEnd);this.selectionEnd=this.selectionStart;this._removeExtraneousStyles();this.canvas&&this.canvas.renderAll().renderAll();this.setCoords();this.fire("text:changed")},_removeCharsNearCursor:function(n){var t,i,r;this.selectionStart!==0&&(n.metaKey?(t=this.findLineBoundaryLeft(this.selectionStart),this._removeCharsFromTo(t,this.selectionStart),this.selectionStart=t):n.altKey?(i=this.findWordBoundaryLeft(this.selectionStart),this._removeCharsFromTo(i,this.selectionStart),this.selectionStart=i):(r=this.text.slice(this.selectionStart-1,this.selectionStart)==="\n",this.removeStyleObject(r),this.selectionStart--,this.text=this.text.slice(0,this.selectionStart)+this.text.slice(this.selectionStart+1)))}});fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(n,t,i,r,u,f){this.styles[t]?this._setSVGTextLineChars(n,t,i,r,u,f):this.callSuper("_setSVGTextLineText",n,t,i,r,u)},_setSVGTextLineChars:function(n,t,i,r,u,f){for(var o,c,v=t===0||this.useNative?"y":"dy",s=n.split(""),h=0,l=this._getSVGLineLeftOffset(t),a=this._getSVGLineTopOffset(t),y=this._getHeightOfLine(this.ctx,t),e=0,p=s.length;e<p;e++)o=this.styles[t][e]||{},i.push(this._createTextCharSpan(s[e],o,l,a,v,h)),c=this._getWidthOfChar(this.ctx,s[e],t,e),o.textBackgroundColor&&f.push(this._createTextCharBg(o,l,a,y,c,h)),h+=c},_getSVGLineLeftOffset:function(n){return this._boundaries&&this._boundaries[n]?fabric.util.toFixed(this._boundaries[n].left,2):0},_getSVGLineTopOffset:function(n){for(var i=0,t=0;t<=n;t++)i+=this._getHeightOfLine(this.ctx,t);return i-this.height/2},_createTextCharBg:function(n,t,i,r,u,f){return['<rect fill="',n.textBackgroundColor,'" transform="translate(',-this.width/2," ",-this.height+r,")",'" x="',t+f,'" y="',i+r,'" width="',u,'" height="',r,'"><\/rect>'].join("")},_createTextCharSpan:function(n,t,i,r,u,f){var e=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text"},t));return['<tspan x="',i+f,'" ',u,'="',r,'" ',t.fontFamily?'font-family="'+t.fontFamily.replace(/"/g,"'")+'" ':"",t.fontSize?'font-size="'+t.fontSize+'" ':"",t.fontStyle?'font-style="'+t.fontStyle+'" ':"",t.fontWeight?'font-weight="'+t.fontWeight+'" ':"",t.textDecoration?'text-decoration="'+t.textDecoration+'" ':"",'style="',e,'">',fabric.util.string.escapeXml(n),"<\/tspan>"].join("")}}),function(){function n(n,t,i){var r=e.parse(n),f,u;r.port||(r.port=r.protocol.indexOf("https:")===0?443:80);f=r.port===443?s:o;u=f.request({hostname:r.hostname,port:r.port,path:r.path,method:"GET"},function(n){var r="";t&&n.setEncoding(t);n.on("end",function(){i(r)});n.on("data",function(t){n.statusCode===200&&(r+=t)})});u.on("error",function(n){n.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+r.hostname+":"+r.port):fabric.log(n.message)});u.end()}function i(n,t){var i=require("fs");i.readFile(n,function(n,i){if(n){fabric.log(n);throw n;}else t(i)})}var r,u;if(typeof document=="undefined"||typeof window=="undefined"){var f=new require("xmldom").DOMParser,e=require("url"),o=require("http"),s=require("https"),t=require("canvas"),h=require("canvas").Image;fabric.util.loadImage=function(t,r,u){var e=function(n){f.src=new Buffer(n,"binary");f._src=t;r&&r.call(u,f)},f=new h;t&&(t instanceof Buffer||t.indexOf("data")===0)?(f.src=f._src=t,r&&r.call(u,f)):t&&t.indexOf("http")!==0?i(t,e):t?n(t,"binary",e):r&&r.call(u,t)};fabric.loadSVGFromURL=function(t,r,u){t=t.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();t.indexOf("http")!==0?i(t,function(n){fabric.loadSVGFromString(n,r,u)}):n(t,"",function(n){fabric.loadSVGFromString(n,r,u)})};fabric.loadSVGFromString=function(n,t,i){var r=(new f).parseFromString(n);fabric.parseSVGDocument(r.documentElement,function(n,i){t&&t(n,i)},i)};fabric.util.getScript=function(t,callback){n(t,"",function(body){eval(body);callback&&callback()})};fabric.Image.fromObject=function(n,t){fabric.util.loadImage(n.src,function(i){var r=new fabric.Image(i);r._initConfig(n);r._initFilters(n,function(n){r.filters=n||[];t&&t(r)})})};fabric.createCanvasForNode=function(n,i){var u=fabric.document.createElement("canvas"),f=new t(n||600,i||600),e,r;return u.style={},u.width=f.width,u.height=f.height,e=fabric.Canvas||fabric.StaticCanvas,r=new e(u),r.contextContainer=f.getContext("2d"),r.nodeCanvas=f,r.Font=t.Font,r};fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};fabric.StaticCanvas.prototype.createJPEGStream=function(n){return this.nodeCanvas.createJPEGStream(n)};r=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(n){return r.call(this,n),this.nodeCanvas.width=n,this};fabric.Canvas&&(fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth);u=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(n){return u.call(this,n),this.nodeCanvas.height=n,this};fabric.Canvas&&(fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight)}}();
//# sourceMappingURL=fabric.min.js.map
